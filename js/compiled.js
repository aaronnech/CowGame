function Action(){this.bindings_=[]}Action.NO_SOURCE=null;Action.prototype.fire=function(b,k){for(var p=0;p<this.bindings_.length;p++)this.bindings_[p].callback.apply(this.bindings_[p].binder,b,k)};Action.prototype.addBinding=function(b,k){this.bindings_.push({binder:b,callback:k})};Action.prototype.removeAllBindings=function(b){this.bindings_=this.bindings_.filter(function(k){return k.binder!=b})};Action.GameActions={RENDER:new Action,UPDATE:new Action,STOP:new Action,START:new Action};
Action.ViewActions={PAN_RIGHT:new Action,PAN_LEFT:new Action,PAN_UP:new Action,PAN_DOWN:new Action,START_DRAG_SELECT:new Action};function ClientController(b){this.base=Controller;this.base.apply(this,[b]);this.viewModel_=new MarkoViewModel}window.inherits(ClientController,Controller);
ClientController.prototype.setBindings=function(){this.bind(Action.GameActions.RENDER,this.onRender);this.bind(Action.GameActions.UPDATE,this.onUpdate);this.bind(Action.ViewActions.PAN_UP,this.panCameraUp);this.bind(Action.ViewActions.PAN_DOWN,this.panCameraDown);this.bind(Action.ViewActions.PAN_LEFT,this.panCameraLeft);this.bind(Action.ViewActions.PAN_RIGHT,this.panCameraRight)};ClientController.prototype.onRender=function(){this.viewModel_.render()};ClientController.prototype.onUpdate=function(){this.viewModel_.update()};
ClientController.prototype.panCameraUp=function(){this.viewModel_.panCameraUp()};ClientController.prototype.panCameraDown=function(){this.viewModel_.panCameraDown()};ClientController.prototype.panCameraLeft=function(){this.viewModel_.panCameraLeft()};ClientController.prototype.panCameraRight=function(){this.viewModel_.panCameraRight()};ClientController.prototype.onDragStart=function(){console.log("drag start")};ClientController.prototype.onClickScreen=function(){console.log("Hello")};function Controller(b){this.setBindings()}Controller.prototype.bind=function(b,k){b.addBinding(this,k)};Controller.prototype.clearBindings=function(b){b.removeAllBindings(this)};Controller.prototype.setBindings=window.ABSTRACT_METHOD;function Camera(b,k,p,q){this.base=Model;this.base.apply(this);this.y_=this.x_=0;this.width_=p;this.height_=q;this.worldWidth_=b;this.worldHeight_=k}window.inherits(Camera,Model);Camera.PAN_SPEED=5;Camera.prototype.inView=function(b,k){return b>=this.x_&&k>=this.y_&&b<=this.x_+this.width_&&k<=this.y_+this.height_};Camera.prototype.panUp=function(){this.moveY(-Camera.PAN_SPEED)};Camera.prototype.panDown=function(){this.moveY(Camera.PAN_SPEED)};Camera.prototype.panLeft=function(){this.moveX(-Camera.PAN_SPEED)};
Camera.prototype.panRight=function(){this.moveX(Camera.PAN_SPEED)};Camera.prototype.getX=function(){return this.x_};Camera.prototype.getY=function(){return this.y_};Camera.prototype.getWidth=function(){return this.width_};Camera.prototype.getHeight=function(){return this.height_};Camera.prototype.moveX=function(b){b=this.x_+b;this.x_=0>b?0:b>this.worldWidth_-this.width_?this.worldWidth_-this.width_:b;this.notifyChange()};
Camera.prototype.moveY=function(b){b=this.y_+b;this.y_=0>b?0:b>this.worldHeight_-this.height_?this.worldHeight_-this.height_:b;this.notifyChange()};function Map(b,k,p,q){this.base=Model;this.base.apply(this);this.tileWidth_=p;this.tileHeight_=q;this.width_=b;this.height_=k;this.tiles_=[];for(b=0;b<this.height_;b++)for(k=0;k<this.width_;k++)this.tiles_[this.toLinearIndex_(k,b)]=new Tile(p,q);console.log("map constructed with "+this.tiles_.length+" tiles")}window.inherits(Map,Model);Map.prototype.getWidth=function(){return this.width_};Map.prototype.getHeight=function(){return this.height_};
Map.prototype.forEachTile=function(b){for(var k=0;k<this.height_;k++)for(var p=0;p<this.width_;p++){var q=this.getTile(p,k);q&&b(q,p,k)}};Map.prototype.forEachTileInRect=function(b,k,p,q,n){var a=this.toTileX_(b);p=this.toTileX_(p)+a;b=this.toTileX_(k);q=this.toTileX_(q)+b+1;for(k=b;k<=q;k++)for(b=a;b<=p;b++){var c=this.getTile(b,k);c&&n(c,b,k)}};Map.prototype.isInMap=function(b,k){return 0<=b&&b<this.width_&&0<=k&&k<this.height_};Map.prototype.toTileX_=function(b){return Math.floor(b/this.tileWidth_)};
Map.prototype.toTileY_=function(b){return Math.floor(y/this.tileHeight_)};Map.prototype.randomTileX=function(){return Math.floor(Math.random()*this.width_)};Map.prototype.randomTileY=function(){return Math.floor(Math.random()*this.height_)};Map.prototype.toLinearIndex_=function(b,k){return Math.floor(k*this.width_+b)};Map.prototype.getTile=function(b,k){return this.isInMap(b,k)?this.tiles_[this.toLinearIndex_(b,k)]:null};function MarkovChain(b){this.transitionMatrix_=Array(b.length);this.stateToIndex_=[];this.indexToState_=[];for(var k=this.currentStateIndex_=0;k<b.length;k++){this.transitionMatrix_[k]=Array(b.length);this.stateToIndex_[b[k]]=k;this.indexToState_[k]=b[k];for(var p=0;p<b.length;p++)this.transitionMatrix_[k][p]=0}}MarkovChain.prototype.setProbability=function(b,k,p){this.transitionMatrix_[this.stateToIndex_[b]][this.stateToIndex_[k]]=p};MarkovChain.prototype.getProbability=function(b,k){return this.transitionMatrix_[this.stateToIndex_[b]][this.stateToIndex_[k]]};
MarkovChain.prototype.getNeighborProbabilities=function(b){b=this.stateToIndex_[b];for(var k=[],p=0;p<this.transitionMatrix_[b].length;p++)k.push(this.transitionMatrix_[b][p]);return k};MarkovChain.prototype.setCurrentState=function(b){this.currentStateIndex_=this.stateToIndex_[b]};MarkovChain.prototype.getCurrentState=function(){return this.indexToState_[this.currentStateIndex_]};
MarkovChain.prototype.update=function(){for(var b=this.getNeighborProbabilities(this.indexToState_[this.currentStateIndex_]),k=1;k<b.length;k++)b[k]+=b[k-1];for(var p=Math.random(),k=0;k<b.length;k++)if(p<b[k])return this.currentStateIndex_=k,this.indexToState_[k]};MarkovChain.prototype.getTransitionMatrix=function(){return this.transitionMatrix_};function Model(){this.views_=[]}Model.prototype.subscribeView=function(b){this.views_.push(b)};Model.prototype.notifyChange=function(){for(var b=0;b<this.views_.length;b++)this.views_[b].notify()};function PathGenerator(b){var k=this;if(PathGenerator.instance_)throw"Singleton already constructed";this.map_=b;console.log("constructing path finder..");this.pathFinder_=new EasyStar.js;console.log("Building collision map..");this.pathFinder_.setAcceptableTiles([0]);this.pathFinder_.setIterationsPerCalculation(2500);this.updateCollisionMap();console.log("setting path generator instance");PathGenerator.instance_=this;setInterval(function(){k.calculatePaths_()},300)}PathGenerator.instance_=null;
PathGenerator.getInstance=function(b){if(PathGenerator.instance_)return PathGenerator.instance_;if(!b)throw"No map model provided for construction!";return new PathGenerator(b)};PathGenerator.prototype.calculatePaths_=function(){this.pathFinder_.calculate()};
PathGenerator.prototype.buildCollisionMap_=function(){var b=[];console.log("building map now");this.map_.forEachTile(function(k,p,q){b.length<=q&&b.push([]);b[q][p]=0});console.log("done building map");console.log("collision map is dimension "+b[0].length+","+b.length);return b};PathGenerator.prototype.updateCollisionMap=function(){this.pathFinder_.setGrid(this.buildCollisionMap_())};
PathGenerator.prototype.makePath=function(b,k,p,q,n){this.map_.isInMap(b,k)&&this.map_.isInMap(p,q)&&this.pathFinder_.findPath(b,k,p,q,function(a){console.log("path calculated from "+b+","+k+" to "+p+","+q);if(null===a)n(null);else{for(var c=[],e={x:b,y:k},d=0;d<a.length;d++){var f=a[d];0!=e.x-f.x?e.x>f.x?c.push(PathGenerator.ManhattanDirection.MOVE_WEST):c.push(PathGenerator.ManhattanDirection.MOVE_EAST):e.y>f.y?c.push(PathGenerator.ManhattanDirection.MOVE_NORTH):c.push(PathGenerator.ManhattanDirection.MOVE_SOUTH);
e=f}n(c)}})};PathGenerator.prototype.movePhysicalModel=function(b,k){switch(k){case PathGenerator.ManhattanDirection.MOVE_NORTH:b.setY(b.getY()-1);break;case PathGenerator.ManhattanDirection.MOVE_SOUTH:b.setY(b.getY()+1);break;case PathGenerator.ManhattanDirection.MOVE_WEST:b.setX(b.getX()-1);break;case PathGenerator.ManhattanDirection.MOVE_EAST:b.setX(b.getX()+1)}};PathGenerator.ManhattanDirection={MOVE_NORTH:0,MOVE_WEST:1,MOVE_SOUTH:2,MOVE_EAST:3};function Tile(b,k){this.isOccupied_=!1;this.color_=.5<Math.random()?null:3385907;this.width_=b;this.height_=k}Tile.prototype.getWidth=function(){return this.width_};Tile.prototype.getHeight=function(){return this.height_};Tile.prototype.getColor=function(){return this.color_};Tile.prototype.isOccupied=function(){return this.isOccupied_};function WorkerColony(b){this.map_=b;this.workers_=new SpacialHash(this.map_.getWidth(),this.map_.getHeight(),9);this.workersArray_=[]}window.inherits(WorkerColony,Model);WorkerColony.prototype.addWorker=function(b){var k=this.map_.randomTileX(),p=this.map_.randomTileY();b.setX(k);b.setY(p);this.workers_.add(k,p,b);this.workersArray_.push(b)};WorkerColony.prototype.getWorkers=function(){return this.workers_};WorkerColony.prototype.update=function(){for(var b=0;b<this.workersArray_.length;b++)this.workersArray_[b].update(this.workers_)};function Worker(){this.base=Model;this.base.apply(this);this.y_=this.x_=0;this.canUpdateState_=!1;this.walkTimer_=0;this.states_={};for(var b in WorkerState.Types)this.states_[b]=new WorkerState(b,null);this.stateManager_=new MarkovChain(Object.keys(WorkerState.Types));b=WorkerState.Types.MOVE_TO;this.states_[b].setData({x:10,y:10});this.stateManager_.setCurrentState(b)}window.inherits(Worker,Model);Worker.SPEED=.1;
Worker.prototype.update=function(b){this.doStateAction();this.canUpdateState_&&(this.stateManager_.update(),this.onStateChange())};Worker.prototype.onStateChange=function(){var b=this.states_[this.stateManager_.getCurrentState()],k=b.getData(),p=b.getType();if(k)switch(p){case WorkerState.Types.MOVE_TO:PathGenerator.getInstance().makePath(this.x_,this.y_,k.x,k.y,function(p){k.iterator=p;b.setData(k)})}};
Worker.prototype.doStateAction=function(){var b=this.states_[this.stateManager_.getCurrentState()],k=b.getData(),b=b.getType();if(k)switch(b){case WorkerState.Types.MOVE_TO:k.iterator&&this.moveTowards(k.iterator)}};Worker.prototype.moveTowards=function(b){0<b.length&&(1<=this.walkTimer_&&(b=b.shift(),this.walkTimer_=0,PathGenerator.getInstance().movePhysicalModel(this,b),this.notifyChange()),this.walkTimer_+=Worker.SPEED)};Worker.prototype.getWidth=function(){return 1};
Worker.prototype.getHeight=function(){return 1};Worker.prototype.getX=function(){return this.x_};Worker.prototype.getY=function(){return this.y_};Worker.prototype.setX=function(b){this.x_=b};Worker.prototype.setY=function(b){this.y_=b};Worker.prototype.setState=function(b,k,p){this.states_[b].setData(k);p&&this.stateManager_.setProbability(b,p)};Worker.prototype.getMarkovChain=function(){return this.stateManager_};
Worker.prototype.updateMarkovChain=function(b){for(var k in WorkerState.Types)for(var p in WorkerState.Types){for(var q=0,n=0;n<b.length;n++)neighbor=b[n],q+=neighbor.getMarkovChain().getProbability(k,p);n=this.stateManager_.getProbability(k,p);q=(q+n)/(b.length+1);n=q-n;this.stateManager_.setProbability(k,p,q);var q=0,a;for(a in WorkerState.Types)a!=k&&(q+=this.stateManager_.getProbability(k,a));for(a in WorkerState.Types)if(a!=k){var c=this.stateManager_.getProbability(k,a);this.stateManager_.setProbability(k,
a,c-c/q*n)}}};function WorkerState(b,k){this.data_=k;this.type_=b}WorkerState.prototype.getData=function(){return this.data_};WorkerState.prototype.setData=function(b){this.data_=b};WorkerState.prototype.getType=function(){return this.type_};WorkerState.prototype.setType=function(b){this.type_=b};WorkerState.Types={MOVE_TO:"MOVE_TO"};"function"==typeof define&&define.amd&&define("easystar",[],function(){return EasyStar});"undefined"!=typeof module&&module.exports&&(module.exports=EasyStar);var EasyStar=EasyStar||{};EasyStar.Node=function(b,k,p,q,n){this.parent=b;this.x=k;this.y=p;this.costSoFar=q;this.simpleDistanceToTarget=n;this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}};EasyStar.Node.OPEN_LIST=0;EasyStar.Node.CLOSED_LIST=1;
EasyStar.PriorityQueue=function(b,k){this.length=0;var p=[],q=!1;if(k==EasyStar.PriorityQueue.MAX_HEAP)q=!0;else{if(k!=EasyStar.PriorityQueue.MIN_HEAP)throw k+" not supported.";q=!1}this.insert=function(a){if(!a.hasOwnProperty(b))throw"Cannot insert "+a+" because it does not have a property by the name of "+b+".";p.push(a);this.length++;n(this.length-1)};this.getHighestPriorityElement=function(){return p[0]};this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";
if(1===this.length){var c=p[0];return p=[],this.length=0,c}var c=p[0],b=p.pop();return this.length--,p[0]=b,a(0),c};var n=function(a){if(0!==a){var b=Math.floor(a/2)-1;e(a,b)&&(c(a,b),n(b))}},a=function(b){var f=2*b+1,h=2*b+2;e(f,b)?(c(b,f),a(f)):e(h,b)?(c(b,h),a(h)):0!=b&&a(0)},c=function(a,c){var b=p[a];p[a]=p[c];p[c]=b},e=function(a,c){if(void 0===p[c]||void 0===p[a])return!1;var e,g;return"function"==typeof p[a][b]?(e=p[a][b](),g=p[c][b]()):(e=p[a][b],g=p[c][b]),q?e>g?!0:!1:g>e?!0:!1}};
EasyStar.PriorityQueue.MAX_HEAP=0;EasyStar.PriorityQueue.MIN_HEAP=1;EasyStar.instance=function(){this.isDoneCalculating=!0;this.pointsToAvoid={};this.startX;this.callback;this.startY;this.endX;this.endY;this.nodeHash={};this.openList};
EasyStar.js=function(){var b,k,p,q={},n={},a=[],c=Number.MAX_VALUE,e=!1;this.setAcceptableTiles=function(a){a instanceof Array?p=a:!isNaN(parseFloat(a))&&isFinite(a)&&(p=[a])};this.enableDiagonals=function(){e=!0};this.disableDiagonals=function(){e=!1};this.setGrid=function(a){b=a;for(a=0;a<b.length;a++)for(var c=0;c<b[0].length;c++)n[b[a][c]]||(n[b[a][c]]=1)};this.setTileCost=function(a,c){n[a]=c};this.setIterationsPerCalculation=function(a){c=a};this.avoidAdditionalPoint=function(a,c){q[a+"_"+c]=
1};this.stopAvoidingAdditionalPoint=function(a,c){delete q[a+"_"+c]};this.stopAvoidingAllAdditionalPoints=function(){q={}};this.findPath=function(c,e,d,r,m){if(void 0===p)throw"You can't set a path without first calling setAcceptableTiles() on EasyStar.";if(void 0===b)throw"You can't set a path without first calling setGrid() on EasyStar.";if(0>c||0>e||0>d||0>d||c>b[0].length-1||e>b.length-1||d>b[0].length-1||r>b.length-1)throw"Your start or end point is outside the scope of your grid.";c===d&&e===
r&&m([]);for(var s=b[r][d],z=!1,k=0;k<p.length;k++)if(s===p[k]){z=!0;break}if(!1===z)return void m(null);s=new EasyStar.instance;s.openList=new EasyStar.PriorityQueue("bestGuessDistance",EasyStar.PriorityQueue.MIN_HEAP);s.isDoneCalculating=!1;s.nodeHash={};s.startX=c;s.startY=e;s.endX=d;s.endY=r;s.callback=m;s.openList.insert(f(s,s.startX,s.startY,null,10));a.push(s)};this.calculate=function(){if(0!==a.length&&void 0!==b&&void 0!==p)for(k=0;c>k&&0!==a.length;k++)if(0!==a[0].openList.length){var f=
a[0].openList.shiftHighestPriorityElement();(f.list=EasyStar.Node.CLOSED_LIST,0<f.y&&(d(a[0],f,0,-1,10*n[b[f.y-1][f.x]]),!0===a[0].isDoneCalculating))?a.shift():f.x<b[0].length-1&&(d(a[0],f,1,0,10*n[b[f.y][f.x+1]]),!0===a[0].isDoneCalculating)?a.shift():f.y<b.length-1&&(d(a[0],f,0,1,10*n[b[f.y+1][f.x]]),!0===a[0].isDoneCalculating)?a.shift():0<f.x&&(d(a[0],f,-1,0,10*n[b[f.y][f.x-1]]),!0===a[0].isDoneCalculating)?a.shift():e&&(0<f.x&&0<f.y&&(d(a[0],f,-1,-1,14*n[b[f.y-1][f.x-1]]),!0===a[0].isDoneCalculating)?
a.shift():f.x<b[0].length-1&&f.y<b.length-1&&(d(a[0],f,1,1,14*n[b[f.y+1][f.x+1]]),!0===a[0].isDoneCalculating)?a.shift():f.x<b[0].length-1&&0<f.y&&(d(a[0],f,1,-1,14*n[b[f.y-1][f.x+1]]),!0===a[0].isDoneCalculating)?a.shift():0<f.x&&f.y<b.length-1&&(d(a[0],f,-1,1,14*n[b[f.y+1][f.x-1]]),!0===a[0].isDoneCalculating)&&a.shift())}else a[0].callback(null),a.shift()};var d=function(a,c,e,d,m){e=c.x+e;d=c.y+d;if(a.endX===e&&a.endY===d){a.isDoneCalculating=!0;var s=[],z=0;s[z]={x:e,y:d};z++;s[z]={x:c.x,y:c.y};
z++;for(var k=c.parent;null!=k;)s[z]={x:k.x,y:k.y},z++,k=k.parent;s.reverse();a.callback(s)}if(void 0===q[e+"_"+d])for(s=0;s<p.length;s++)if(b[d][e]===p[s]){e=f(a,e,d,c,m);void 0===e.list?(e.list=EasyStar.Node.OPEN_LIST,a.openList.insert(e)):e.list===EasyStar.Node.OPEN_LIST&&c.costSoFar+m<e.costSoFar&&(e.costSoFar=c.costSoFar+m,e.parent=c);break}},f=function(a,c,b,e,d){if(void 0!==a.nodeHash[c+"_"+b])return a.nodeHash[c+"_"+b];var f;f=a.endX;var k=a.endY;f=10*Math.sqrt(Math.abs(f-c)*Math.abs(f-c)+
Math.abs(k-b)*Math.abs(k-b));e=new EasyStar.Node(e,c,b,null!==e?e.costSoFar+d:f,f);return a.nodeHash[c+"_"+b]=e,e}};/*

 pixi.js - v1.6.0
 Copyright (c) 2012-2014, Mat Groves
 http://goodboydigital.com/

 Compiled: 2014-07-18

 pixi.js is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php
*/
(function(){var b=b||{};b.WEBGL_RENDERER=0;b.CANVAS_RENDERER=1;b.VERSION="v1.6.1";b.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};b.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};b._UID=0;"undefined"!=typeof Float32Array?(b.Float32Array=Float32Array,b.Uint16Array=Uint16Array):(b.Float32Array=Array,b.Uint16Array=Array);b.INTERACTION_FREQUENCY=30;b.AUTO_PREVENT_DEFAULT=
!0;b.RAD_TO_DEG=180/Math.PI;b.DEG_TO_RAD=Math.PI/180;b.dontSayHello=!1;b.sayHello=function(a){b.dontSayHello||(-1<navigator.userAgent.toLowerCase().indexOf("chrome")?console.log.apply(console,["%c %c %c Pixi.js "+b.VERSION+" - "+a+"  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff",
"color: #ff2424; background: #fff"]):window.console&&console.log("Pixi.js "+b.VERSION+" - http://www.pixijs.com/"),b.dontSayHello=!0)};b.Point=function(a,c){this.x=a||0;this.y=c||0};b.Point.prototype.clone=function(){return new b.Point(this.x,this.y)};b.Point.prototype.set=function(a,c){this.x=a||0;this.y=c||(0!==c?this.x:0)};b.Point.prototype.constructor=b.Point;b.Rectangle=function(a,c,b,d){this.x=a||0;this.y=c||0;this.width=b||0;this.height=d||0};b.Rectangle.prototype.clone=function(){return new b.Rectangle(this.x,
this.y,this.width,this.height)};b.Rectangle.prototype.contains=function(a,c){if(0>=this.width||0>=this.height)return!1;var b=this.x;return a>=b&&a<=b+this.width&&(b=this.y,c>=b&&c<=b+this.height)?!0:!1};b.Rectangle.prototype.constructor=b.Rectangle;b.EmptyRectangle=new b.Rectangle(0,0,0,0);b.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],e=0,d=a.length;d>e;e+=2)c.push(new b.Point(a[e],a[e+1]));a=c}this.points=a};b.Polygon.prototype.clone=
function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c].clone());return new b.Polygon(a)};b.Polygon.prototype.contains=function(a,c){for(var b=!1,d=0,f=this.points.length-1;d<this.points.length;f=d++){var h=this.points[d].x,g=this.points[d].y,l=this.points[f].x,f=this.points[f].y;g>c!=f>c&&(l-h)*(c-g)/(f-g)+h>a&&(b=!b)}return b};b.Polygon.prototype.constructor=b.Polygon;b.Circle=function(a,c,b){this.x=a||0;this.y=c||0;this.radius=b||0};b.Circle.prototype.clone=function(){return new b.Circle(this.x,
this.y,this.radius)};b.Circle.prototype.contains=function(a,c){if(0>=this.radius)return!1;var b=this.x-a,d=this.y-c,f=this.radius*this.radius;return b*=b,d*=d,f>=b+d};b.Circle.prototype.getBounds=function(){return new b.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)};b.Circle.prototype.constructor=b.Circle;b.Ellipse=function(a,c,b,d){this.x=a||0;this.y=c||0;this.width=b||0;this.height=d||0};b.Ellipse.prototype.clone=function(){return new b.Ellipse(this.x,this.y,this.width,
this.height)};b.Ellipse.prototype.contains=function(a,c){if(0>=this.width||0>=this.height)return!1;var b=(a-this.x)/this.width,d=(c-this.y)/this.height;return b*=b,d*=d,1>=b+d};b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};b.Ellipse.prototype.constructor=b.Ellipse;b.Matrix=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0};b.Matrix.prototype.fromArray=function(a){this.a=a[0];this.b=a[1];this.c=a[3];this.d=
a[4];this.tx=a[2];this.ty=a[5]};b.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var c=this.array;return a?(c[0]=this.a,c[1]=this.c,c[2]=0,c[3]=this.b,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty,c[8]=1):(c[0]=this.a,c[1]=this.b,c[2]=this.tx,c[3]=this.c,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0,c[8]=1),c};b.identityMatrix=new b.Matrix;b.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array};b.Matrix2=b.determineMatrixArrayType();
b.DisplayObject=function(){this.position=new b.Point;this.scale=new b.Point(1,1);this.pivot=new b.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=this.buttonMode=!1;this.stage=this.parent=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new b.Matrix;this.color=[];this.dynamic=!0;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new b.Rectangle(0,0,1,1);this._mask=this._currentBounds=null;this._cacheIsDirty=
this._cacheAsBitmap=!1};b.DisplayObject.prototype.constructor=b.DisplayObject;b.DisplayObject.prototype.setInteractive=function(a){this.interactive=a};Object.defineProperty(b.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}});Object.defineProperty(b.DisplayObject.prototype,
"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1);(this._mask=a)&&(this._mask.isMask=!0)}});Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var c=[],b=0;b<a.length;b++)for(var d=a[b].passes,f=0;f<d.length;f++)c.push(d[f]);this._filterBlock={target:this,filterPasses:c}}this._filters=a}});Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},
set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}});b.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,c=this.worldTransform,b=this.pivot.x,d=this.pivot.y,f=this._cr*this.scale.x,h=-this._sr*this.scale.y,g=this._sr*this.scale.x,l=this._cr*this.scale.y,r=
this.position.x-f*b-d*h,b=this.position.y-l*d-b*g,d=a.a,m=a.b,s=a.c,k=a.d;c.a=d*f+m*g;c.b=d*h+m*l;c.tx=d*r+m*b+a.tx;c.c=s*f+k*g;c.d=s*h+k*l;c.ty=s*r+k*b+a.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};b.DisplayObject.prototype.getBounds=function(a){return b.EmptyRectangle};b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)};b.DisplayObject.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0)};b.DisplayObject.prototype.generateTexture=
function(a){var c=this.getLocalBounds();a=new b.RenderTexture(0|c.width,0|c.height,a);return a.render(this,new b.Point(-c.x,-c.y)),a};b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};b.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha;a.gl?b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)};b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=
!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var c=new b.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new b.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}c=this._filters;this._filters=null;this._cachedSprite.filters=c;this._cachedSprite.texture.render(this,new b.Point(-a.x,-a.y));this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=c;this._cacheAsBitmap=
!0};b.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};b.DisplayObject.prototype._renderWebGL=function(a){};b.DisplayObject.prototype._renderCanvas=function(a){};Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=
a}});b.DisplayObjectContainer=function(){b.DisplayObject.call(this);this.children=[]};b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype);b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer;Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var c=this.getLocalBounds().width;this.scale.x=0!==c?a/(c/this.scale.x):1;this._width=a}});Object.defineProperty(b.DisplayObjectContainer.prototype,
"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var c=this.getLocalBounds().height;this.scale.y=0!==c?a/(c/this.scale.y):1;this._height=a}});b.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};b.DisplayObjectContainer.prototype.addChildAt=function(a,c){if(0<=c&&c<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(c,0,a),this.stage&&a.setStageReference(this.stage),
a;throw Error(a+" The index "+c+" supplied is out of bounds "+this.children.length);};b.DisplayObjectContainer.prototype.swapChildren=function(a,c){if(a!==c){var b=this.children.indexOf(a),d=this.children.indexOf(c);if(0>b||0>d)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[b]=c;this.children[d]=a}};b.DisplayObjectContainer.prototype.getChildAt=function(a){if(0<=a&&a<this.children.length)return this.children[a];throw Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller");
};b.DisplayObjectContainer.prototype.removeChild=function(a){return this.removeChildAt(this.children.indexOf(a))};b.DisplayObjectContainer.prototype.removeChildAt=function(a){var c=this.getChildAt(a);return this.stage&&c.removeStageReference(),c.parent=void 0,this.children.splice(a,1),c};b.DisplayObjectContainer.prototype.removeChildren=function(a,c){var b=a||0,d="number"==typeof c?c:this.children.length,f=d-b;if(0<f&&d>=f){b=this.children.splice(b,f);for(d=0;d<b.length;d++)f=b[d],this.stage&&f.removeStageReference(),
f.parent=void 0;return b}throw Error("Range Error, numeric values are outside the acceptable range");};b.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(b.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform()};b.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return b.EmptyRectangle;if(a){var c=this.worldTransform;this.worldTransform=a;this.updateTransform();
this.worldTransform=c}for(var e,d,f,c=1/0,h=1/0,g=-1/0,l=-1/0,r=!1,m=0,s=this.children.length;s>m;m++)this.children[m].visible&&(r=!0,e=this.children[m].getBounds(a),c=c<e.x?c:e.x,h=h<e.y?h:e.y,d=e.width+e.x,f=e.height+e.y,g=g>d?g:d,l=l>f?l:f);if(!r)return b.EmptyRectangle;a=this._bounds;return a.x=c,a.y=h,a.width=g-c,a.height=l-h,a};b.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=b.identityMatrix;for(var c=0,e=this.children.length;e>c;c++)this.children[c].updateTransform();
c=this.getBounds();return this.worldTransform=a,c};b.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0);for(var c=0,b=this.children.length;b>c;c++)this.children[c].setStageReference(a)};b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,c=this.children.length;c>a;a++)this.children[a].removeStageReference();this._interactive&&(this.stage.dirty=!0);this.stage=null};b.DisplayObjectContainer.prototype._renderWebGL=
function(a){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;var c,b;if(this._mask||this._filters){this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());c=0;for(b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();
a.spriteBatch.start()}else for(c=0,b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a)}};b.DisplayObjectContainer.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var c=0,b=this.children.length;b>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Sprite=function(a){b.DisplayObjectContainer.call(this);
this.anchor=new b.Point;this.texture=a;this._height=this._width=0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL;a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0};b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Sprite.prototype.constructor=b.Sprite;Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*
this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});b.Sprite.prototype.setTexture=function(a){this.texture=a;this.cachedTint=16777215};b.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=
this._height/this.texture.frame.height)};b.Sprite.prototype.getBounds=function(a){var c=this.texture.frame.width,b=this.texture.frame.height,d=c*(1-this.anchor.x),f=c*-this.anchor.x,h=b*(1-this.anchor.y),g=b*-this.anchor.y;a=a||this.worldTransform;var l=a.a,r=a.c,m=a.b,s=a.d,k=a.tx,A=a.ty;a=l*f+m*g+k;var b=s*g+r*f+A,c=l*d+m*g+k,g=s*g+r*d+A,n=l*d+m*h+k,d=s*h+r*d+A,l=l*f+m*h+k,f=s*h+r*f+A,h=-1/0,r=-1/0,s=1/0,m=1/0,s=s>a?a:s,s=s>c?c:s,s=s>n?n:s,s=s>l?l:s,m=m>b?b:m,m=m>g?g:m,m=m>d?d:m,m=m>f?f:m,h=a>h?
a:h,h=c>h?c:h,h=n>h?n:h,r=b>r?b:r,r=g>r?g:r,r=d>r?d:r;a=this._bounds;return a.x=s,a.width=(l>h?l:h)-s,a.y=m,a.height=(f>r?f:r)-m,this._currentBounds=a,a};b.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha)){var c,b;if(this._mask||this._filters){var d=a.spriteBatch;this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start());d.render(this);c=0;for(b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a);
d.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();d.start()}else for(a.spriteBatch.render(this),c=0,b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a)}};b.Sprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),
this.texture.valid){a.context.globalAlpha=this.worldAlpha;a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty);a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,
a.context[a.smoothProperty]=a.scaleMode===b.scaleModes.LINEAR);var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,e=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,
this.texture.crop.height,c,e,this.texture.crop.width,this.texture.crop.height)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c,e,this.texture.crop.width,this.texture.crop.height)}c=0;for(e=this.children.length;e>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Sprite.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw Error('The frameId "'+a+'" does not exist in the texture cache'+
this);return new b.Sprite(c)};b.Sprite.fromImage=function(a,c,e){a=b.Texture.fromImage(a,c,e);return new b.Sprite(a)};b.SpriteBatch=function(a){b.DisplayObjectContainer.call(this);this.textureThing=a;this.ready=!1};b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype);b.SpriteBatch.constructor=b.SpriteBatch;b.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(a);this.ready=!0};b.SpriteBatch.prototype.updateTransform=function(){b.DisplayObject.prototype.updateTransform.call(this)};
b.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())};b.SpriteBatch.prototype._renderCanvas=function(a){var c=a.context;c.globalAlpha=this.worldAlpha;b.DisplayObject.prototype.updateTransform.call(this);for(var e=this.worldTransform,d=!0,f=0;f<this.children.length;f++){var h=
this.children[f];if(h.visible){var g=h.texture,l=g.frame;if(c.globalAlpha=this.worldAlpha*h.alpha,0===h.rotation%(2*Math.PI))d&&(c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),d=!1),c.drawImage(g.baseTexture.source,l.x,l.y,l.width,l.height,h.anchor.x*-l.width*h.scale.x+h.position.x+.5|0,h.anchor.y*-l.height*h.scale.y+h.position.y+.5|0,l.width*h.scale.x,l.height*h.scale.y);else{d||(d=!0);b.DisplayObject.prototype.updateTransform.call(h);var r=h.worldTransform;a.roundPixels?c.setTransform(r.a,r.c,r.b,r.d,
0|r.tx,0|r.ty):c.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty);c.drawImage(g.baseTexture.source,l.x,l.y,l.width,l.height,h.anchor.x*-l.width+.5|0,h.anchor.y*-l.height+.5|0,l.width,l.height)}}}};b.MovieClip=function(a){b.Sprite.call(this,a[0]);this.textures=a;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this.currentFrame=0;this.playing=!1};b.MovieClip.prototype=Object.create(b.Sprite.prototype);b.MovieClip.prototype.constructor=b.MovieClip;Object.defineProperty(b.MovieClip.prototype,"totalFrames",
{get:function(){return this.textures.length}});b.MovieClip.prototype.stop=function(){this.playing=!1};b.MovieClip.prototype.play=function(){this.playing=!0};b.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1;this.currentFrame=a;this.setTexture(this.textures[(this.currentFrame+.5|0)%this.textures.length])};b.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a;this.playing=!0};b.MovieClip.prototype.updateTransform=function(){if(b.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=
this.animationSpeed;var a=this.currentFrame+.5|0;this.currentFrame%=this.textures.length;this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}};b.MovieClip.fromFrames=function(a){for(var c=[],e=0;e<a.length;e++)c.push(new b.Texture.fromFrame(a[e]));return new b.MovieClip(c)};b.MovieClip.fromImages=function(a){for(var c=[],e=0;e<a.length;e++)c.push(new b.Texture.fromImage(a[e]));
return new b.MovieClip(c)};b.FilterBlock=function(){this.renderable=this.visible=!0};b.Text=function(a,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");b.Sprite.call(this,b.Texture.fromCanvas(this.canvas));this.setText(a);this.setStyle(c)};b.Text.prototype=Object.create(b.Sprite.prototype);b.Text.prototype.constructor=b.Text;Object.defineProperty(b.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},
set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(b.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});b.Text.prototype.setStyle=function(a){a=a||{};a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=
a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowAngle=a.dropShadowAngle||Math.PI/6;a.dropShadowDistance=a.dropShadowDistance||4;a.dropShadowColor=a.dropShadowColor||"black";this.style=a;this.dirty=!0};b.Text.prototype.setText=function(a){this.text=a.toString()||" ";this.dirty=!0};b.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));
for(var a=a.split(/(?:\r\n|\r|\n)/),c=[],b=0,d=0;d<a.length;d++){var f=this.context.measureText(a[d]).width;c[d]=f;b=Math.max(b,f)}d=b+this.style.strokeThickness;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.width=d+this.context.lineWidth;f=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;d=f*a.length;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.height=d;navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,
this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var h,g;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;for(var l=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,r=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*f,"right"===
this.style.align?h+=b-c[d]:"center"===this.style.align&&(h+=(b-c[d])/2),this.style.fill&&this.context.fillText(a[d],h+l,g+r)}this.context.fillStyle=this.style.fill;for(d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*f,"right"===this.style.align?h+=b-c[d]:"center"===this.style.align&&(h+=(b-c[d])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(a[d],h,g),this.style.fill&&this.context.fillText(a[d],h,g);this.updateTexture()};b.Text.prototype.updateTexture=
function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=!0};b.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,b.updateWebGLTexture(this.texture.baseTexture,a.gl));b.Sprite.prototype._renderWebGL.call(this,
a)};b.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);b.Sprite.prototype.updateTransform.call(this)};b.Text.prototype.determineFontHeight=function(a){var c=b.Text.heightCache[a];if(!c){var e=document.getElementsByTagName("body")[0],d=document.createElement("div"),c=document.createTextNode("M");d.appendChild(c);d.setAttribute("style",a+";position:absolute;top:0;left:0");e.appendChild(d);c=d.offsetHeight;b.Text.heightCache[a]=c;e.removeChild(d)}return c};b.Text.prototype.wordWrap=
function(a){var c="";a=a.split("\n");for(var b=0;b<a.length;b++){for(var d=this.style.wordWrapWidth,f=a[b].split(" "),h=0;h<f.length;h++){var g=this.context.measureText(f[h]).width,l=g+this.context.measureText(" ").width;0===h||l>d?(0<h&&(c+="\n"),c+=f[h],d=this.style.wordWrapWidth-g):(d-=l,c+=" "+f[h])}b<a.length-1&&(c+="\n")}return c};b.Text.prototype.destroy=function(a){this.canvas=this.context=null;this.texture.destroy(void 0===a?!0:a)};b.Text.heightCache={};b.BitmapText=function(a,c){b.DisplayObjectContainer.call(this);
this._pool=[];this.setText(a);this.setStyle(c);this.updateText();this.dirty=!1};b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setText=function(a){this.text=a||" ";this.dirty=!0};b.BitmapText.prototype.setStyle=function(a){a=a||{};a.align=a.align||"left";this.style=a;var c=a.font.split(" ");this.fontName=c[c.length-1];this.fontSize=2<=c.length?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size;
this.dirty=!0;this.tint=a.tint};b.BitmapText.prototype.updateText=function(){for(var a=b.BitmapText.fonts[this.fontName],c=new b.Point,e=null,d=[],f=0,h=[],g=0,l=this.fontSize/a.size,r=0;r<this.text.length;r++){var m=this.text.charCodeAt(r);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(r)))h.push(c.x),f=Math.max(f,c.x),g++,c.x=0,c.y+=a.lineHeight,e=null;else{var s=a.chars[m];s&&(e&&s[e]&&(c.x+=s.kerning[e]),d.push({texture:s.texture,line:g,charCode:m,position:new b.Point(c.x+s.xOffset,c.y+s.yOffset)}),
c.x+=s.xAdvance,e=m)}}h.push(c.x);f=Math.max(f,c.x);e=[];for(r=0;g>=r;r++)m=0,"right"===this.style.align?m=f-h[r]:"center"===this.style.align&&(m=(f-h[r])/2),e.push(m);g=this.children.length;h=d.length;m=this.tint||16777215;for(r=0;h>r;r++)(s=g>r?this.children[r]:this._pool.pop())?s.setTexture(d[r].texture):s=new b.Sprite(d[r].texture),s.position.x=(d[r].position.x+e[d[r].line])*l,s.position.y=d[r].position.y*l,s.scale.x=s.scale.y=l,s.tint=m,s.parent||this.addChild(s);for(;this.children.length>h;)d=
this.getChildAt(this.children.length-1),this._pool.push(d),this.removeChild(d);this.textWidth=f*l;this.textHeight=(c.y+a.lineHeight)*l};b.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.BitmapText.fonts={};b.InteractionData=function(){this.global=new b.Point;this.originalEvent=this.target=null};b.InteractionData.prototype.getLocalPosition=function(a){var c=a.worldTransform;a=this.global;
var e=c.a,d=c.b,f=c.tx,h=c.c,g=c.d,c=c.ty,l=1/(e*g+d*-h);return new b.Point(g*l*a.x+-d*l*a.y+(c*d-f*g)*l,e*l*a.y+-h*l*a.x+(-c*e+f*h)*l)};b.InteractionData.prototype.constructor=b.InteractionData;b.InteractionManager=function(a){this.stage=a;this.mouse=new b.InteractionData;this.touchs={};this.tempPoint=new b.Point;this.mouseoverEnabled=!0;this.pool=[];this.interactiveItems=[];this.interactionDOMElement=null;this.onMouseMove=this.onMouseMove.bind(this);this.onMouseDown=this.onMouseDown.bind(this);
this.onMouseOut=this.onMouseOut.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this.mouseOut=!1};b.InteractionManager.prototype.constructor=b.InteractionManager;b.InteractionManager.prototype.collectInteractiveSprite=function(a,c){for(var b=a.children,d=b.length-1;0<=d;d--){var f=b[d];f._interactive?(c.interactiveChildren=
!0,this.interactiveItems.push(f),0<f.children.length&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,0<f.children.length&&this.collectInteractiveSprite(f,c))}};b.InteractionManager.prototype.setTarget=function(a){this.target=a;null===this.interactionDOMElement&&this.setTargetDomElement(a.view)};b.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents();window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none");this.interactionDOMElement=
a;a.addEventListener("mousemove",this.onMouseMove,!0);a.addEventListener("mousedown",this.onMouseDown,!0);a.addEventListener("mouseout",this.onMouseOut,!0);a.addEventListener("touchstart",this.onTouchStart,!0);a.addEventListener("touchend",this.onTouchEnd,!0);a.addEventListener("touchmove",this.onTouchMove,!0);window.addEventListener("mouseup",this.onMouseUp,!0)};b.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]=
"",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",
this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))};b.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),c=a-this.last;if(c=c*b.INTERACTION_FREQUENCY/1E3,!(1>c)){this.last=a;a=0;this.dirty&&this.rebuildInteractiveGraph();for(var c=this.interactiveItems.length,e="inherit",d=!1,a=0;c>a;a++){var f=this.interactiveItems[a];f.__hit=this.hitTest(f,this.mouse);this.mouse.target=f;f.__hit&&!d?(f.buttonMode&&(e=f.defaultCursor),
f.interactiveChildren||(d=!0),f.__isOver||(f.mouseover&&f.mouseover(this.mouse),f.__isOver=!0)):f.__isOver&&(f.mouseout&&f.mouseout(this.mouse),f.__isOver=!1)}this.currentCursorStyle!==e&&(this.currentCursorStyle=e,this.interactionDOMElement.style.cursor=e)}}};b.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,c=0;a>c;c++)this.interactiveItems[c].interactiveChildren=!1;this.interactiveItems=[];this.stage.interactive&&this.interactiveItems.push(this.stage);
this.collectInteractiveSprite(this.stage,this.stage)};b.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;var c=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=this.target.width/c.width*(a.clientX-c.left);this.mouse.global.y=this.target.height/c.height*(a.clientY-c.top);a=this.interactiveItems.length;for(c=0;a>c;c++){var b=this.interactiveItems[c];b.mousemove&&b.mousemove(this.mouse)}};b.InteractionManager.prototype.onMouseDown=
function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;b.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();a=this.interactiveItems.length;for(var c=0;a>c;c++){var e=this.interactiveItems[c];if((e.mousedown||e.click)&&(e.__mouseIsDown=!0,e.__hit=this.hitTest(e,this.mouse),e.__hit&&(e.mousedown&&e.mousedown(this.mouse),e.__isDown=!0,!e.interactiveChildren)))break}};b.InteractionManager.prototype.onMouseOut=function(){this.dirty&&this.rebuildInteractiveGraph();
var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var c=0;a>c;c++){var b=this.interactiveItems[c];b.__isOver&&(this.mouse.target=b,b.mouseout&&b.mouseout(this.mouse),b.__isOver=!1)}this.mouseOut=!0;this.mouse.global.x=-1E4;this.mouse.global.y=-1E4};b.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;a=this.interactiveItems.length;for(var c=!1,b=0;a>b;b++){var d=this.interactiveItems[b];
d.__hit=this.hitTest(d,this.mouse);d.__hit&&!c?(d.mouseup&&d.mouseup(this.mouse),d.__isDown&&d.click&&d.click(this.mouse),d.interactiveChildren||(c=!0)):d.__isDown&&d.mouseupoutside&&d.mouseupoutside(this.mouse);d.__isDown=!1}};b.InteractionManager.prototype.hitTest=function(a,c){var e=c.global;if(!a.worldVisible)return!1;var d=a instanceof b.Sprite,f=a.worldTransform,h=f.a,g=f.b,l=f.tx,r=f.c,m=f.d,f=f.ty,s=1/(h*m+g*-r),g=m*s*e.x+-g*s*e.y+(f*g-l*m)*s,e=h*s*e.y+-r*s*e.x+(-f*h+l*r)*s;if(c.target=a,
a.hitArea&&a.hitArea.contains)return a.hitArea.contains(g,e)?(c.target=a,!0):!1;if(d){var k,d=a.texture.frame.width,h=a.texture.frame.height,l=-d*a.anchor.x;if(g>l&&l+d>g&&(k=-h*a.anchor.y,e>k&&k+h>e))return c.target=a,!0}k=a.children.length;for(d=0;k>d;d++)if(this.hitTest(a.children[d],c))return c.target=a,!0;return!1};b.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var c,b=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,
f=0,f=0;f<d.length;f++){var h=d[f];c=this.touchs[h.identifier];c.originalEvent=a||window.event;c.global.x=this.target.width/b.width*(h.clientX-b.left);c.global.y=this.target.height/b.height*(h.clientY-b.top);navigator.isCocoonJS&&(c.global.x=h.clientX,c.global.y=h.clientY);for(var g=0;g<this.interactiveItems.length;g++){var l=this.interactiveItems[g];l.touchmove&&l.__touchData&&l.__touchData[h.identifier]&&l.touchmove(c)}}};b.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();
var c=this.interactionDOMElement.getBoundingClientRect();b.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var e=a.changedTouches,d=0;d<e.length;d++){var f=e[d],h=this.pool.pop();h||(h=new b.InteractionData);h.originalEvent=a||window.event;this.touchs[f.identifier]=h;h.global.x=this.target.width/c.width*(f.clientX-c.left);h.global.y=this.target.height/c.height*(f.clientY-c.top);navigator.isCocoonJS&&(h.global.x=f.clientX,h.global.y=f.clientY);for(var g=this.interactiveItems.length,l=0;g>l;l++){var r=
this.interactiveItems[l];if((r.touchstart||r.tap)&&(r.__hit=this.hitTest(r,h),r.__hit&&(r.touchstart&&r.touchstart(h),r.__isDown=!0,r.__touchData=r.__touchData||{},r.__touchData[f.identifier]=h,!r.interactiveChildren)))break}}};b.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var c=this.interactionDOMElement.getBoundingClientRect(),b=a.changedTouches,d=0;d<b.length;d++){var f=b[d],h=this.touchs[f.identifier],g=!1;h.global.x=this.target.width/c.width*
(f.clientX-c.left);h.global.y=this.target.height/c.height*(f.clientY-c.top);navigator.isCocoonJS&&(h.global.x=f.clientX,h.global.y=f.clientY);for(var l=this.interactiveItems.length,r=0;l>r;r++){var m=this.interactiveItems[r];m.__touchData&&m.__touchData[f.identifier]&&(m.__hit=this.hitTest(m,m.__touchData[f.identifier]),h.originalEvent=a||window.event,(m.touchend||m.tap)&&(m.__hit&&!g?(m.touchend&&m.touchend(h),m.__isDown&&m.tap&&m.tap(h),m.interactiveChildren||(g=!0)):m.__isDown&&m.touchendoutside&&
m.touchendoutside(h),m.__isDown=!1),m.__touchData[f.identifier]=null)}this.pool.push(h);this.touchs[f.identifier]=null}};b.Stage=function(a){b.DisplayObjectContainer.call(this);this.worldTransform=new b.Matrix;this.interactive=!0;this.interactionManager=new b.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new b.Rectangle(0,0,1E5,1E5);this.setBackgroundColor(a)};b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.setInteractionDelegate=
function(a){this.interactionManager.setTargetDomElement(a)};b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()};b.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0;this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);a=this.backgroundColor.toString(16);a="000000".substr(0,
6-a.length)+a;this.backgroundColorString="#"+a};b.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var k=0,p=["ms","moz","webkit","o"],q=0;q<p.length&&!window.requestAnimationFrame;++q)window.requestAnimationFrame=window[p[q]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[p[q]+"CancelAnimationFrame"]||window[p[q]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),
b=Math.max(0,16-(c-k)),d=window.setTimeout(function(){a(c+b)},b);return k=c+b,d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.requestAnimFrame=window.requestAnimationFrame;b.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};b.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]};"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(c){function b(){var h=
f.concat(a.call(arguments));d.apply(this instanceof b?this:c,h)}var d=this,f=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return b.prototype=function g(a){return a&&(g.prototype=a),this instanceof g?void 0:new g}(d.prototype),b}}());b.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var c=0;c<a.length;c++)try{return new window.ActiveXObject(a[c])}catch(b){}};
b.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1;a.height=1;a=a.getContext("2d");return a.fillStyle="#000",a.fillRect(0,0,1,1),a.globalCompositeOperation="multiply",a.fillStyle="#fff",a.fillRect(0,0,1,1),0===a.getImageData(0,0,1,1).data[0]};b.getNextPowerOfTwo=function(a){if(0<a&&0===(a&a-1))return a;for(var c=1;a>c;)c<<=1;return c};b.EventTarget=function(){var a={};this.addEventListener=this.on=function(c,b){void 0===a[c]&&(a[c]=[]);-1===a[c].indexOf(b)&&a[c].unshift(b)};
this.dispatchEvent=this.emit=function(c){if(a[c.type]&&a[c.type].length)for(var b=a[c.type].length-1;0<=b;b--)a[c.type][b](c)};this.removeEventListener=this.off=function(c,b){if(void 0!==a[c]){var d=a[c].indexOf(b);-1!==d&&a[c].splice(d,1)}};this.removeAllEventListeners=function(c){(c=a[c])&&(c.length=0)}};b.autoDetectRenderer=function(a,c,e,d,f){a||(a=800);c||(c=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(l){h=
!1}return h?new b.WebGLRenderer(a,c,e,d,f):new b.CanvasRenderer(a,c,e,d)};b.autoDetectRecommendedRenderer=function(a,c,e,d,f){a||(a=800);c||(c=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(l){h=!1}g=/Android/i.test(navigator.userAgent);return h&&!g?new b.WebGLRenderer(a,c,e,d,f):new b.CanvasRenderer(a,c,e,d)};b.PolyK={};b.PolyK.Triangulate=function(a){var c=!0,e=a.length>>1;if(3>e)return[];
for(var d=[],f=[],h=0;e>h;h++)f.push(h);for(var h=0,g=e;3<g;){var l=f[(h+0)%g],r=f[(h+1)%g],m=f[(h+2)%g],s=a[2*l],k=a[2*l+1],n=a[2*r],p=a[2*r+1],v=a[2*m],t=a[2*m+1],u=!1;if(b.PolyK._convex(s,k,n,p,v,t,c))for(var u=!0,q=0;g>q;q++){var x=f[q];if(x!==l&&x!==r&&x!==m&&b.PolyK._PointInTriangle(a[2*x],a[2*x+1],s,k,n,p,v,t)){u=!1;break}}if(u)d.push(l,r,m),f.splice((h+1)%g,1),g--,h=0;else if(h++>3*g){if(!c)return window.console.log("PIXI Warning: shape too complex to fill"),[];d=[];f=[];for(h=0;e>h;h++)f.push(h);
h=0;g=e;c=!1}}return d.push(f[0],f[1],f[2]),d};b.PolyK._PointInTriangle=function(a,c,b,d,f,h,g,l){g-=b;l-=d;f-=b;h-=d;a-=b;b=c-d;c=g*g+l*l;d=g*f+l*h;g=g*a+l*b;l=f*f+h*h;f=f*a+h*b;h=1/(c*l-d*d);l=(l*g-d*f)*h;g=(c*f-d*g)*h;return 0<=l&&0<=g&&1>l+g};b.PolyK._convex=function(a,c,b,d,f,h,g){return 0<=(c-d)*(f-b)+(b-a)*(h-d)===g};b.initDefaultShaders=function(){};b.CompileVertexShader=function(a,c){return b._CompileShader(a,c,a.VERTEX_SHADER)};b.CompileFragmentShader=function(a,c){return b._CompileShader(a,
c,a.FRAGMENT_SHADER)};b._CompileShader=function(a,c,b){c=c.join("\n");b=a.createShader(b);return a.shaderSource(b,c),a.compileShader(b),a.getShaderParameter(b,a.COMPILE_STATUS)?b:(window.console.log(a.getShaderInfoLog(b)),null)};b.compileProgram=function(a,c,e){e=b.CompileFragmentShader(a,e);c=b.CompileVertexShader(a,c);var d=a.createProgram();return a.attachShader(d,c),a.attachShader(d,e),a.linkProgram(d),a.getProgramParameter(d,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),
d};b.PixiShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};b.PixiShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=
a.getUniformLocation(c,"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.dimensions=a.getUniformLocation(c,"dimensions");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.colorAttribute=a.getAttribLocation(c,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];
for(var e in this.uniforms)this.uniforms[e].uniformLocation=a.getUniformLocation(c,e);this.initUniforms();this.program=c};b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,c=this.gl,b;for(b in this.uniforms){a=this.uniforms[b];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=c.uniformMatrix2fv:"mat3"===d?a.glFunc=c.uniformMatrix3fv:"mat4"===d&&(a.glFunc=c.uniformMatrix4fv)):
(a.glFunc=c["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}};b.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var c=this.gl;if(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]),a.textureData){var b=a.textureData,d=b.magFilter?b.magFilter:c.LINEAR,f=b.minFilter?b.minFilter:c.LINEAR,h=b.wrapS?b.wrapS:c.CLAMP_TO_EDGE,g=b.wrapT?
b.wrapT:c.CLAMP_TO_EDGE,l=b.luminance?c.LUMINANCE:c.RGBA;(b.repeat&&(h=c.REPEAT,g=c.REPEAT),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!!b.flipY),b.width)?c.texImage2D(c.TEXTURE_2D,0,l,b.width?b.width:512,b.height?b.height:2,b.border?b.border:0,l,c.UNSIGNED_BYTE,null):c.texImage2D(c.TEXTURE_2D,0,l,c.RGBA,c.UNSIGNED_BYTE,a.value.baseTexture.source);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,f);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,h);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_WRAP_T,g)}c.uniform1i(a.uniformLocation,this.textureCount);a._init=!0;this.textureCount++}};b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,c=this.gl,e;for(e in this.uniforms)a=this.uniforms[e],1===a.glValueLength?!0===a.glMatrix?a.glFunc.call(c,a.uniformLocation,a.transpose,a.value):a.glFunc.call(c,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,
a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]||b.createWebGLTexture(a.value.baseTexture,c)),c.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))};b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=
this.uniforms=null};b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;",
"   vColor = vec4(color * aColor.x, aColor.x);","}"];b.PixiFastShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;",
"attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};b.PixiFastShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=a.getUniformLocation(c,"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.dimensions=a.getUniformLocation(c,"dimensions");this.uMatrix=a.getUniformLocation(c,"uMatrix");this.aVertexPosition=
a.getAttribLocation(c,"aVertexPosition");this.aPositionCoord=a.getAttribLocation(c,"aPositionCoord");this.aScale=a.getAttribLocation(c,"aScale");this.aRotation=a.getAttribLocation(c,"aRotation");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.colorAttribute=a.getAttribLocation(c,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=c};b.PixiFastShader.prototype.destroy=
function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};b.StripShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;",
"uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};b.StripShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=a.getUniformLocation(c,
"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.colorAttribute=a.getAttribLocation(c,"aColor");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader=
function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);",
"   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};b.PrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.tintColor=a.getUniformLocation(c,"tint");this.aVertexPosition=
a.getAttribLocation(c,"aVertexPosition");this.colorAttribute=a.getAttribLocation(c,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};b.ComplexPrimitiveShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=
["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);",
"   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};b.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.tintColor=a.getUniformLocation(c,"tint");this.color=a.getUniformLocation(c,"color");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.attributes=[this.aVertexPosition,
this.colorAttribute];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};b.WebGLGraphics=function(){};b.WebGLGraphics.renderGraphics=function(a,c){var e,d=c.gl,f=c.projection,h=c.offset,g=c.shaderManager.primitiveShader;a.dirty&&b.WebGLGraphics.updateGraphics(a,d);for(var l=a._webGL[d.id],r=0;r<
l.data.length;r++)1===l.data[r].mode?(e=l.data[r],c.stencilManager.pushStencil(a,e,c),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(e.indices.length-4)),c.stencilManager.popStencil(a,e,c),this.last=e.mode):(e=l.data[r],c.shaderManager.setShader(g),g=c.shaderManager.primitiveShader,d.uniformMatrix3fv(g.translationMatrix,!1,a.worldTransform.toArray(!0)),d.uniform2f(g.projectionVector,f.x,-f.y),d.uniform2f(g.offsetVector,-h.x,-h.y),d.uniform3fv(g.tintColor,b.hex2rgb(a.tint)),d.uniform1f(g.alpha,
a.worldAlpha),d.bindBuffer(d.ARRAY_BUFFER,e.buffer),d.vertexAttribPointer(g.aVertexPosition,2,d.FLOAT,!1,24,0),d.vertexAttribPointer(g.colorAttribute,4,d.FLOAT,!1,24,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e.indexBuffer),d.drawElements(d.TRIANGLE_STRIP,e.indices.length,d.UNSIGNED_SHORT,0))};b.WebGLGraphics.updateGraphics=function(a,c){var e=a._webGL[c.id];e||(e=a._webGL[c.id]={lastIndex:0,data:[],gl:c});a.dirty=!1;var d;if(a.clearDirty){a.clearDirty=!1;for(d=0;d<e.data.length;d++){var f=e.data[d];
f.reset();b.WebGLGraphics.graphicsDataPool.push(f)}e.data=[];e.lastIndex=0}var h;for(d=e.lastIndex;d<a.graphicsData.length;d++)f=a.graphicsData[d],f.type===b.Graphics.POLY?(f.fill&&6<f.points.length&&(10<f.points.length?(h=b.WebGLGraphics.switchMode(e,1),b.WebGLGraphics.buildComplexPoly(f,h)):(h=b.WebGLGraphics.switchMode(e,0),b.WebGLGraphics.buildPoly(f,h))),0<f.lineWidth&&(h=b.WebGLGraphics.switchMode(e,0),b.WebGLGraphics.buildLine(f,h))):(h=b.WebGLGraphics.switchMode(e,0),f.type===b.Graphics.RECT?
b.WebGLGraphics.buildRectangle(f,h):f.type===b.Graphics.CIRC||f.type===b.Graphics.ELIP?b.WebGLGraphics.buildCircle(f,h):f.type===b.Graphics.RREC&&b.WebGLGraphics.buildRoundedRectangle(f,h)),e.lastIndex++;for(d=0;d<e.data.length;d++)h=e.data[d],h.dirty&&h.upload()};b.WebGLGraphics.switchMode=function(a,c){var e;return a.data.length?(e=a.data[a.data.length-1],(e.mode!==c||1===c)&&(e=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),e.mode=c,a.data.push(e))):(e=b.WebGLGraphics.graphicsDataPool.pop()||
new b.WebGLGraphicsData(a.gl),e.mode=c,a.data.push(e)),e.dirty=!0,e};b.WebGLGraphics.buildRectangle=function(a,c){var e=a.points,d=e[0],f=e[1],h=e[2],e=e[3];if(a.fill){var g=b.hex2rgb(a.fillColor),l=a.fillAlpha,r=g[0]*l,m=g[1]*l,g=g[2]*l,s=c.points,k=c.indices,n=s.length/6;s.push(d,f);s.push(r,m,g,l);s.push(d+h,f);s.push(r,m,g,l);s.push(d,f+e);s.push(r,m,g,l);s.push(d+h,f+e);s.push(r,m,g,l);k.push(n,n,n+1,n+2,n+3,n+3)}a.lineWidth&&(l=a.points,a.points=[d,f,d+h,f,d+h,f+e,d,f+e,d,f],b.WebGLGraphics.buildLine(a,
c),a.points=l)};b.WebGLGraphics.buildRoundedRectangle=function(a,c){var e=a.points,d=e[0],f=e[1],h=e[2],g=e[3],l=e[4],e=[];if(e.push(d,f+l),e=e.concat(b.WebGLGraphics.quadraticBezierCurve(d,f+g-l,d,f+g,d+l,f+g)),e=e.concat(b.WebGLGraphics.quadraticBezierCurve(d+h-l,f+g,d+h,f+g,d+h,f+g-l)),e=e.concat(b.WebGLGraphics.quadraticBezierCurve(d+h,f+l,d+h,f,d+h-l,f)),e=e.concat(b.WebGLGraphics.quadraticBezierCurve(d+l,f,d,f,d,f+l)),a.fill){for(var g=b.hex2rgb(a.fillColor),d=a.fillAlpha,f=g[0]*d,h=g[1]*d,
g=g[2]*d,l=c.points,r=c.indices,m=l.length/6,s=b.PolyK.Triangulate(e),k=0,k=0;k<s.length;k+=3)r.push(s[k]+m),r.push(s[k]+m),r.push(s[k+1]+m),r.push(s[k+2]+m),r.push(s[k+2]+m);for(k=0;k<e.length;k++)l.push(e[k],e[++k],f,h,g,d)}a.lineWidth&&(d=a.points,a.points=e,b.WebGLGraphics.buildLine(a,c),a.points=d)};b.WebGLGraphics.quadraticBezierCurve=function(a,c,b,d,f,h){for(var g,l,r,m,s=[],k=0,n=0;20>=n;n++)k=n/20,g=a+(b-a)*k,l=c+(d-c)*k,r=b+(f-b)*k,m=d+(h-d)*k,g+=(r-g)*k,l+=(m-l)*k,s.push(g,l);return s};
b.WebGLGraphics.buildCircle=function(a,c){var e=a.points,d=e[0],f=e[1],h=e[2],e=e[3],g=2*Math.PI/40,l=0;if(a.fill){var l=b.hex2rgb(a.fillColor),r=a.fillAlpha,m=l[0]*r,s=l[1]*r,k=l[2]*r,n=c.points,p=c.indices,v=n.length/6;p.push(v);for(l=0;41>l;l++)n.push(d,f,m,s,k,r),n.push(d+Math.sin(g*l)*h,f+Math.cos(g*l)*e,m,s,k,r),p.push(v++,v++);p.push(v-1)}if(a.lineWidth){r=a.points;a.points=[];for(l=0;41>l;l++)a.points.push(d+Math.sin(g*l)*h,f+Math.cos(g*l)*e);b.WebGLGraphics.buildLine(a,c);a.points=r}};b.WebGLGraphics.buildLine=
function(a,c){var e=0,d=a.points;if(0!==d.length){if(a.lineWidth%2)for(e=0;e<d.length;e++)d[e]+=.5;var f=new b.Point(d[0],d[1]),h=new b.Point(d[d.length-2],d[d.length-1]);if(f.x===h.x&&f.y===h.y){d=d.slice();d.pop();d.pop();var h=new b.Point(d[d.length-2],d[d.length-1]),g=h.x+.5*(f.x-h.x),f=h.y+.5*(f.y-h.y);d.unshift(g,f);d.push(g,f)}var l,r,m,s,k,n,p,v,t,u,q,x,H,I,K,L,M,O,C,g=c.points,f=c.indices,h=d.length/2,P=d.length,N=g.length/6,J=a.lineWidth/2,e=b.hex2rgb(a.lineColor),D=a.lineAlpha,E=e[0]*D,
F=e[1]*D,G=e[2]*D;m=d[0];s=d[1];k=d[2];n=d[3];t=-(s-n);u=m-k;C=Math.sqrt(t*t+u*u);t=t/C*J;u=u/C*J;g.push(m-t,s-u,E,F,G,D);g.push(m+t,s+u,E,F,G,D);for(e=1;h-1>e;e++)m=d[2*(e-1)],s=d[2*(e-1)+1],k=d[2*e],n=d[2*e+1],p=d[2*(e+1)],v=d[2*(e+1)+1],t=-(s-n),u=m-k,C=Math.sqrt(t*t+u*u),t/=C,u/=C,t*=J,u*=J,q=-(n-v),x=k-p,C=Math.sqrt(q*q+x*x),q/=C,x/=C,q*=J,x*=J,K=-u+s-(-u+n),L=-t+k-(-t+m),m=(-t+m)*(-u+n)-(-t+k)*(-u+s),s=-x+v-(-x+n),M=-q+k-(-q+p),p=(-q+p)*(-x+n)-(-q+k)*(-x+v),v=K*M-s*L,.1>Math.abs(v)?(g.push(k-
t,n-u,E,F,G,D),g.push(k+t,n+u,E,F,G,D)):(l=(L*p-M*m)/v,r=(s*m-K*p)/v,O=(l-k)*(l-k)+(r-n)+(r-n),19600<O?(H=t-q,I=u-x,C=Math.sqrt(H*H+I*I),H/=C,I/=C,H*=J,I*=J,g.push(k-H,n-I),g.push(E,F,G,D),g.push(k+H,n+I),g.push(E,F,G,D),g.push(k-H,n-I),g.push(E,F,G,D),P++):(g.push(l,r),g.push(E,F,G,D),g.push(k-(l-k),n-(r-n)),g.push(E,F,G,D)));m=d[2*(h-2)];s=d[2*(h-2)+1];k=d[2*(h-1)];n=d[2*(h-1)+1];t=-(s-n);u=m-k;C=Math.sqrt(t*t+u*u);t/=C;u/=C;t*=J;u*=J;g.push(k-t,n-u);g.push(E,F,G,D);g.push(k+t,n+u);g.push(E,F,G,
D);f.push(N);for(e=0;P>e;e++)f.push(N++);f.push(N-1)}};b.WebGLGraphics.buildComplexPoly=function(a,c){var e=a.points.slice();if(!(6>e.length)){var d=c.indices;c.points=e;c.alpha=a.fillAlpha;c.color=b.hex2rgb(a.fillColor);for(var f,h,g=1/0,l=-1/0,r=1/0,m=-1/0,k=0;k<e.length;k+=2)f=e[k],h=e[k+1],g=g>f?f:g,l=f>l?f:l,r=r>h?h:r,m=h>m?h:m;e.push(g,r,l,r,l,m,g,m);e=e.length/2;for(k=0;e>k;k++)d.push(k)}};b.WebGLGraphics.buildPoly=function(a,c){var e=a.points;if(!(6>e.length)){for(var d=c.points,f=c.indices,
h=e.length/2,g=b.hex2rgb(a.fillColor),l=a.fillAlpha,r=g[0]*l,m=g[1]*l,g=g[2]*l,k=b.PolyK.Triangulate(e),n=d.length/6,p=0,p=0;p<k.length;p+=3)f.push(k[p]+n),f.push(k[p]+n),f.push(k[p+1]+n),f.push(k[p+2]+n),f.push(k[p+2]+n);for(p=0;h>p;p++)d.push(e[2*p],e[2*p+1],r,m,g,l)}};b.WebGLGraphics.graphicsDataPool=[];b.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.lastIndex=0;this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=
1;this.dirty=!0};b.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];this.lastIndex=0};b.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1};b.glContexts=
[];b.WebGLRenderer=function(a,c,e,d,f,h){b.defaultRenderer||(b.sayHello("webGL"),b.defaultRenderer=this);this.type=b.WEBGL_RENDERER;this.transparent=!!d;this.preserveDrawingBuffer=h;this.width=a||800;this.height=c||600;this.view=e||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,!1);
this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1);this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!d,stencil:!0,preserveDrawingBuffer:h};var g=null;if(["experimental-webgl","webgl"].forEach(function(a){try{g=g||this.view.getContext(a,this.options)}catch(c){}},this),!g)throw Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=g;this.glContextId=g.id=b.WebGLRenderer.glContextId++;b.glContexts[this.glContextId]=
g;b.blendModesWebGL||(b.blendModesWebGL=[],b.blendModesWebGL[b.blendModes.NORMAL]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.ADD]=[g.SRC_ALPHA,g.DST_ALPHA],b.blendModesWebGL[b.blendModes.MULTIPLY]=[g.DST_COLOR,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SCREEN]=[g.SRC_ALPHA,g.ONE],b.blendModesWebGL[b.blendModes.OVERLAY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DARKEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LIGHTEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_BURN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DIFFERENCE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.EXCLUSION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HUE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
b.blendModesWebGL[b.blendModes.SATURATION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LUMINOSITY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA]);this.projection=new b.Point;this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new b.Point(0,0);this.resize(this.width,this.height);this.contextLost=!1;this.shaderManager=new b.WebGLShaderManager(g);this.spriteBatch=new b.WebGLSpriteBatch(g);this.maskManager=new b.WebGLMaskManager(g);
this.filterManager=new b.WebGLFilterManager(g,this.transparent);this.stencilManager=new b.WebGLStencilManager(g);this.blendModeManager=new b.WebGLBlendModeManager(g);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;
this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;g.useProgram(this.shaderManager.defaultShader.program);g.disable(g.DEPTH_TEST);g.disable(g.CULL_FACE);g.enable(g.BLEND);g.colorMask(!0,!0,!0,this.transparent)};b.WebGLRenderer.prototype.constructor=b.WebGLRenderer;b.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a);b.WebGLRenderer.updateTextures();a.updateTransform();
a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var c=this.gl;c.viewport(0,0,this.width,this.height);c.bindFramebuffer(c.FRAMEBUFFER,null);this.transparent?c.clearColor(0,0,0,0):c.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1);c.clear(c.COLOR_BUFFER_BIT);this.renderDisplayObject(a,this.projection);a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):
a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}};b.WebGLRenderer.prototype.renderDisplayObject=function(a,c,e){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=c;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,e);a._renderWebGL(this.renderSession);this.spriteBatch.end()};
b.WebGLRenderer.updateTextures=function(){for(var a=0,a=0;a<b.Texture.frameUpdates.length;a++)b.WebGLRenderer.updateTextureFrame(b.Texture.frameUpdates[a]);for(a=0;a<b.texturesToDestroy.length;a++)b.WebGLRenderer.destroyTexture(b.texturesToDestroy[a]);b.texturesToUpdate.length=0;b.texturesToDestroy.length=0;b.Texture.frameUpdates.length=0};b.WebGLRenderer.destroyTexture=function(a){for(var c=a._glTextures.length-1;0<=c;c--){var e=a._glTextures[c],d=b.glContexts[c];d&&e&&d.deleteTexture(e)}a._glTextures.length=
0};b.WebGLRenderer.updateTextureFrame=function(a){a._updateWebGLuvs()};b.WebGLRenderer.prototype.resize=function(a,c){this.width=a;this.height=c;this.view.width=a;this.view.height=c;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};b.createWebGLTexture=function(a,c){return a.hasLoaded&&(a._glTextures[c.id]=c.createTexture(),c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),
c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,
c.CLAMP_TO_EDGE)),c.bindTexture(c.TEXTURE_2D,null),a._dirty[c.id]=!1),a._glTextures[c.id]};b.updateWebGLTexture=function(a,c){a._glTextures[c.id]&&(c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===
b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),a._dirty[c.id]=!1)};b.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault();this.contextLost=!0};b.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",
this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(c){throw Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}var e=this.gl;e.id=b.WebGLRenderer.glContextId++;this.shaderManager.setContext(e);this.spriteBatch.setContext(e);this.primitiveBatch.setContext(e);this.maskManager.setContext(e);this.filterManager.setContext(e);this.renderSession.gl=this.gl;e.disable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.enable(e.BLEND);e.colorMask(!0,!0,
!0,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(var d in b.TextureCache)b.TextureCache[d].baseTexture._glTextures=[];this.contextLost=!1};b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);this.offset=this.projection=b.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.primitiveBatch.destroy();
this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=null};b.WebGLRenderer.glContextId=0;b.WebGLBlendModeManager=function(a){this.gl=a;this.currentBlendMode=99999};b.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=b.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(a[0],a[1]),!0};b.WebGLBlendModeManager.prototype.destroy=
function(){this.gl=null};b.WebGLMaskManager=function(a){this.maskStack=[];this.maskPosition=0;this.setContext(a);this.reverse=!1;this.count=0};b.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};b.WebGLMaskManager.prototype.pushMask=function(a,c){var e=c.gl;a.dirty&&b.WebGLGraphics.updateGraphics(a,e);a._webGL[e.id].data.length&&c.stencilManager.pushStencil(a,a._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.popMask=function(a,c){c.stencilManager.popStencil(a,a._webGL[this.gl.id].data[0],
c)};b.WebGLMaskManager.prototype.destroy=function(){this.gl=this.maskStack=null};b.WebGLStencilManager=function(a){this.stencilStack=[];this.setContext(a);this.reverse=!0;this.count=0};b.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};b.WebGLStencilManager.prototype.pushStencil=function(a,c,b){var d=this.gl;this.bindGraphics(a,c,b);0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(c);a=this.count;
d.colorMask(!1,!1,!1,!1);d.stencilFunc(d.ALWAYS,0,255);d.stencilOp(d.KEEP,d.KEEP,d.INVERT);1===c.mode?(d.drawElements(d.TRIANGLE_FAN,c.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(c.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(a+1),255):d.stencilFunc(d.EQUAL,a+1,255),this.reverse=!this.reverse):
(this.reverse?(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,c.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,a+1,255):d.stencilFunc(d.EQUAL,255-(a+1),255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);this.count++};b.WebGLStencilManager.prototype.bindGraphics=function(a,c,e){this._currentGraphics=a;var d,f=this.gl,h=e.projection,g=e.offset;1===
c.mode?(d=e.shaderManager.complexPrimativeShader,e.shaderManager.setShader(d),f.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(d.projectionVector,h.x,-h.y),f.uniform2f(d.offsetVector,-g.x,-g.y),f.uniform3fv(d.tintColor,b.hex2rgb(a.tint)),f.uniform3fv(d.color,c.color),f.uniform1f(d.alpha,a.worldAlpha*c.alpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(d.aVertexPosition,2,f.FLOAT,!1,8,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer)):(d=e.shaderManager.primitiveShader,
e.shaderManager.setShader(d),f.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(d.projectionVector,h.x,-h.y),f.uniform2f(d.offsetVector,-g.x,-g.y),f.uniform3fv(d.tintColor,b.hex2rgb(a.tint)),f.uniform1f(d.alpha,a.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(d.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(d.colorAttribute,4,f.FLOAT,!1,24,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer))};b.WebGLStencilManager.prototype.popStencil=
function(a,c,b){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var f=this.count;this.bindGraphics(a,c,b);d.colorMask(!1,!1,!1,!1);1===c.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(f+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,f+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(c.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,
d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,c.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,f,255):d.stencilFunc(d.EQUAL,255-f,255)):(this.reverse?(d.stencilFunc(d.EQUAL,f+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(f+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,c.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,f,255):d.stencilFunc(d.EQUAL,255-f,255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,
d.KEEP,d.KEEP)}};b.WebGLStencilManager.prototype.destroy=function(){this.gl=this.maskStack=null};b.WebGLShaderManager=function(a){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];this.shaderMap=[];for(var c=0;c<this.maxAttibs;c++)this.attribState[c]=!1;this.setContext(a)};b.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new b.PrimitiveShader(a);this.complexPrimativeShader=new b.ComplexPrimitiveShader(a);this.defaultShader=new b.PixiShader(a);this.fastShader=
new b.PixiFastShader(a);this.stripShader=new b.StripShader(a);this.setShader(this.defaultShader)};b.WebGLShaderManager.prototype.setAttribs=function(a){var c;for(c=0;c<this.tempAttribState.length;c++)this.tempAttribState[c]=!1;for(c=0;c<a.length;c++)this.tempAttribState[a[c]]=!0;a=this.gl;for(c=0;c<this.attribState.length;c++)this.attribState[c]!==this.tempAttribState[c]&&(this.attribState[c]=this.tempAttribState[c],this.tempAttribState[c]?a.enableVertexAttribArray(c):a.disableVertexAttribArray(c))};
b.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)};b.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};b.WebGLSpriteBatch=function(a){this.vertSize=6;this.size=2E3;var c=6*this.size;this.vertices=
new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(c);for(var b=this.lastIndexCount=0,d=0;c>b;b+=6,d+=4)this.indices[b+0]=d+0,this.indices[b+1]=d+1,this.indices[b+2]=d+2,this.indices[b+3]=d+0,this.indices[b+4]=d+2,this.indices[b+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(a);this.dirty=!0;this.textures=[];this.blendModes=[]};b.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=
a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999};b.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};b.WebGLSpriteBatch.prototype.end=function(){this.flush()};b.WebGLSpriteBatch.prototype.render=
function(a){var c=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=c.baseTexture);var b=c._uvs;if(b){var d,f,h,g,l=a.worldAlpha,r=a.tint,m=this.vertices;f=a.anchor.x;g=a.anchor.y;c.trim?(h=c.trim,f=h.x-f*h.width,d=f+c.crop.width,g=h.y-g*h.height,h=g+c.crop.height):(d=c.frame.width*(1-f),f=c.frame.width*-f,h=c.frame.height*(1-g),g=c.frame.height*-g);var c=4*this.currentBatchSize*this.vertSize,k=a.worldTransform,n=k.a,p=k.c,q=k.b,v=k.d,t=k.tx,k=k.ty;m[c++]=n*f+q*g+t;
m[c++]=v*g+p*f+k;m[c++]=b.x0;m[c++]=b.y0;m[c++]=l;m[c++]=r;m[c++]=n*d+q*g+t;m[c++]=v*g+p*d+k;m[c++]=b.x1;m[c++]=b.y1;m[c++]=l;m[c++]=r;m[c++]=n*d+q*h+t;m[c++]=v*h+p*d+k;m[c++]=b.x2;m[c++]=b.y2;m[c++]=l;m[c++]=r;m[c++]=n*f+q*h+t;m[c++]=v*h+p*f+k;m[c++]=b.x3;m[c++]=b.y3;m[c++]=l;m[c++]=r;this.textures[this.currentBatchSize]=a.texture.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++}};b.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var c=a.tilingTexture;
this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=c.baseTexture);a._uvs||(a._uvs=new b.TextureUvs);var e=a._uvs;a.tilePosition.x%=c.baseTexture.width*a.tileScaleOffset.x;a.tilePosition.y%=c.baseTexture.height*a.tileScaleOffset.y;var d=a.tilePosition.x/(c.baseTexture.width*a.tileScaleOffset.x),f=a.tilePosition.y/(c.baseTexture.height*a.tileScaleOffset.y),h=a.width/c.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),g=a.height/c.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);
e.x0=0-d;e.y0=0-f;e.x1=1*h-d;e.y1=0-f;e.x2=1*h-d;e.y2=1*g-f;e.x3=0-d;e.y3=1*g-f;var d=a.worldAlpha,f=a.tint,h=this.vertices,l=a.width,r=a.height,m=a.anchor.x,k=a.anchor.y,g=l*(1-m),l=l*-m,m=r*(1-k),r=r*-k,k=4*this.currentBatchSize*this.vertSize,n=a.worldTransform,p=n.a,q=n.c,v=n.b,t=n.d,u=n.tx,n=n.ty;h[k++]=p*l+v*r+u;h[k++]=t*r+q*l+n;h[k++]=e.x0;h[k++]=e.y0;h[k++]=d;h[k++]=f;h[k++]=p*g+v*r+u;h[k++]=t*r+q*g+n;h[k++]=e.x1;h[k++]=e.y1;h[k++]=d;h[k++]=f;h[k++]=p*g+v*m+u;h[k++]=t*m+q*g+n;h[k++]=e.x2;h[k++]=
e.y2;h[k++]=d;h[k++]=f;h[k++]=p*l+v*m+u;h[k++]=t*m+q*l+n;h[k++]=e.x3;h[k++]=e.y3;h[k++]=d;h[k++]=f;this.textures[this.currentBatchSize]=c.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++};b.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,8);a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,c,16)}this.currentBatchSize>.5*this.size?a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices):(c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),
a.bufferSubData(a.ARRAY_BUFFER,0,c));for(var b=0,d=0,f=null,h=this.renderSession.blendModeManager.currentBlendMode,g=0,l=this.currentBatchSize;l>g;g++)a=this.textures[g],c=this.blendModes[g],f===a&&h===c||(this.renderBatch(f,b,d),d=g,b=0,f=a,h=c,this.renderSession.blendModeManager.setBlendMode(h)),b++;this.renderBatch(f,b,d);this.currentBatchSize=0}};b.WebGLSpriteBatch.prototype.renderBatch=function(a,c,e){if(0!==c){var d=this.gl;d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]||b.createWebGLTexture(a,
d));a._dirty[d.id]&&b.updateWebGLTexture(this.currentBaseTexture,d);d.drawElements(d.TRIANGLES,6*c,d.UNSIGNED_SHORT,12*e);this.renderSession.drawCount++}};b.WebGLSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};b.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};b.WebGLFastSpriteBatch=function(a){this.vertSize=
10;this.size=this.maxSize=6E3;var c=6*this.maxSize;this.vertices=new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(c);this.indexBuffer=this.vertexBuffer=null;for(var b=this.lastIndexCount=0,d=0;c>b;b+=6,d+=4)this.indices[b+0]=d+0,this.indices[b+1]=d+1,this.indices[b+2]=d+2,this.indices[b+3]=d+0,this.indices[b+4]=d+2,this.indices[b+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;
this.setContext(a)};b.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};b.WebGLFastSpriteBatch.prototype.begin=function(a,c){this.renderSession=c;this.shader=this.renderSession.shaderManager.fastShader;
this.matrix=a.worldTransform.toArray(!0);this.start()};b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.render=function(a){a=a.children;var c=a[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture;c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var c=0,b=a.length;b>c;c++)this.renderSprite(a[c]);this.flush()}};b.WebGLFastSpriteBatch.prototype.renderSprite=
function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var c,b,d,f,h,g,l=this.vertices;(c=a.texture._uvs,a.texture.trim)?(f=a.texture.trim,d=f.x-a.anchor.x*f.width,b=d+a.texture.crop.width,h=f.y-a.anchor.y*f.height,f=h+a.texture.crop.height):(b=a.texture.frame.width*(1-a.anchor.x),d=a.texture.frame.width*-a.anchor.x,f=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y);g=4*this.currentBatchSize*
this.vertSize;l[g++]=d;l[g++]=h;l[g++]=a.position.x;l[g++]=a.position.y;l[g++]=a.scale.x;l[g++]=a.scale.y;l[g++]=a.rotation;l[g++]=c.x0;l[g++]=c.y1;l[g++]=a.alpha;l[g++]=b;l[g++]=h;l[g++]=a.position.x;l[g++]=a.position.y;l[g++]=a.scale.x;l[g++]=a.scale.y;l[g++]=a.rotation;l[g++]=c.x1;l[g++]=c.y1;l[g++]=a.alpha;l[g++]=b;l[g++]=f;l[g++]=a.position.x;l[g++]=a.position.y;l[g++]=a.scale.x;l[g++]=a.scale.y;l[g++]=a.rotation;l[g++]=c.x2;l[g++]=c.y2;l[g++]=a.alpha;l[g++]=d;l[g++]=f;l[g++]=a.position.x;l[g++]=
a.position.y;l[g++]=a.scale.x;l[g++]=a.scale.y;l[g++]=a.rotation;l[g++]=c.x3;l[g++]=c.y3;l[g++]=a.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};b.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,
0,this.vertices);else{var c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);
var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28);a.vertexAttribPointer(this.shader.colorAttribute,
1,a.FLOAT,!1,c,36)};b.WebGLFilterManager=function(a,c){this.transparent=c;this.filterStack=[];this.offsetY=this.offsetX=0;this.setContext(a)};b.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};b.WebGLFilterManager.prototype.begin=function(a,c){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var b=this.renderSession.projection;this.width=2*b.x;this.height=2*-b.y;this.buffer=c};b.WebGLFilterManager.prototype.pushFilter=
function(a){var c=this.gl,e=this.renderSession.projection,d=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var h=this.texturePool.pop();h?h.resize(this.width,this.height):h=new b.FilterTexture(this.gl,this.width,this.height);c.bindTexture(c.TEXTURE_2D,h.texture);var g=a._filterArea,f=f.padding;g.x-=f;g.y-=f;g.width+=2*f;g.height+=2*f;0>g.x&&(g.x=0);g.width>
this.width&&(g.width=this.width);0>g.y&&(g.y=0);g.height>this.height&&(g.height=this.height);c.bindFramebuffer(c.FRAMEBUFFER,h.frameBuffer);c.viewport(0,0,g.width,g.height);e.x=g.width/2;e.y=-g.height/2;d.x=-g.x;d.y=-g.y;this.renderSession.shaderManager.setShader(this.defaultShader);c.uniform2f(this.defaultShader.projectionVector,g.width/2,-g.height/2);c.uniform2f(this.defaultShader.offsetVector,-g.x,-g.y);c.colorMask(!0,!0,!0,!0);c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT);a._glFilterTexture=
h};b.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,c=this.filterStack.pop(),e=c._filterArea,d=c._glFilterTexture,f=this.renderSession.projection,h=this.renderSession.offset;if(1<c.filterPasses.length){a.viewport(0,0,e.width,e.height);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=e.height;this.vertexArray[2]=e.width;this.vertexArray[3]=e.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=e.width;this.vertexArray[7]=0;
a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=e.width/this.width;this.uvArray[5]=e.height/this.height;this.uvArray[6]=e.width/this.width;this.uvArray[7]=e.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var g=this.texturePool.pop();g||(g=new b.FilterTexture(this.gl,this.width,this.height));g.resize(this.width,this.height);a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var l=
0;l<c.filterPasses.length-1;l++){var k=c.filterPasses[l];a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(k,e,e.width,e.height);k=d;d=g;g=k}a.enable(a.BLEND);this.texturePool.push(g)}g=c.filterPasses[c.filterPasses.length-1];this.offsetX-=e.x;this.offsetY-=e.y;var l=this.width,k=this.height,m=0,n=0,p=this.buffer;0===this.filterStack.length?a.colorMask(!0,!0,!0,!0):(p=this.filterStack[this.filterStack.length-1],e=
p._filterArea,l=e.width,k=e.height,m=e.x,n=e.y,p=p._glFilterTexture.frameBuffer);f.x=l/2;f.y=-k/2;h.x=m;h.y=n;e=c._filterArea;f=e.x-m;h=e.y-n;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=f;this.vertexArray[1]=h+e.height;this.vertexArray[2]=f+e.width;this.vertexArray[3]=h+e.height;this.vertexArray[4]=f;this.vertexArray[5]=h;this.vertexArray[6]=f+e.width;this.vertexArray[7]=h;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=
e.width/this.width;this.uvArray[5]=e.height/this.height;this.uvArray[6]=e.width/this.width;this.uvArray[7]=e.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,l,k);a.bindFramebuffer(a.FRAMEBUFFER,p);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(g,e,l,k);this.renderSession.shaderManager.setShader(this.defaultShader);a.uniform2f(this.defaultShader.projectionVector,l/2,-k/2);a.uniform2f(this.defaultShader.offsetVector,-m,-n);this.texturePool.push(d);
c._glFilterTexture=null};b.WebGLFilterManager.prototype.applyFilterPass=function(a,c,e,d){c=this.gl;var f=a.shaders[c.id];f||(f=new b.PixiShader(c),f.fragmentSrc=a.fragmentSrc,f.uniforms=a.uniforms,f.init(),a.shaders[c.id]=f);this.renderSession.shaderManager.setShader(f);c.uniform2f(f.projectionVector,e/2,-d/2);c.uniform2f(f.offsetVector,0,0);a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],
a.uniforms.dimensions.value[3]=this.vertexArray[5]);f.syncUniforms();c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.vertexAttribPointer(f.aTextureCoord,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.vertexAttribPointer(f.colorAttribute,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);this.renderSession.drawCount++};
b.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvArray,
a.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};b.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null;for(var c=this.offsetY=this.offsetX=0;c<this.texturePool.length;c++)this.texturePool[c].destroy();
this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};b.FilterTexture=function(a,c,e,d){this.gl=a;this.frameBuffer=a.createFramebuffer();this.texture=a.createTexture();d=d||b.scaleModes.DEFAULT;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d===b.scaleModes.LINEAR?
a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);this.renderBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,
this.renderBuffer);this.resize(c,e)};b.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};b.FilterTexture.prototype.resize=function(a,c){if(this.width!==a||this.height!==c){this.width=a;this.height=c;var b=this.gl;b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,a,c,0,b.RGBA,b.UNSIGNED_BYTE,null);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,a,c)}};b.FilterTexture.prototype.destroy=
function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.texture=this.frameBuffer=null};b.CanvasMaskManager=function(){};b.CanvasMaskManager.prototype.pushMask=function(a,c){c.save();var e=a.alpha,d=a.worldTransform;c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty);b.CanvasGraphics.renderGraphicsMask(a,c);c.clip();a.worldAlpha=e};b.CanvasMaskManager.prototype.popMask=function(a){a.restore()};b.CanvasTinter=function(){};b.CanvasTinter.getTintedTexture=function(a,c){var e=
a.texture;c=b.CanvasTinter.roundColor(c);var d="#"+("00000"+(0|c).toString(16)).substr(-6);if(e.tintCache=e.tintCache||{},e.tintCache[d])return e.tintCache[d];var f=b.CanvasTinter.canvas||document.createElement("canvas");if(b.CanvasTinter.tintMethod(e,c,f),b.CanvasTinter.convertTintToImage){var h=new Image;h.src=f.toDataURL();e.tintCache[d]=h}else e.tintCache[d]=f,b.CanvasTinter.canvas=null;return f};b.CanvasTinter.tintWithMultiply=function(a,c,b){var d=b.getContext("2d"),f=a.frame;b.width=f.width;
b.height=f.height;d.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6);d.fillRect(0,0,f.width,f.height);d.globalCompositeOperation="multiply";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithOverlay=function(a,c,b){var d=b.getContext("2d"),f=a.frame;b.width=f.width;b.height=f.height;d.globalCompositeOperation="copy";
d.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6);d.fillRect(0,0,f.width,f.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithPerPixel=function(a,c,e){var d=e.getContext("2d"),f=a.frame;e.width=f.width;e.height=f.height;d.globalCompositeOperation="copy";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);e=b.hex2rgb(c);a=e[0];c=e[1];e=e[2];for(var f=d.getImageData(0,
0,f.width,f.height),h=f.data,g=0;g<h.length;g+=4)h[g+0]*=a,h[g+1]*=c,h[g+2]*=e;d.putImageData(f,0,0)};b.CanvasTinter.roundColor=function(a){var c=b.CanvasTinter.cacheStepsPerColorChannel;a=b.hex2rgb(a);return a[0]=Math.min(255,a[0]/c*c),a[1]=Math.min(255,a[1]/c*c),a[2]=Math.min(255,a[2]/c*c),b.rgb2hex(a)};b.CanvasTinter.cacheStepsPerColorChannel=8;b.CanvasTinter.convertTintToImage=!1;b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes();b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?
b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel;b.CanvasRenderer=function(a,c,e,d){b.defaultRenderer||(b.sayHello("Canvas"),b.defaultRenderer=this);this.type=b.CANVAS_RENDERER;this.clearBeforeRender=!0;this.transparent=!!d;b.blendModesCanvas||(b.blendModesCanvas=[],b.canUseNewCanvasBlendModes()?(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply",b.blendModesCanvas[b.blendModes.SCREEN]=
"screen",b.blendModesCanvas[b.blendModes.OVERLAY]="overlay",b.blendModesCanvas[b.blendModes.DARKEN]="darken",b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge",b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light",b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference",b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion",
b.blendModesCanvas[b.blendModes.HUE]="hue",b.blendModesCanvas[b.blendModes.SATURATION]="saturation",b.blendModesCanvas[b.blendModes.COLOR]="color",b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"):(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over",b.blendModesCanvas[b.blendModes.SCREEN]="source-over",b.blendModesCanvas[b.blendModes.OVERLAY]="source-over",b.blendModesCanvas[b.blendModes.DARKEN]=
"source-over",b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over",b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over",b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over",b.blendModesCanvas[b.blendModes.HUE]="source-over",b.blendModesCanvas[b.blendModes.SATURATION]=
"source-over",b.blendModesCanvas[b.blendModes.COLOR]="source-over",b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over"));this.width=a||800;this.height=c||600;this.view=e||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new b.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,
roundPixels:!1};"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")};b.CanvasRenderer.prototype.constructor=b.CanvasRenderer;b.CanvasRenderer.prototype.render=
function(a){b.texturesToUpdate.length=0;b.texturesToDestroy.length=0;a.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(a);
a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));0<b.Texture.frameUpdates.length&&(b.Texture.frameUpdates.length=0)};b.CanvasRenderer.prototype.resize=function(a,c){this.width=a;this.height=c;this.view.width=a;this.view.height=c};b.CanvasRenderer.prototype.renderDisplayObject=function(a,c){this.renderSession.context=c||this.context;a._renderCanvas(this.renderSession)};b.CanvasRenderer.prototype.renderStripFlat=function(a){var c=this.context;
a=a.verticies;var b=a.length/2;this.count++;c.beginPath();for(var d=1;b-2>d;d++){var f=2*d,h=a[f+2],g=a[f+4],l=a[f+3],k=a[f+5];c.moveTo(a[f],a[f+1]);c.lineTo(h,l);c.lineTo(g,k)}c.fillStyle="#FF0000";c.fill();c.closePath()};b.CanvasRenderer.prototype.renderStrip=function(a){var c=this.context,b=a.verticies,d=a.uvs,f=b.length/2;this.count++;for(var h=1;f-2>h;h++){var g=2*h,l=b[g],k=b[g+2],m=b[g+4],n=b[g+1],p=b[g+3],q=b[g+5],w=d[g]*a.texture.width,v=d[g+2]*a.texture.width,t=d[g+4]*a.texture.width,u=
d[g+1]*a.texture.height,B=d[g+3]*a.texture.height,g=d[g+5]*a.texture.height;c.save();c.beginPath();c.moveTo(l,n);c.lineTo(k,p);c.lineTo(m,q);c.closePath();c.clip();var x=w*B+u*t+v*g-B*t-u*v-w*g;c.transform((l*B+u*m+k*g-B*m-u*k-l*g)/x,(n*B+u*q+p*g-B*q-u*p-n*g)/x,(w*k+l*t+v*m-k*t-l*v-w*m)/x,(w*p+n*t+v*q-p*t-n*v-w*q)/x,(w*B*m+u*k*t+l*v*g-l*B*t-u*v*m-w*k*g)/x,(w*B*q+u*p*t+n*v*g-n*B*t-u*v*q-w*p*g)/x);c.drawImage(a.texture.baseTexture.source,0,0);c.restore()}};b.CanvasBuffer=function(a,c){this.width=a;
this.height=c;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=c};b.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};b.CanvasBuffer.prototype.resize=function(a,c){this.width=this.canvas.width=a;this.height=this.canvas.height=c};b.CanvasGraphics=function(){};b.CanvasGraphics.renderGraphics=function(a,c){for(var e=a.worldAlpha,d=0;d<a.graphicsData.length;d++){var f=a.graphicsData[d],
h=f.points;if(c.strokeStyle="#"+("00000"+(0|f.lineColor).toString(16)).substr(-6),c.lineWidth=f.lineWidth,f.type===b.Graphics.POLY){c.beginPath();c.moveTo(h[0],h[1]);for(var g=1;g<h.length/2;g++)c.lineTo(h[2*g],h[2*g+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath();f.fill&&(c.globalAlpha=f.fillAlpha*e,c.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),c.fill());f.lineWidth&&(c.globalAlpha=f.lineAlpha*e,c.stroke())}else if(f.type===b.Graphics.RECT)(f.fillColor||0===f.fillColor)&&
(c.globalAlpha=f.fillAlpha*e,c.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),c.fillRect(h[0],h[1],h[2],h[3])),f.lineWidth&&(c.globalAlpha=f.lineAlpha*e,c.strokeRect(h[0],h[1],h[2],h[3]));else if(f.type===b.Graphics.CIRC)c.beginPath(),c.arc(h[0],h[1],h[2],0,2*Math.PI),c.closePath(),f.fill&&(c.globalAlpha=f.fillAlpha*e,c.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),c.fill()),f.lineWidth&&(c.globalAlpha=f.lineAlpha*e,c.stroke());else if(f.type===b.Graphics.ELIP){var l=
f.points,k=2*l[2],m=2*l[3],g=l[0]-k/2,l=l[1]-m/2;c.beginPath();var n=k/2*.5522848,h=m/2*.5522848,p=g+k,q=l+m,k=g+k/2,m=l+m/2;c.moveTo(g,m);c.bezierCurveTo(g,m-h,k-n,l,k,l);c.bezierCurveTo(k+n,l,p,m-h,p,m);c.bezierCurveTo(p,m+h,k+n,q,k,q);c.bezierCurveTo(k-n,q,g,m+h,g,m);c.closePath();f.fill&&(c.globalAlpha=f.fillAlpha*e,c.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),c.fill());f.lineWidth&&(c.globalAlpha=f.lineAlpha*e,c.stroke())}else f.type===b.Graphics.RREC&&(g=h[0],m=h[1],l=h[2],
n=h[3],h=h[4],p=Math.min(l,n)/2|0,h=h>p?p:h,c.beginPath(),c.moveTo(g,m+h),c.lineTo(g,m+n-h),c.quadraticCurveTo(g,m+n,g+h,m+n),c.lineTo(g+l-h,m+n),c.quadraticCurveTo(g+l,m+n,g+l,m+n-h),c.lineTo(g+l,m+h),c.quadraticCurveTo(g+l,m,g+l-h,m),c.lineTo(g+h,m),c.quadraticCurveTo(g,m,g,m+h),c.closePath(),(f.fillColor||0===f.fillColor)&&(c.globalAlpha=f.fillAlpha*e,c.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),c.fill()),f.lineWidth&&(c.globalAlpha=f.lineAlpha*e,c.stroke()))}};b.CanvasGraphics.renderGraphicsMask=
function(a,c){var e=a.graphicsData.length;if(0!==e)for(1<e&&window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"),e=0;1>e;e++){var d=a.graphicsData[e],f=d.points;if(d.type===b.Graphics.POLY){c.beginPath();c.moveTo(f[0],f[1]);for(d=1;d<f.length/2;d++)c.lineTo(f[2*d],f[2*d+1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&c.closePath()}else if(d.type===b.Graphics.RECT)c.beginPath(),c.rect(f[0],f[1],f[2],f[3]),c.closePath();else if(d.type===b.Graphics.CIRC)c.beginPath(),
c.arc(f[0],f[1],f[2],0,2*Math.PI),c.closePath();else if(d.type===b.Graphics.ELIP){var h=d.points,g=2*h[2],d=2*h[3],f=h[0]-g/2,h=h[1]-d/2;c.beginPath();var l=g/2*.5522848,k=d/2*.5522848,m=f+g,n=h+d,g=f+g/2,d=h+d/2;c.moveTo(f,d);c.bezierCurveTo(f,d-k,g-l,h,g,h);c.bezierCurveTo(g+l,h,m,d-k,m,d);c.bezierCurveTo(m,d+k,g+l,n,g,n);c.bezierCurveTo(g-l,n,f,d+k,f,d);c.closePath()}else d.type===b.Graphics.RREC&&(d=f[0],h=f[1],l=f[2],k=f[3],f=f[4],m=Math.min(l,k)/2|0,f=f>m?m:f,c.beginPath(),c.moveTo(d,h+f),c.lineTo(d,
h+k-f),c.quadraticCurveTo(d,h+k,d+f,h+k),c.lineTo(d+l-f,h+k),c.quadraticCurveTo(d+l,h+k,d+l,h+k-f),c.lineTo(d+l,h+f),c.quadraticCurveTo(d+l,h,d+l-f,h),c.lineTo(d+f,h),c.quadraticCurveTo(d,h,d,h+f),c.closePath())}};b.Graphics=function(){b.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=!1;this.bounds=null;this.boundsPadding=
10;this.dirty=!0};b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Graphics.prototype.constructor=b.Graphics;Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});b.Graphics.prototype.lineStyle=function(a,c,e){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=c||0,
this.lineAlpha=3>arguments.length?1:e,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this};b.Graphics.prototype.moveTo=function(a,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,
fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.currentPath.points.push(a,c),this.graphicsData.push(this.currentPath),this};b.Graphics.prototype.lineTo=function(a,c){return this.currentPath.points.push(a,c),this.dirty=!0,this};b.Graphics.prototype.quadraticCurveTo=function(a,c,b,d){0===this.currentPath.points.length&&this.moveTo(0,0);var f,h,g=this.currentPath.points;0===g.length&&this.moveTo(0,0);for(var l=g[g.length-2],k=g[g.length-1],m=0,n=1;20>=n;n++)m=n/20,f=l+
(a-l)*m,h=k+(c-k)*m,g.push(f+(a+(b-a)*m-f)*m,h+(c+(d-c)*m-h)*m);return this.dirty=!0,this};b.Graphics.prototype.bezierCurveTo=function(a,c,b,d,f,h){0===this.currentPath.points.length&&this.moveTo(0,0);for(var g,l,k,m,n,p=this.currentPath.points,q=p[p.length-2],w=p[p.length-1],v=0,t=1;20>t;t++)v=t/20,g=1-v,l=g*g,k=l*g,m=v*v,n=m*v,p.push(k*q+3*l*v*a+3*g*m*b+n*f,k*w+3*l*v*c+3*g*m*d+n*h);return this.dirty=!0,this};b.Graphics.prototype.arcTo=function(a,c,b,d,f){0===this.currentPath.points.length&&this.moveTo(a,
c);var h=this.currentPath.points,g=h[h.length-1]-c,l=h[h.length-2]-a;d-=c;b-=a;var k=Math.abs(g*b-l*d);if(1E-8>k||0===f)h.push(a,c);else{var m=g*g+l*l,n=d*d+b*b,p=g*d+l*b,h=f*Math.sqrt(m)/k,k=f*Math.sqrt(n)/k,m=h*p/m,q=k*p/n,n=h*b+k*l,p=h*d+k*g,w=b*(h+q),h=d*(h+q),k=Math.atan2(g*(k+m)-p,l*(k+m)-n),h=Math.atan2(h-p,w-n);this.arc(n+a,p+c,f,k,h,l*d>b*g)}return this.dirty=!0,this};b.Graphics.prototype.arc=function(a,c,b,d,f,h){var g=a+Math.cos(d)*b,l=c+Math.sin(d)*b,k=this.currentPath.points;if((0!==
k.length&&k[k.length-2]!==g||k[k.length-1]!==l)&&(this.moveTo(g,l),k=this.currentPath.points),d===f)return this;!h&&d>=f?f+=2*Math.PI:h&&f>=d&&(d+=2*Math.PI);f=h?-1*(d-f):f-d;var m=Math.abs(f)/(2*Math.PI)*40;if(0===f)return this;f/=2*m;h=2*f;for(var g=Math.cos(f),l=Math.sin(f),m=m-1,n=m%1/m,p=0;m>=p;p++){var q=f+d+h*(p+n*p),w=Math.cos(q),q=-Math.sin(q);k.push((g*w+l*q)*b+a,(g*-q+l*w)*b+c)}return this.dirty=!0,this};b.Graphics.prototype.drawPath=function(a){return this.currentPath.points.length||this.graphicsData.pop(),
this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(a),this.dirty=!0,this};b.Graphics.prototype.beginFill=function(a,c){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=2>arguments.length?1:c,this};b.Graphics.prototype.endFill=function(){return this.filling=
!1,this.fillColor=null,this.fillAlpha=1,this};b.Graphics.prototype.drawRect=function(a,c,e,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,e,d],type:b.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawRoundedRect=function(a,c,e,d,f){return this.currentPath.points.length||
this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,e,d,f],type:b.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawCircle=function(a,c,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,
fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,e,e],type:b.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawEllipse=function(a,c,e,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,e,d],type:b.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=
!0,this};b.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this};b.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),c=new b.CanvasBuffer(a.width,a.height),e=b.Texture.fromCanvas(c.canvas);return c.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,c.context),e};b.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return this.dirty&&
(this._generateCachedSprite(),b.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a),void 0;if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=b.blendModesWebGL[a.spriteBatch.currentBlendMode];
a.spriteBatch.gl.blendFunc(c[0],c[1])}if(b.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var c=0,e=this.children.length;e>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;a.spriteBatch.start()}};b.Graphics.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){var c=a.context,e=this.worldTransform;this.blendMode!==
a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a.context);c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty);b.CanvasGraphics.renderGraphics(this,c);c=0;for(e=this.children.length;e>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var c=this.bounds.x,b=this.bounds.width+this.bounds.x,
d=this.bounds.y,f=this.bounds.height+this.bounds.y;a=a||this.worldTransform;var h=a.a,g=a.c,l=a.b,k=a.d,m=a.tx,n=a.ty,p=h*b+l*f+m,q=k*f+g*b+n;a=h*c+l*f+m;var f=k*f+g*c+n,w=h*c+l*d+m,c=k*d+g*c+n,h=h*b+l*d+m,b=k*d+g*b+n,d=p,g=q,p=p>a?a:p,p=p>w?w:p,p=p>h?h:p,q=q>f?f:q,q=q>c?c:q,q=q>b?b:q,d=a>d?a:d,d=w>d?w:d,g=f>g?f:g,g=c>g?c:g;a=this._bounds;return a.x=p,a.width=(h>d?h:d)-p,a.y=q,a.height=(b>g?b:g)-q,a};b.Graphics.prototype.updateBounds=function(){for(var a,c,e,d,f,h=1/0,g=-1/0,l=1/0,k=-1/0,m=0;m<this.graphicsData.length;m++)if(a=
this.graphicsData[m],c=a.type,f=a.lineWidth,a=a.points,c===b.Graphics.RECT)c=a[0]-f/2,e=a[1]-f/2,d=a[2]+f,f=a[3]+f,h=h>c?c:h,g=c+d>g?c+d:g,l=l>e?c:l,k=e+f>k?e+f:k;else if(c===b.Graphics.CIRC||c===b.Graphics.ELIP)c=a[0],e=a[1],d=a[2]+f/2,f=a[3]+f/2,h=h>c-d?c-d:h,g=c+d>g?c+d:g,l=l>e-f?e-f:l,k=e+f>k?e+f:k;else for(d=0;d<a.length;d+=2)c=a[d],e=a[d+1],h=h>c-f?c-f:h,g=c+f>g?c+f:g,l=l>e-f?e-f:l,k=e+f>k?e+f:k;m=this.boundsPadding;this.bounds=new b.Rectangle(h-m,l-m,g-h+2*m,k-l+2*m)};b.Graphics.prototype._generateCachedSprite=
function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new b.CanvasBuffer(a.width,a.height),e=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(e);this._cachedSprite.buffer=c;this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);
this._cachedSprite.alpha=this.alpha};b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};b.Graphics.POLY=0;b.Graphics.RECT=1;b.Graphics.CIRC=2;b.Graphics.ELIP=3;b.Graphics.RREC=4;b.Strip=function(a){b.DisplayObjectContainer.call(this);this.texture=a;this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new b.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new b.Float32Array([1,1,1,1]);this.indices=new b.Uint16Array([0,1,2,
3]);this.dirty=!0};b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Strip.prototype.constructor=b.Strip;b.Strip.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())};b.Strip.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();
this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.verticies,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW)};b.Strip.prototype._renderStrip=function(a){var c=
a.gl,e=a.projection,d=a.offset;a=a.shaderManager.stripShader;c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.uniformMatrix3fv(a.translationMatrix,!1,this.worldTransform.toArray(!0));c.uniform2f(a.projectionVector,e.x,-e.y);c.uniform2f(a.offsetVector,-d.x,-d.y);c.uniform1f(a.alpha,1);this.dirty?(this.dirty=!1,c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,this.verticies,c.STATIC_DRAW),c.vertexAttribPointer(a.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),
c.bufferData(c.ARRAY_BUFFER,this.uvs,c.STATIC_DRAW),c.vertexAttribPointer(a.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW)):(c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,this.verticies),c.vertexAttribPointer(a.aVertexPosition,
2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.vertexAttribPointer(a.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer));c.drawElements(c.TRIANGLE_STRIP,this.indices.length,c.UNSIGNED_SHORT,0)};b.Strip.prototype._renderCanvas=function(a){var c=a.context,b=this.worldTransform;a.roundPixels?c.setTransform(b.a,
b.c,b.b,b.d,0|b.tx,0|b.ty):c.setTransform(b.a,b.c,b.b,b.d,b.tx,b.ty);a=this.verticies;var b=this.uvs,d=a.length/2;this.count++;for(var f=0;d-2>f;f++){var h=2*f,g=a[h],l=a[h+2],k=a[h+4],m=a[h+1],n=a[h+3],p=a[h+5],q=(g+l+k)/3,w=(m+n+p)/3,v=g-q,t=m-w,u=Math.sqrt(v*v+t*t),g=q+v/u*(u+3),m=w+t/u*(u+3),v=l-q,t=n-w,u=Math.sqrt(v*v+t*t),l=q+v/u*(u+3),n=w+t/u*(u+3),v=k-q,t=p-w,u=Math.sqrt(v*v+t*t),k=q+v/u*(u+3),p=w+t/u*(u+3),q=b[h]*this.texture.width,w=b[h+2]*this.texture.width,v=b[h+4]*this.texture.width,
t=b[h+1]*this.texture.height,u=b[h+3]*this.texture.height,h=b[h+5]*this.texture.height;c.save();c.beginPath();c.moveTo(g,m);c.lineTo(l,n);c.lineTo(k,p);c.closePath();c.clip();var B=q*u+t*v+w*h-u*v-t*w-q*h;c.transform((g*u+t*k+l*h-u*k-t*l-g*h)/B,(m*u+t*p+n*h-u*p-t*n-m*h)/B,(q*l+g*v+w*k-l*v-g*w-q*k)/B,(q*n+m*v+w*p-n*v-m*w-q*p)/B,(q*u*k+t*l*v+g*w*h-g*u*v-t*w*k-q*l*h)/B,(q*u*p+t*n*v+m*w*h-m*u*v-t*w*p-q*n*h)/B);c.drawImage(this.texture.baseTexture.source,0,0);c.restore()}};b.Strip.prototype.onTextureUpdate=
function(){this.updateFrame=!0};b.Rope=function(a,c){b.Strip.call(this,a);this.points=c;this.verticies=new b.Float32Array(4*c.length);this.uvs=new b.Float32Array(4*c.length);this.colors=new b.Float32Array(2*c.length);this.indices=new b.Uint16Array(2*c.length);this.refresh()};b.Rope.prototype=Object.create(b.Strip.prototype);b.Rope.prototype.constructor=b.Rope;b.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var b=this.uvs,e=this.indices,d=this.colors;this.count-=.2;b[0]=0;b[1]=
0;b[2]=0;b[3]=1;d[0]=1;d[1]=1;e[0]=0;e[1]=1;for(var f,h=a.length,g=1;h>g;g++)a=4*g,f=g/(h-1),b[a]=f,b[a+1]=0,b[a+2]=f,b[a+3]=1,a=2*g,d[a]=1,d[a+1]=1,a=2*g,e[a]=a,e[a+1]=a+1}};b.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var c,e=a[0],d=c=0;this.count-=.2;for(var f,h,g,l=this.verticies,k=a.length,m=0;k>m;m++)f=a[m],h=4*m,c=m<a.length-1?a[m+1]:f,d=-(c.x-e.x),c=c.y-e.y,e=Math.sqrt(c*c+d*d),g=this.texture.height/2,c/=e,d/=e,c*=g,d*=g,l[h]=f.x+c,l[h+1]=f.y+d,l[h+2]=f.x-
c,l[h+3]=f.y-d,e=f;b.DisplayObjectContainer.prototype.updateTransform.call(this)}};b.Rope.prototype.setTexture=function(a){this.texture=a};b.TilingSprite=function(a,c,e){b.Sprite.call(this,a);this._width=c||100;this._height=e||100;this.tileScale=new b.Point(1,1);this.tileScaleOffset=new b.Point(1,1);this.tilePosition=new b.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL};b.TilingSprite.prototype=Object.create(b.Sprite.prototype);b.TilingSprite.prototype.constructor=
b.TilingSprite;Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}});b.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)};b.TilingSprite.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha){var c,e;this._mask&&
(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(b.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this);c=0;for(e=this.children.length;e>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop();
this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(a);a.spriteBatch.start()}};b.TilingSprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){var c=a.context;this._mask&&a.maskManager.pushMask(this._mask,c);c.globalAlpha=this.worldAlpha;var e;e=this.worldTransform;if(c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=c.createPattern(this.tilingTexture.baseTexture.source,
"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);e=this.tilePosition;var d=this.tileScale;e.x%=this.tilingTexture.baseTexture.width;e.y%=this.tilingTexture.baseTexture.height;c.scale(d.x,d.y);c.translate(e.x,e.y);c.fillStyle=this.__tilePattern;c.fillRect(-e.x+this.anchor.x*-this._width,-e.y+this.anchor.y*-this._height,this._width/d.x,this._height/d.y);c.scale(1/d.x,1/d.y);c.translate(-e.x,-e.y);this._mask&&
a.maskManager.popMask(a.context);c=0;for(e=this.children.length;e>c;c++)this.children[c]._renderCanvas(a)}};b.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,e=a*(1-this.anchor.x),d=a*-this.anchor.x,f=b*(1-this.anchor.y),h=b*-this.anchor.y,b=this.worldTransform,g=b.a,l=b.c,k=b.b,m=b.d,n=b.tx,p=b.ty,b=g*d+k*h+n,a=m*h+l*d+p,q=g*e+k*h+n,h=m*h+l*e+p,w=g*e+k*f+n,e=m*f+l*e+p,g=g*d+k*f+n,d=m*f+l*d+p,f=-1/0,l=-1/0,m=1/0,k=1/0,m=m>b?b:m,m=m>q?q:m,m=m>w?w:m,m=m>g?g:m,k=k>a?a:k,
k=k>h?h:k,k=k>e?e:k,k=k>d?d:k,f=b>f?b:f,f=q>f?q:f,f=w>f?w:f,l=a>l?a:l,l=h>l?h:l,l=e>l?e:l,b=this._bounds;return b.x=m,b.width=(g>f?g:f)-m,b.y=k,b.height=(d>l?d:l)-k,this._currentBounds=b,b};b.TilingSprite.prototype.onTextureUpdate=function(){};b.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var c,e,d=this.texture,f=d.frame,h=f.width!==d.baseTexture.width||f.height!==d.baseTexture.height,g=!1;if(a?(c=b.getNextPowerOfTwo(f.width),e=b.getNextPowerOfTwo(f.height),
(f.width!==c||f.height!==e)&&(g=!0)):h&&(c=f.width,e=f.height,g=!0),g){var k;this.tilingTexture&&this.tilingTexture.isTiling?(k=this.tilingTexture.canvasBuffer,k.resize(c,e),this.tilingTexture.baseTexture.width=c,this.tilingTexture.baseTexture.height=e,this.tilingTexture.needsUpdate=!0):(k=new b.CanvasBuffer(c,e),this.tilingTexture=b.Texture.fromCanvas(k.canvas),this.tilingTexture.canvasBuffer=k,this.tilingTexture.isTiling=!0);k.context.drawImage(d.baseTexture.source,d.crop.x,d.crop.y,d.crop.width,
d.crop.height,0,0,c,e);this.tileScaleOffset.x=f.width/c;this.tileScaleOffset.y=f.height/e}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=d;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};var n={BoneData:function(a,b){this.name=a;this.parent=b}};n.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1};n.SlotData=function(a,b){this.name=a;this.boneData=b};n.SlotData.prototype=
{r:1,g:1,b:1,a:1,attachmentName:null};n.Bone=function(a,b){this.data=a;this.parent=b;this.setToSetupPose()};n.Bone.yDown=!1;n.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var e=this.parent;null!=e?(this.worldX=this.x*e.m00+this.y*e.m01+e.worldX,this.worldY=this.x*e.m10+this.y*e.m11+e.worldY,this.worldScaleX=e.worldScaleX*this.scaleX,this.worldScaleY=e.worldScaleY*this.scaleY,
this.worldRotation=e.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,e=Math.cos(d),d=Math.sin(d);this.m00=e*this.worldScaleX;this.m10=d*this.worldScaleX;this.m01=-d*this.worldScaleY;this.m11=e*this.worldScaleY;a&&(this.m00=-this.m00,this.m01=-this.m01);b&&(this.m10=-this.m10,this.m11=-this.m11);n.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=
this.data;this.x=a.x;this.y=a.y;this.rotation=a.rotation;this.scaleX=a.scaleX;this.scaleY=a.scaleY}};n.Slot=function(a,b,e){this.data=a;this.skeleton=b;this.bone=e;this.setToSetupPose()};n.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a;this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=
this.data;this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a;for(var b=this.skeleton.data.slots,e=0,d=b.length;d>e;e++)if(b[e]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(e,a.attachmentName):null);break}}};n.Skin=function(a){this.name=a;this.attachments={}};n.Skin.prototype={addAttachment:function(a,b,e){this.attachments[a+":"+b]=e},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var e in b.attachments){var d=e.indexOf(":"),f=
parseInt(e.substring(0,d),10),h=e.substring(d+1),d=a.slots[f];d.attachment&&d.attachment.name==h&&(f=this.getAttachment(f,h))&&d.setAttachment(f)}}};n.Animation=function(a,b,e){this.name=a;this.timelines=b;this.duration=e};n.Animation.prototype={apply:function(a,b,e){e&&this.duration&&(b%=this.duration);e=this.timelines;for(var d=0,f=e.length;f>d;d++)e[d].apply(a,b,1)},mix:function(a,b,e,d){e&&this.duration&&(b%=this.duration);e=this.timelines;for(var f=0,h=e.length;h>f;f++)e[f].apply(a,b,d)}};n.binarySearch=
function(a,b,e){var d=0,f=Math.floor(a.length/e)-2;if(!f)return e;for(var h=f>>>1;;){if(a[(h+1)*e]<=b?d=h+1:f=h,d==f)return(d+1)*e;h=d+f>>>1}};n.linearSearch=function(a,b,e){for(var d=0,f=a.length-e;f>=d;d+=e)if(a[d]>b)return d;return-1};n.Curves=function(a){this.curves=[];this.curves.length=6*(a-1)};n.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,e,d,f){var h=.1*.1,g=.1*h,k=3*.1,n=3*h,h=6*h,m=6*g,p=2*-b+d,q=2*-e+f;d=
3*(b-d)+1;f=3*(e-f)+1;a*=6;var A=this.curves;A[a]=b*k+p*n+d*g;A[a+1]=e*k+q*n+f*g;A[a+2]=p*h+d*m;A[a+3]=q*h+f*m;A[a+4]=d*m;A[a+5]=f*m},getCurvePercent:function(a,b){b=0>b?0:1<b?1:b;var e=6*a,d=this.curves,f=d[e];if(!f)return b;if(-1==f)return 0;for(var h=d[e+1],g=d[e+2],k=d[e+3],n=d[e+4],m=d[e+5],e=f,d=h,p=8;;){if(e>=b)return f=e-f,h=d-h,h+(d-h)*(b-f)/(e-f);if(!p)break;p--;f+=g;h+=k;g+=n;k+=m;e+=f;d+=h}return d+(1-d)*(b-e)/(1-e)}};n.RotateTimeline=function(a){this.curves=new n.Curves(a);this.frames=
[];this.frames.length=2*a};n.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,e){a*=2;this.frames[a]=b;this.frames[a+1]=e},apply:function(a,b,e){var d;d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];if(b>=d[d.length-2]){for(d=a.data.rotation+d[d.length-1]-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;return a.rotation+=d*e,void 0}var f=n.binarySearch(d,b,2),h=d[f-1],g=d[f];b=1-(b-g)/(d[f-2]-g);b=this.curves.getCurvePercent(f/2-
1,b);for(d=d[f+1]-h;180<d;)d-=360;for(;-180>d;)d+=360;for(d=a.data.rotation+(h+d*b)-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;a.rotation+=d*e}}};n.TranslateTimeline=function(a){this.curves=new n.Curves(a);this.frames=[];this.frames.length=3*a};n.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,e,d){a*=3;this.frames[a]=b;this.frames[a+1]=e;this.frames[a+2]=d},apply:function(a,b,e){var d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];
if(b>=d[d.length-3])return a.x+=(a.data.x+d[d.length-2]-a.x)*e,a.y+=(a.data.y+d[d.length-1]-a.y)*e,void 0;var f=n.binarySearch(d,b,3),h=d[f-2],g=d[f-1],k=d[f];b=1-(b-k)/(d[f+-3]-k);b=this.curves.getCurvePercent(f/3-1,b);a.x+=(a.data.x+h+(d[f+1]-h)*b-a.x)*e;a.y+=(a.data.y+g+(d[f+2]-g)*b-a.y)*e}}};n.ScaleTimeline=function(a){this.curves=new n.Curves(a);this.frames=[];this.frames.length=3*a};n.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,
b,e,d){a*=3;this.frames[a]=b;this.frames[a+1]=e;this.frames[a+2]=d},apply:function(a,b,e){var d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];if(b>=d[d.length-3])return a.scaleX+=(a.data.scaleX-1+d[d.length-2]-a.scaleX)*e,a.scaleY+=(a.data.scaleY-1+d[d.length-1]-a.scaleY)*e,void 0;var f=n.binarySearch(d,b,3),h=d[f-2],g=d[f-1],k=d[f];b=1-(b-k)/(d[f+-3]-k);b=this.curves.getCurvePercent(f/3-1,b);a.scaleX+=(a.data.scaleX-1+h+(d[f+1]-h)*b-a.scaleX)*e;a.scaleY+=(a.data.scaleY-1+g+(d[f+2]-g)*b-a.scaleY)*
e}}};n.ColorTimeline=function(a){this.curves=new n.Curves(a);this.frames=[];this.frames.length=5*a};n.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,b,e,d,f,h){a*=5;this.frames[a]=b;this.frames[a+1]=e;this.frames[a+2]=d;this.frames[a+3]=f;this.frames[a+4]=h},apply:function(a,b,e){var d=this.frames;if(!(b<d[0])){a=a.slots[this.slotIndex];if(b>=d[d.length-5])return e=d.length-1,a.r=d[e-3],a.g=d[e-2],a.b=d[e-1],a.a=d[e],void 0;var f=n.binarySearch(d,
b,5),h=d[f-4],g=d[f-3],k=d[f-2],p=d[f-1],m=d[f];b=1-(b-m)/(d[f-5]-m);b=this.curves.getCurvePercent(f/5-1,b);h+=(d[f+1]-h)*b;g+=(d[f+2]-g)*b;k+=(d[f+3]-k)*b;d=p+(d[f+4]-p)*b;1>e?(a.r+=(h-a.r)*e,a.g+=(g-a.g)*e,a.b+=(k-a.b)*e,a.a+=(d-a.a)*e):(a.r=h,a.g=g,a.b=k,a.a=d)}}};n.AttachmentTimeline=function(a){this.curves=new n.Curves(a);this.frames=[];this.frames.length=a;this.attachmentNames=[];this.attachmentNames.length=a};n.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},
setFrame:function(a,b,e){this.frames[a]=b;this.attachmentNames[a]=e},apply:function(a,b){var e=this.frames;b<e[0]||(e=b>=e[e.length-1]?e.length-1:n.binarySearch(e,b,1)-1,e=this.attachmentNames[e],a.slots[this.slotIndex].setAttachment(e?a.getAttachmentBySlotIndex(this.slotIndex,e):null))}};n.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.animations=[]};n.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,e=0,d=b.length;d>e;e++)if(b[e].name==a)return b[e];
return null},findBoneIndex:function(a){for(var b=this.bones,e=0,d=b.length;d>e;e++)if(b[e].name==a)return e;return-1},findSlot:function(a){for(var b=this.slots,e=0,d=b.length;d>e;e++)if(b[e].name==a)return slot[e];return null},findSlotIndex:function(a){for(var b=this.slots,e=0,d=b.length;d>e;e++)if(b[e].name==a)return e;return-1},findSkin:function(a){for(var b=this.skins,e=0,d=b.length;d>e;e++)if(b[e].name==a)return b[e];return null},findAnimation:function(a){for(var b=this.animations,e=0,d=b.length;d>
e;e++)if(b[e].name==a)return b[e];return null}};n.Skeleton=function(a){this.data=a;this.bones=[];for(var b=0,e=a.bones.length;e>b;b++){var d=a.bones[b],f=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new n.Bone(d,f))}this.slots=[];this.drawOrder=[];b=0;for(e=a.slots.length;e>b;b++)d=a.slots[b],f=this.bones[a.bones.indexOf(d.boneData)],d=new n.Slot(d,this,f),this.slots.push(d),this.drawOrder.push(d)};n.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,
updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,e=this.bones,d=0,f=e.length;f>d;d++)e[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,e=a.length;e>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,e=a.length;e>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=
this.bones,e=0,d=b.length;d>e;e++)if(b[e].data.name==a)return b[e];return null},findBoneIndex:function(a){for(var b=this.bones,e=0,d=b.length;d>e;e++)if(b[e].data.name==a)return e;return-1},findSlot:function(a){for(var b=this.slots,e=0,d=b.length;d>e;e++)if(b[e].data.name==a)return b[e];return null},findSlotIndex:function(a){for(var b=this.slots,e=0,d=b.length;d>e;e++)if(b[e].data.name==a)return e;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},
setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin);this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var e=this.skin.getAttachment(a,b);if(e)return e}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var e=this.slots,d=0,f=e.size;f>d;d++){var h=e[d];if(h.data.name==a){e=null;if(b&&(e=this.getAttachment(d,b),
null==e))throw"Attachment not found: "+b+", for slot: "+a;return h.setAttachment(e),void 0}}throw"Slot not found: "+a;},update:function(a){time+=a}};n.AttachmentType={region:0};n.RegionAttachment=function(){this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};n.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,
b,e,d,f){var h=this.uvs;f?(h[2]=a,h[3]=d,h[4]=a,h[5]=b,h[6]=e,h[7]=b,h[0]=e,h[1]=d):(h[0]=a,h[1]=d,h[2]=a,h[3]=b,h[4]=e,h[5]=b,h[6]=e,h[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,e=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,f=e+this.regionWidth*a,a=d+this.regionHeight*b,b=this.rotation*Math.PI/180,h=Math.cos(b),g=Math.sin(b),b=e*h+this.x,e=e*g,k=d*h+this.y,
d=d*g,n=f*h+this.x,f=f*g,h=a*h+this.y,a=a*g,g=this.offset;g[0]=b-d;g[1]=k+e;g[2]=b-a;g[3]=h+e;g[4]=n-a;g[5]=h+f;g[6]=n-d;g[7]=k+f},computeVertices:function(a,b,e,d){a+=e.worldX;b+=e.worldY;var f=e.m00,h=e.m01,g=e.m10;e=e.m11;var k=this.offset;d[0]=k[0]*f+k[1]*h+a;d[1]=k[0]*g+k[1]*e+b;d[2]=k[2]*f+k[3]*h+a;d[3]=k[2]*g+k[3]*e+b;d[4]=k[4]*f+k[5]*h+a;d[5]=k[4]*g+k[5]*e+b;d[6]=k[6]*f+k[7]*h+a;d[7]=k[6]*g+k[7]*e+b}};n.AnimationStateData=function(a){this.skeletonData=a;this.animationToMixTime={}};n.AnimationStateData.prototype=
{defaultMix:0,setMixByName:function(a,b,e){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;a=this.skeletonData.findAnimation(b);if(!a)throw"Animation not found: "+b;this.setMix(d,a,e)},setMix:function(a,b,e){this.animationToMixTime[a.name+":"+b.name]=e},getMix:function(a,b){var e=this.animationToMixTime[a.name+":"+b.name];return e?e:this.defaultMix}};n.AnimationState=function(a){this.data=a;this.queue=[]};n.AnimationState.prototype={animationSpeed:1,current:null,previous:null,
currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,0<this.queue.length)a=this.queue[0],this.currentTime>=a.delay&&(this._setAnimation(a.animation,a.loop),this.queue.shift())},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;1<=b&&(b=1,this.previous=null);this.current.mix(a,
this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.current=this.previous=null;this.queue.length=0},_setAnimation:function(a,b){this.previous=null;a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),0<this.mixDuration&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop));this.current=a;this.currentLoop=b;this.currentTime=0},setAnimationByName:function(a,
b){var e=this.data.skeletonData.findAnimation(a);if(!e)throw"Animation not found: "+a;this.setAnimation(e,b)},setAnimation:function(a,b){this.queue.length=0;this._setAnimation(a,b)},addAnimationByName:function(a,b,e){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,e)},addAnimation:function(a,b,e){var d={};if(d.animation=a,d.loop=b,!e||0>=e)b=this.queue.length?this.queue[this.queue.length-1].animation:this.current,e=null!=b?b.duration-this.data.getMix(b,
a)+(e||0):0;d.delay=e;this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}};n.SkeletonJson=function(a){this.attachmentLoader=a};n.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,e=new n.SkeletonData,d=a.bones,f=0,h=d.length;h>f;f++){var g=d[f];b=null;if(g.parent&&(b=e.findBone(g.parent),!b))throw"Parent bone not found: "+g.parent;b=new n.BoneData(g.name,b);b.length=(g.length||0)*this.scale;b.x=(g.x||0)*this.scale;b.y=(g.y||
0)*this.scale;b.rotation=g.rotation||0;b.scaleX=g.scaleX||1;b.scaleY=g.scaleY||1;e.bones.push(b)}d=a.slots;f=0;for(h=d.length;h>f;f++){g=d[f];if(b=e.findBone(g.bone),!b)throw"Slot bone not found: "+g.bone;var k=new n.SlotData(g.name,b),p=g.color;p&&(k.r=n.SkeletonJson.toColor(p,0),k.g=n.SkeletonJson.toColor(p,1),k.b=n.SkeletonJson.toColor(p,2),k.a=n.SkeletonJson.toColor(p,3));k.attachmentName=g.attachment;e.slots.push(k)}var f=a.skins,m;for(m in f)if(f.hasOwnProperty(m)){h=f[m];b=new n.Skin(m);for(var q in h)if(h.hasOwnProperty(q)){var d=
e.findSlotIndex(q),g=h[q],z;for(z in g)g.hasOwnProperty(z)&&(k=this.readAttachment(b,z,g[z]),null!=k&&b.addAttachment(d,z,k))}e.skins.push(b);"default"==b.name&&(e.defaultSkin=b)}a=a.animations;for(var A in a)a.hasOwnProperty(A)&&this.readAnimation(A,a[A],e);return e},readAttachment:function(a,b,e){b=e.name||b;a=n.AttachmentType[e.type||"region"];if(a==n.AttachmentType.region)return a=new n.RegionAttachment,a.x=(e.x||0)*this.scale,a.y=(e.y||0)*this.scale,a.scaleX=e.scaleX||1,a.scaleY=e.scaleY||1,
a.rotation=e.rotation||0,a.width=(e.width||32)*this.scale,a.height=(e.height||32)*this.scale,a.updateOffset(),a.rendererObject={},a.rendererObject.name=b,a.rendererObject.scale={},a.rendererObject.scale.x=a.scaleX,a.rendererObject.scale.y=a.scaleY,a.rendererObject.rotation=-a.rotation*Math.PI/180,a;throw"Unknown attachment type: "+a;},readAnimation:function(a,b,e){var d,f,h,g,k,p,m,q=[],z=0,A=b.bones,w;for(w in A)if(A.hasOwnProperty(w)){var v=e.findBoneIndex(w);if(-1==v)throw"Bone not found: "+w;
var t=A[w];for(h in t)if(t.hasOwnProperty(h))if(k=t[h],"rotate"==h){f=new n.RotateTimeline(k.length);f.boneIndex=v;p=d=0;for(m=k.length;m>p;p++)g=k[p],f.setFrame(d,g.time,g.angle),n.SkeletonJson.readCurve(f,d,g),d++;q.push(f);z=Math.max(z,f.frames[2*f.getFrameCount()-2])}else{if("translate"!=h&&"scale"!=h)throw"Invalid timeline type for a bone: "+h+" ("+w+")";var u=1;"scale"==h?f=new n.ScaleTimeline(k.length):(f=new n.TranslateTimeline(k.length),u=this.scale);f.boneIndex=v;p=d=0;for(m=k.length;m>
p;p++)g=k[p],f.setFrame(d,g.time,(g.x||0)*u,(g.y||0)*u),n.SkeletonJson.readCurve(f,d,g),d++;q.push(f);z=Math.max(z,f.frames[3*f.getFrameCount()-3])}}b=b.slots;for(var B in b)if(b.hasOwnProperty(B))for(h in A=b[B],w=e.findSlotIndex(B),A)if(A.hasOwnProperty(h))if(k=A[h],"color"==h){f=new n.ColorTimeline(k.length);f.slotIndex=w;p=d=0;for(m=k.length;m>p;p++){g=k[p];var x=g.color,v=n.SkeletonJson.toColor(x,0),t=n.SkeletonJson.toColor(x,1),u=n.SkeletonJson.toColor(x,2),x=n.SkeletonJson.toColor(x,3);f.setFrame(d,
g.time,v,t,u,x);n.SkeletonJson.readCurve(f,d,g);d++}q.push(f);z=Math.max(z,f.frames[5*f.getFrameCount()-5])}else{if("attachment"!=h)throw"Invalid timeline type for a slot: "+h+" ("+B+")";f=new n.AttachmentTimeline(k.length);f.slotIndex=w;p=d=0;for(m=k.length;m>p;p++)g=k[p],f.setFrame(d++,g.time,g.name);q.push(f);z=Math.max(z,f.frames[f.getFrameCount()-1])}e.animations.push(new n.Animation(a,q,z))}};n.SkeletonJson.readCurve=function(a,b,e){(e=e.curve)&&("stepped"==e?a.curves.setStepped(b):e instanceof
Array&&a.curves.setCurve(b,e[0],e[1],e[2],e[3]))};n.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255};n.Atlas=function(a,b){this.textureLoader=b;this.pages=[];this.regions=[];var e=new n.AtlasReader(a),d=[];d.length=4;for(var f=null;;){var h=e.readLine();if(null==h)break;if(h=e.trim(h),h.length)if(f){var g=new n.AtlasRegion;g.name=h;g.page=f;g.rotate="true"==e.readValue();e.readTuple(d);var h=parseInt(d[0],
10),k=parseInt(d[1],10);e.readTuple(d);var p=parseInt(d[0],10),m=parseInt(d[1],10);g.u=h/f.width;g.v=k/f.height;g.rotate?(g.u2=(h+m)/f.width,g.v2=(k+p)/f.height):(g.u2=(h+p)/f.width,g.v2=(k+m)/f.height);g.x=h;g.y=k;g.width=Math.abs(p);g.height=Math.abs(m);4==e.readTuple(d)&&(g.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==e.readTuple(d)&&(g.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],e.readTuple(d)));g.originalWidth=parseInt(d[0],
10);g.originalHeight=parseInt(d[1],10);e.readTuple(d);g.offsetX=parseInt(d[0],10);g.offsetY=parseInt(d[1],10);g.index=parseInt(e.readValue(),10);this.regions.push(g)}else f=new n.AtlasPage,f.name=h,f.format=n.Atlas.Format[e.readValue()],e.readTuple(d),f.minFilter=n.Atlas.TextureFilter[d[0]],f.magFilter=n.Atlas.TextureFilter[d[1]],g=e.readValue(),f.uWrap=n.Atlas.TextureWrap.clampToEdge,f.vWrap=n.Atlas.TextureWrap.clampToEdge,"x"==g?f.uWrap=n.Atlas.TextureWrap.repeat:"y"==g?f.vWrap=n.Atlas.TextureWrap.repeat:
"xy"==g&&(f.uWrap=f.vWrap=n.Atlas.TextureWrap.repeat),b.load(f,h),this.pages.push(f);else f=null}};n.Atlas.prototype={findRegion:function(a){for(var b=this.regions,e=0,d=b.length;d>e;e++)if(b[e].name==a)return b[e];return null},dispose:function(){for(var a=this.pages,b=0,e=a.length;e>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,e=0,d=b.length;d>e;e++){var f=b[e];f.page==a&&(f.u=f.x/a.width,f.v=f.y/a.height,f.rotate?(f.u2=(f.x+f.height)/a.width,
f.v2=(f.y+f.width)/a.height):(f.u2=(f.x+f.width)/a.width,f.v2=(f.y+f.height)/a.height))}}};n.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};n.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};n.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};n.AtlasPage=function(){};n.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,
rendererObject:null,width:0,height:0};n.AtlasRegion=function(){};n.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};n.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)};n.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=
this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),e=b.indexOf(":");if(-1==e)throw"Invalid line: "+b;for(var d=0,e=e+1;3>d;d++){var f=b.indexOf(",",e);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e));e=f+1}return a[d]=this.trim(b.substring(e)),d+1}};n.AtlasAttachmentLoader=function(a){this.atlas=a};n.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,e){switch(b){case n.AttachmentType.region:a=
this.atlas.findRegion(e);if(!a)throw"Region not found in atlas: "+e+" ("+b+")";b=new n.RegionAttachment(e);return b.rendererObject=a,b.setUVs(a.u,a.v,a.u2,a.v2,a.rotate),b.regionOffsetX=a.offsetX,b.regionOffsetY=a.offsetY,b.regionWidth=a.width,b.regionHeight=a.height,b.regionOriginalWidth=a.originalWidth,b.regionOriginalHeight=a.originalHeight,b}throw"Unknown attachment type: "+b;}};n.Bone.yDown=!0;b.AnimCache={};b.Spine=function(a){if(b.DisplayObjectContainer.call(this),this.spineData=b.AnimCache[a],
!this.spineData)throw Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new n.Skeleton(this.spineData);this.skeleton.updateWorldTransform();this.stateData=new n.AnimationStateData(this.spineData);this.state=new n.AnimationState(this.stateData);this.slotContainers=[];a=0;for(var c=this.skeleton.drawOrder.length;c>a;a++){var e=this.skeleton.drawOrder[a],d=e.attachment,f=new b.DisplayObjectContainer;if(this.slotContainers.push(f),this.addChild(f),d instanceof
n.RegionAttachment){var h=d.rendererObject.name,d=this.createSprite(e,d.rendererObject);e.currentSprite=d;e.currentSpriteName=h;f.addChild(d)}}};b.Spine.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Spine.prototype.constructor=b.Spine;b.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now();this.state.update(a);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();for(var a=this.skeleton.drawOrder,
c=0,e=a.length;e>c;c++){var d=a[c],f=d.attachment,h=this.slotContainers[c];if(f instanceof n.RegionAttachment){if(f.rendererObject&&(!d.currentSpriteName||d.currentSpriteName!=f.name)){var g=f.rendererObject.name;if(void 0!==d.currentSprite&&(d.currentSprite.visible=!1),d.sprites=d.sprites||{},void 0!==d.sprites[g])d.sprites[g].visible=!0;else{var k=this.createSprite(d,f.rendererObject);h.addChild(k)}d.currentSprite=d.sprites[g];d.currentSpriteName=g}h.visible=!0;g=d.bone;h.position.x=g.worldX+f.x*
g.m00+f.y*g.m01;h.position.y=g.worldY+f.x*g.m10+f.y*g.m11;h.scale.x=g.worldScaleX;h.scale.y=g.worldScaleY;h.rotation=-(d.bone.worldRotation*Math.PI/180);h.alpha=d.a;d.currentSprite.tint=b.rgb2hex([d.r,d.g,d.b])}else h.visible=!1}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.Spine.prototype.createSprite=function(a,c){var e=new b.Sprite(b.Texture.fromFrame(b.TextureCache[c.name]?c.name:c.name+".png"));return e.scale=c.scale,e.rotation=c.rotation,e.anchor.x=e.anchor.y=.5,a.sprites=
a.sprites||{},a.sprites[c.name]=e,e};b.BaseTextureCache={};b.texturesToUpdate=[];b.texturesToDestroy=[];b.BaseTextureCacheIdGenerator=0;b.BaseTexture=function(a,c){if(b.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=c||b.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=b.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=
!0,this.width=this.source.width,this.height=this.source.height,b.texturesToUpdate.push(this);else{var e=this;this.source.onload=function(){e.hasLoaded=!0;e.width=e.source.width;e.height=e.source.height;for(var a=0;a<e._glTextures.length;a++)e._dirty[a]=!0;e.dispatchEvent({type:"loaded",content:e})};this.source.onerror=function(){e.dispatchEvent({type:"error",content:e})}}this.imageUrl=null;this._powerOf2=!1}};b.BaseTexture.prototype.constructor=b.BaseTexture;b.BaseTexture.prototype.destroy=function(){this.imageUrl?
(delete b.BaseTextureCache[this.imageUrl],delete b.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete b.BaseTextureCache[this.source._pixiId];this.source=null;b.texturesToDestroy.push(this)};b.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1;this.source.src=null;this.source.src=a};b.BaseTexture.fromImage=function(a,c,e){var d=b.BaseTextureCache[a];(void 0===c&&-1===a.indexOf("data:")&&(c=!0),d)||(d=new Image,c&&(d.crossOrigin=
""),d.src=a,d=new b.BaseTexture(d,e),d.imageUrl=a,b.BaseTextureCache[a]=d);return d};b.BaseTexture.fromCanvas=function(a,c){a._pixiId||(a._pixiId="canvas_"+b.TextureCacheIdGenerator++);var e=b.BaseTextureCache[a._pixiId];return e||(e=new b.BaseTexture(a,c),b.BaseTextureCache[a._pixiId]=e),e};b.TextureCache={};b.FrameCache={};b.TextureCacheIdGenerator=0;b.Texture=function(a,c){if(b.EventTarget.call(this),this.noFrame=!1,c||(this.noFrame=!0,c=new b.Rectangle(0,0,1,1)),a instanceof b.Texture&&(a=a.baseTexture),
this.baseTexture=a,this.frame=c,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new b.Rectangle(0,0,1,1),a.hasLoaded)this.noFrame&&(c=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(c);else{var e=this;a.addEventListener("loaded",function(){e.onBaseTextureLoaded()})}};b.Texture.prototype.constructor=b.Texture;b.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=
new b.Rectangle(0,0,a.width,a.height));this.setFrame(this.frame);this.scope.dispatchEvent({type:"update",content:this})};b.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy();this.valid=!1};b.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+
this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&b.Texture.frameUpdates.push(this)};b.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new b.TextureUvs);var a=this.crop,c=this.baseTexture.width,e=this.baseTexture.height;this._uvs.x0=a.x/c;this._uvs.y0=a.y/e;this._uvs.x1=(a.x+a.width)/c;this._uvs.y1=
a.y/e;this._uvs.x2=(a.x+a.width)/c;this._uvs.y2=(a.y+a.height)/e;this._uvs.x3=a.x/c;this._uvs.y3=(a.y+a.height)/e};b.Texture.fromImage=function(a,c,e){var d=b.TextureCache[a];return d||(d=new b.Texture(b.BaseTexture.fromImage(a,c,e)),b.TextureCache[a]=d),d};b.Texture.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw Error('The frameId "'+a+'" does not exist in the texture cache ');return c};b.Texture.fromCanvas=function(a,c){var e=b.BaseTexture.fromCanvas(a,c);return new b.Texture(e)};b.Texture.addTextureToCache=
function(a,c){b.TextureCache[c]=a};b.Texture.removeTextureFromCache=function(a){var c=b.TextureCache[a];return delete b.TextureCache[a],delete b.BaseTextureCache[a],c};b.Texture.frameUpdates=[];b.TextureUvs=function(){this.y3=this.x3=this.y2=this.x2=this.y1=this.x1=this.y0=this.x0=0};b.RenderTexture=function(a,c,e,d){(b.EventTarget.call(this),this.width=a||100,this.height=c||100,this.frame=new b.Rectangle(0,0,this.width,this.height),this.crop=new b.Rectangle(0,0,this.width,this.height),this.baseTexture=
new b.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=d||b.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=e||b.defaultRenderer,this.renderer.type===b.WEBGL_RENDERER)?(a=this.renderer.gl,this.textureBuffer=new b.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new b.Point(this.width/
2,-this.height/2)):(this.render=this.renderCanvas,this.textureBuffer=new b.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;b.Texture.frameUpdates.push(this)};b.RenderTexture.prototype=Object.create(b.Texture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.resize=function(a,c,e){a===this.width&&c===this.height||(this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=
c,e&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===b.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))};b.RenderTexture.prototype.clear=function(){this.renderer.type===b.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);this.textureBuffer.clear()};b.RenderTexture.prototype.renderWebGL=function(a,c,e){var d=this.renderer.gl;
d.colorMask(!0,!0,!0,!0);d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer);e&&this.textureBuffer.clear();e=a.children;d=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix;a.worldTransform.d=-1;a.worldTransform.ty=-2*this.projection.y;c&&(a.worldTransform.tx=c.x,a.worldTransform.ty-=c.y);c=0;for(var f=e.length;f>c;c++)e[c].updateTransform();b.WebGLRenderer.updateTextures();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,
this.projection,this.textureBuffer.frameBuffer);a.worldTransform=d;this.renderer.spriteBatch.dirty=!0};b.RenderTexture.prototype.renderCanvas=function(a,c,e){var d=a.children,f=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix;c?(a.worldTransform.tx=c.x,a.worldTransform.ty=c.y):(a.worldTransform.tx=0,a.worldTransform.ty=0);c=0;for(var h=d.length;h>c;c++)d[c].updateTransform();e&&this.textureBuffer.clear();e=this.textureBuffer.context;this.renderer.renderDisplayObject(a,e);e.setTransform(1,
0,0,1,0,0);a.worldTransform=f};b.RenderTexture.tempMatrix=new b.Matrix;b.AssetLoader=function(a,c){b.EventTarget.call(this);this.assetURLs=a;this.crossorigin=c;this.loadersByType={jpg:b.ImageLoader,jpeg:b.ImageLoader,png:b.ImageLoader,gif:b.ImageLoader,webp:b.ImageLoader,json:b.JsonLoader,atlas:b.AtlasLoader,anim:b.SpineLoader,xml:b.BitmapFontLoader,fnt:b.BitmapFontLoader}};b.AssetLoader.prototype.constructor=b.AssetLoader;b.AssetLoader.prototype._getDataType=function(a){if("data:"===a.slice(0,5).toLowerCase()){a=
a.slice(5);var b=a.indexOf(",");return-1===b?null:(a=a.slice(0,b).split(";")[0])&&"text/plain"!==a.toLowerCase()?a.split("/").pop().toLowerCase():"txt"}return null};b.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.content)}var b=this;this.loadCount=this.assetURLs.length;for(var e=0;e<this.assetURLs.length;e++){var d=this.assetURLs[e],f=this._getDataType(d);f||(f=d.split("?").shift().split(".").pop().toLowerCase());var h=this.loadersByType[f];if(!h)throw Error(f+" is an unsupported file type");
d=new h(d,this.crossorigin);d.addEventListener("loaded",a);d.load()}};b.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--;this.dispatchEvent({type:"onProgress",content:this,loader:a});this.onProgress&&this.onProgress(a);this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())};b.JsonLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.loaded=!1};b.JsonLoader.prototype.constructor=
b.JsonLoader;b.JsonLoader.prototype.load=function(){var a=this;window.XDomainRequest&&a.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3E3,this.ajaxRequest.onerror=function(){a.onError()},this.ajaxRequest.ontimeout=function(){a.onError()},this.ajaxRequest.onprogress=function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");this.ajaxRequest.onload=function(){a.onJSONLoaded()};this.ajaxRequest.open("GET",
this.url,!0);this.ajaxRequest.send()};b.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return this.onError(),void 0;if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,c=new b.ImageLoader(this.baseUrl+this.json.meta.image,this.crossorigin),e=this.json.frames;this.texture=c.texture.baseTexture;c.addEventListener("loaded",function(){a.onLoaded()});for(var d in e){var f=e[d].frame;if(f&&(b.TextureCache[d]=new b.Texture(this.texture,{x:f.x,
y:f.y,width:f.w,height:f.h}),b.TextureCache[d].crop=new b.Rectangle(f.x,f.y,f.w,f.h),e[d].trimmed)){var f=e[d].sourceSize,h=e[d].spriteSourceSize;b.TextureCache[d].trim=new b.Rectangle(h.x,h.y,f.w,f.h)}}c.load()}else this.json.bones&&(c=(new n.SkeletonJson).readSkeletonData(this.json),b.AnimCache[this.url]=c),this.onLoaded()};b.JsonLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};b.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",
content:this})};b.AtlasLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.baseUrl=a.replace(/[^\/]*$/,"");this.crossorigin=c;this.loaded=!1};b.AtlasLoader.constructor=b.AtlasLoader;b.AtlasLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)};b.AtlasLoader.prototype.onAtlasLoaded=
function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var a=this.ajaxRequest.responseText.split(/\r?\n/),c=-3,e=0,d=null,f=!1,h=0,g=0,k=this.onLoaded.bind(this),h=0;h<a.length;h++)if(a[h]=a[h].replace(/^\s+|\s+$/g,""),""===a[h]&&(f=h+1),0<a[h].length)f===h?(this.atlas.meta.image.push(a[h]),e=this.atlas.meta.image.length-1,this.atlas.frames.push({}),c=-3):0<c&&(1===c%7?(null!=d&&(this.atlas.frames[e][d.name]=
d),d={name:a[h],frame:{}}):(g=a[h].split(" "),3===c%7?(d.frame.x=Number(g[1].replace(",","")),d.frame.y=Number(g[2])):4===c%7?(d.frame.w=Number(g[1].replace(",","")),d.frame.h=Number(g[2])):5===c%7&&(g={x:0,y:0,w:Number(g[1].replace(",","")),h:Number(g[2])},g.w>d.frame.w||g.h>d.frame.h?(d.trimmed=!0,d.realSize=g):d.trimmed=!1))),c++;if(null!=d&&(this.atlas.frames[e][d.name]=d),0<this.atlas.meta.image.length){this.images=[];for(g=0;g<this.atlas.meta.image.length;g++)for(h in a=this.atlas.frames[g],
this.images.push(new b.ImageLoader(this.baseUrl+this.atlas.meta.image[g],this.crossorigin)),a)(c=a[h].frame)&&(b.TextureCache[h]=new b.Texture(this.images[g].texture.baseTexture,{x:c.x,y:c.y,width:c.w,height:c.h}),a[h].trimmed&&(b.TextureCache[h].realSize=a[h].realSize,b.TextureCache[h].trim.x=0,b.TextureCache[h].trim.y=0));for(g=this.currentImageId=0;g<this.images.length;g++)this.images[g].addEventListener("loaded",k);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()};
b.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))};b.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})};b.SpriteSheetLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null;this.frames={}};b.SpriteSheetLoader.prototype.constructor=
b.SpriteSheetLoader;b.SpriteSheetLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});c.load()};b.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.ImageLoader=function(a,c){b.EventTarget.call(this);this.texture=b.Texture.fromImage(a,c);this.frames=[]};b.ImageLoader.prototype.constructor=b.ImageLoader;b.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();
else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}};b.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.ImageLoader.prototype.loadFramedSpriteSheet=function(a,c,e){this.frames=[];for(var d=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/c),h=0,g=0;f>g;g++)for(var k=0;d>k;k++,h++){var n=new b.Texture(this.texture,{x:k*a,y:g*c,width:a,height:c});this.frames.push(n);e&&(b.TextureCache[e+"-"+h]=n)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();
else{var m=this;this.texture.baseTexture.addEventListener("loaded",function(){m.onLoaded()})}};b.BitmapFontLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null};b.BitmapFontLoader.prototype.constructor=b.BitmapFontLoader;b.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&
this.ajaxRequest.overrideMimeType("application/xml");this.ajaxRequest.send(null)};b.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser)a=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml");else{var c=document.createElement("div");
c.innerHTML=this.ajaxRequest.responseText;a=c}c=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file");c=new b.ImageLoader(c,this.crossorigin);this.texture=c.texture.baseTexture;var e={},d=a.getElementsByTagName("info")[0],f=a.getElementsByTagName("common")[0];e.font=d.getAttribute("face");e.size=parseInt(d.getAttribute("size"),10);e.lineHeight=parseInt(f.getAttribute("lineHeight"),10);e.chars={};f=a.getElementsByTagName("char");for(d=0;d<f.length;d++){var h=parseInt(f[d].getAttribute("id"),
10),g=new b.Rectangle(parseInt(f[d].getAttribute("x"),10),parseInt(f[d].getAttribute("y"),10),parseInt(f[d].getAttribute("width"),10),parseInt(f[d].getAttribute("height"),10));e.chars[h]={xOffset:parseInt(f[d].getAttribute("xoffset"),10),yOffset:parseInt(f[d].getAttribute("yoffset"),10),xAdvance:parseInt(f[d].getAttribute("xadvance"),10),kerning:{},texture:b.TextureCache[h]=new b.Texture(this.texture,g)}}a=a.getElementsByTagName("kerning");for(d=0;d<a.length;d++)f=parseInt(a[d].getAttribute("first"),
10),h=parseInt(a[d].getAttribute("second"),10),g=parseInt(a[d].getAttribute("amount"),10),e.chars[h].kerning[f]=g;b.BitmapText.fonts[e.font]=e;var k=this;c.addEventListener("loaded",function(){k.onLoaded()});c.load()}};b.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.SpineLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.loaded=!1};b.SpineLoader.prototype.constructor=b.SpineLoader;b.SpineLoader.prototype.load=function(){var a=
this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});c.load()};b.SpineLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};b.AbstractFilter=function(a,b){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=b||{};this.fragmentSrc=a||[]};b.AlphaMaskFilter=function(a){b.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms=
{mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;",
"uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]};b.AlphaMaskFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.AlphaMaskFilter.prototype.constructor=b.AlphaMaskFilter;b.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height;this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(b.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}});b.ColorMatrixFilter=function(){b.AbstractFilter.call(this);
this.passes=[this];this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]};b.ColorMatrixFilter.prototype=Object.create(b.AbstractFilter.prototype);b.ColorMatrixFilter.prototype.constructor=b.ColorMatrixFilter;Object.defineProperty(b.ColorMatrixFilter.prototype,
"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}});b.GrayFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={gray:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);",
"}"]};b.GrayFilter.prototype=Object.create(b.AbstractFilter.prototype);b.GrayFilter.prototype.constructor=b.GrayFilter;Object.defineProperty(b.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}});b.DisplacementFilter=function(a){b.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},
mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;",
"uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);",
"   vec2 cord = vTextureCoord;","}"]};b.DisplacementFilter.prototype=Object.create(b.AbstractFilter.prototype);b.DisplacementFilter.prototype.constructor=b.DisplacementFilter;b.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height;this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(b.DisplacementFilter.prototype,
"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}});Object.defineProperty(b.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}});Object.defineProperty(b.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}});b.PixelateFilter=function(){b.AbstractFilter.call(this);this.passes=
[this];this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1E4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;",
"   gl_FragColor = texture2D(uSampler, color);","}"]};b.PixelateFilter.prototype=Object.create(b.AbstractFilter.prototype);b.PixelateFilter.prototype.constructor=b.PixelateFilter;Object.defineProperty(b.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0;this.uniforms.pixelSize.value=a}});b.BlurXFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;",
"varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]};b.BlurXFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.BlurXFilter.prototype.constructor=b.BlurXFilter;Object.defineProperty(b.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.dirty=!0;this.uniforms.blur.value=1/7E3*a}});b.BlurYFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {",
"   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]};b.BlurYFilter.prototype=Object.create(b.AbstractFilter.prototype);b.BlurYFilter.prototype.constructor=b.BlurYFilter;Object.defineProperty(b.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/
(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});b.BlurFilter=function(){this.blurXFilter=new b.BlurXFilter;this.blurYFilter=new b.BlurYFilter;this.passes=[this.blurXFilter,this.blurYFilter]};Object.defineProperty(b.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}});Object.defineProperty(b.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=
a}});Object.defineProperty(b.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}});b.InvertFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);",
"}"]};b.InvertFilter.prototype=Object.create(b.AbstractFilter.prototype);b.InvertFilter.prototype.constructor=b.InvertFilter;Object.defineProperty(b.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}});b.SepiaFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={sepia:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;",
"uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]};b.SepiaFilter.prototype=Object.create(b.AbstractFilter.prototype);b.SepiaFilter.prototype.constructor=b.SepiaFilter;Object.defineProperty(b.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},
set:function(a){this.uniforms.sepia.value=a}});b.TwistFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;",
"   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]};b.TwistFilter.prototype=Object.create(b.AbstractFilter.prototype);b.TwistFilter.prototype.constructor=b.TwistFilter;Object.defineProperty(b.TwistFilter.prototype,
"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0;this.uniforms.offset.value=a}});Object.defineProperty(b.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0;this.uniforms.radius.value=a}});Object.defineProperty(b.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});b.ColorStepFilter=function(){b.AbstractFilter.call(this);
this.passes=[this];this.uniforms={step:{type:"1f",value:5}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]};b.ColorStepFilter.prototype=Object.create(b.AbstractFilter.prototype);b.ColorStepFilter.prototype.constructor=b.ColorStepFilter;Object.defineProperty(b.ColorStepFilter.prototype,
"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}});b.DotScreenFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {",
"   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};b.DotScreenFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.DotScreenFilter.prototype.constructor=b.DotScreenFilter;Object.defineProperty(b.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0;this.uniforms.scale.value=a}});Object.defineProperty(b.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});b.CrossHatchFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",
value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {",
"            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]};b.CrossHatchFilter.prototype=Object.create(b.AbstractFilter.prototype);b.CrossHatchFilter.prototype.constructor=
b.BlurYFilter;Object.defineProperty(b.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});b.RGBSplitFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]};b.RGBSplitFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.RGBSplitFilter.prototype.constructor=b.RGBSplitFilter;Object.defineProperty(b.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PIXI=b):"undefined"!=typeof define&&define.amd?define(b):this.PIXI=b}).call(this);function SpacialHash(b,k,p){this.width_=b;this.height_=k;this.granularity_=p;this.buckets_={}}SpacialHash.prototype.hash_=function(b,k){var p=Math.ceil(b/this.granularity_),q=Math.ceil(k/this.granularity_),p=p+","+q;this.buckets_[p]||(this.buckets_[p]=[]);return p};SpacialHash.prototype.getAll=function(b,k){return this.buckets_[this.hash_(b,k)]};SpacialHash.prototype.add=function(b,k,p){this.buckets_[this.hash_(b,k)].push(p)};
SpacialHash.prototype.remove=function(b,k,p){b=this.buckets_[this.hash_(b,k)];p=b.indexOf(p);-1!=p&&b.splice(p,1)};function CameraView(b,k,p){this.base=PixiView;this.base.apply(this,[b,k]);this.world_=p}window.inherits(CameraView,PixiView);CameraView.prototype.makePixiStageMember=function(){return new PIXI.DisplayObjectContainer};CameraView.prototype.notify=function(){var b=this.getModel();this.world_.position.x=-b.getX();this.world_.position.y=-b.getY()};function Input(){var b=this;this.keyHitBindings_={};this.keyDownBindings_={};this.keyDownState_={};this.keyHitState_={};this.addBrowserEventListener_("keydown",function(k){k=k||window.event;b.keyDownState_[""+(k.which||k.charCode||k.keyCode)]=!0});this.addBrowserEventListener_("keyup",function(k){k=k||window.event;k=""+(k.which||k.charCode||k.keyCode);b.keyDownState_[k]=!1;b.keyHitState_[k]=!0})}Input.Keys={RIGHT:"39",LEFT:"37",UP:"38",DOWN:"40"};
Input.prototype.addBrowserEventListener_=function(b,k){document.addEventListener?document.addEventListener(b,k,!1):element.attachEvent?document.attachEvent("on"+b,k):document["on"+b]=k};
Input.prototype.update=function(){for(key in this.keyDownState_)if(this.keyDownState_.hasOwnProperty(key)&&this.keyDownState_[key]&&this.keyDownBindings_[key])for(var b=this.keyDownBindings_[key],k=0;k<b.length;k++)b[k].action.fire(this,b[k].data);for(key in this.keyHitState_)if(this.keyHitState_.hasOwnProperty(key)){if(this.keyHitState_[key]&&this.keyHitBindings_[key])for(b=this.keyHitBindings_[key],k=0;k<b.length;k++)b[k].action.fire(this,b[k].data);this.keyHitState_[key]&&(this.keyHitState_[key]=
!1)}};Input.prototype.bindMapKeyToAction_=function(b,k,p,q){k[b]||(k[b]=[]);k[b].push({action:p,data:q})};Input.prototype.bindKeyHitAction=function(b,k,p){this.bindMapKeyToAction_(b,this.keyHitBindings_,k,p)};Input.prototype.bindKeyDownAction=function(b,k,p){this.bindMapKeyToAction_(b,this.keyDownBindings_,k,p)};function MapView(b,k,p){this.camera_=k;this.camera_.subscribeView(this);this.base=PixiView;this.base.apply(this,[b,p])}window.inherits(MapView,PixiView);
MapView.prototype.makePixiStageMember=function(){var b=new PIXI.Graphics,k=this.getModel(),p=this.camera_.getX(),q=this.camera_.getY(),n=this.camera_.getWidth(),a=this.camera_.getHeight();k.forEachTileInRect(p,q,n,a,function(a,e,d){if(a.getColor()){var f=a.getWidth(),h=a.getHeight();b.beginFill(a.getColor());b.drawRect(e*f,d*h,f,h);b.endFill()}});return b};MapView.prototype.notify=function(){this.redrawPixiStageMember()};function PixiView(b,k){this.model_=b;this.model_.subscribeView(this);this.pixiStage_=k;(this.pixiChild_=this.makePixiStageMember())&&this.pixiStage_.addChild(this.pixiChild_)}PixiView.prototype.getModel=function(){return this.model_};PixiView.prototype.getPixiStageMember=function(){return this.pixiChild_};PixiView.prototype.redrawPixiStageMember=function(){var b=this.makePixiStageMember();b&&(this.pixiChild_&&this.pixiStage_.removeChild(this.pixiChild_),this.pixiChild_=b,this.pixiStage_.addChild(this.pixiChild_))};
PixiView.prototype.makePixiStageMember=window.ABSTRACT_METHOD;PixiView.prototype.notify=window.ABSTRACT_METHOD;function Selector(b){};function WorkerView(b,k,p){this.camera_=k;this.camera_.subscribeView(this);this.lastInView_=!1;this.base=PixiView;this.base.apply(this,[b,p])}window.inherits(WorkerView,PixiView);
WorkerView.prototype.makePixiStageMember=function(){var b=this.getModel(),k=b.getX()*MarkoViewModel.TILE_WIDTH,b=b.getY()*MarkoViewModel.TILE_HEIGHT;if(this.camera_.inView(k,b)){this.lastInView_=!0;var p=new PIXI.Graphics;p.beginFill(16777215);p.drawRect(k,b,MarkoViewModel.TILE_WIDTH,MarkoViewModel.TILE_HEIGHT);p.endFill();return p}this.lastInView_&&(console.log("left view!"),this.lastInView_=!1);return null};WorkerView.prototype.notify=function(){this.redrawPixiStageMember()};function MarkoViewModel(){this.base=ViewModel;this.base.apply(this);console.log("CREATING MARKO GAME..");console.log("INITIALIZING INPUT..");this.input_=new Input;console.log("SETTING UP RENDERER..");this.pixiStage_=new PIXI.Stage(3381555);this.pixiRenderer_=PIXI.autoDetectRenderer(MarkoViewModel.DISPLAY_WIDTH,MarkoViewModel.DISPLAY_HEIGHT);this.pixiWorld_=new PIXI.DisplayObjectContainer;this.pixiStage_.addChild(this.pixiWorld_);document.body.appendChild(this.pixiRenderer_.view);console.log("INITALIZING CAMERA..");
this.camera_=new Camera(MarkoViewModel.WORLD_WIDTH,MarkoViewModel.WORLD_HEIGHT,MarkoViewModel.DISPLAY_WIDTH,MarkoViewModel.DISPLAY_HEIGHT);this.cameraView_=new CameraView(this.camera_,this.pixiStage_,this.pixiWorld_);this.cameraView_.getPixiStageMember();console.log("INITIALIZING MAP..");this.map_=new Map(MarkoViewModel.NUMBER_OF_X_TILES,MarkoViewModel.NUMBER_OF_Y_TILES,MarkoViewModel.TILE_HEIGHT,MarkoViewModel.TILE_WIDTH);this.mapView_=new MapView(this.map_,this.camera_,this.pixiWorld_);console.log("CREATING PATH GENERATOR..");
this.pathGenerator_=PathGenerator.getInstance(this.map_);console.log("INITIALIZING SELECT HANDLER..");this.selector_=new Selector(this.input_);console.log("SPAWNING COLONIES..");this.colony_=new WorkerColony(this.map_);for(var b=0;100>b;b++){var k=new Worker;new WorkerView(k,this.camera_,this.pixiWorld_);this.colony_.addWorker(k);k.onStateChange()}console.log("BINDING INPUT..");this.input_.bindKeyDownAction(Input.Keys.UP,Action.ViewActions.PAN_UP);this.input_.bindKeyDownAction(Input.Keys.DOWN,Action.ViewActions.PAN_DOWN);
this.input_.bindKeyDownAction(Input.Keys.RIGHT,Action.ViewActions.PAN_RIGHT);this.input_.bindKeyDownAction(Input.Keys.LEFT,Action.ViewActions.PAN_LEFT);this.camera_.moveX(MarkoViewModel.WORLD_WIDTH/2);this.camera_.moveY(MarkoViewModel.WORLD_HEIGHT/2);console.log("READY..")}MarkoViewModel.prototype=Object.create(ViewModel.prototype);MarkoViewModel.DISPLAY_WIDTH=800;MarkoViewModel.DISPLAY_HEIGHT=600;MarkoViewModel.WORLD_WIDTH=4E3;MarkoViewModel.WORLD_HEIGHT=3E3;MarkoViewModel.TILE_HEIGHT=16;
MarkoViewModel.TILE_WIDTH=16;MarkoViewModel.NUMBER_OF_X_TILES=MarkoViewModel.WORLD_WIDTH/MarkoViewModel.TILE_WIDTH;MarkoViewModel.NUMBER_OF_Y_TILES=MarkoViewModel.WORLD_HEIGHT/MarkoViewModel.TILE_HEIGHT;MarkoViewModel.prototype.render=function(){this.pixiRenderer_.render(this.pixiStage_)};MarkoViewModel.prototype.update=function(){this.input_.update();this.colony_.update()};MarkoViewModel.prototype.panCameraLeft=function(){this.camera_.panLeft()};MarkoViewModel.prototype.panCameraRight=function(){this.camera_.panRight()};
MarkoViewModel.prototype.panCameraUp=function(){this.camera_.panUp()};MarkoViewModel.prototype.panCameraDown=function(){this.camera_.panDown()};function ViewModel(){};function Game(){this.running_=!1;this.lastUpdate_=this.oneFrameTime_=null}Game.prototype.onRender=window.ABSTRACT_METHOD;Game.prototype.onUpdate=window.ABSTRACT_METHOD;Game.prototype.onStart=window.ABSTRACT_METHOD;Game.prototype.onShutDown=window.ABSTRACT_METHOD;Game.prototype.render_=function(){this.onRender()};Game.prototype.update_=function(b){this.onUpdate(b)};
Game.prototype.run=function(b){function k(){var b=1;if(p.lastUpdate_){var n=Date.now(),b=n-p.lastUpdate_;p.lastUpdate_=n}else p.lastUpdate_=Date.now();if(p.running_)setTimeout(function(){requestAnimationFrame(k);p.update_(b);p.render_()},p.oneFrameTime_);else p.onShutDown()}var p=this;this.oneFrameTime_=1E3/b;this.running_=!0;this.onStart();k()};function Marko(){this.base=Game;this.base.apply(this);this.controller=new ClientController(this)}window.inherits(Marko,Game);Marko.prototype.onRender=function(){Action.GameActions.RENDER.fire(Action.NO_SOURCE)};Marko.prototype.onUpdate=function(b){Action.GameActions.UPDATE.fire(Action.NO_SOURCE,b)};Marko.prototype.onStart=function(){Action.GameActions.START.fire(Action.NO_SOURCE)};Marko.prototype.onShutDown=function(){Action.GameActions.STOP.fire(Action.NO_SOURCE)};