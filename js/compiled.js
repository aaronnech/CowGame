/*

 pixi.js - v1.6.0
 Copyright (c) 2012-2014, Mat Groves
 http://goodboydigital.com/

 Compiled: 2014-07-18

 pixi.js is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php
*/
window.ABSTRACT_METHOD=function(){throw"ERROR: method not implemented";};
(function(){var b=b||{};b.WEBGL_RENDERER=0;b.CANVAS_RENDERER=1;b.VERSION="v1.6.1";b.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};b.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};b._UID=0;"undefined"!=typeof Float32Array?(b.Float32Array=Float32Array,b.Uint16Array=Uint16Array):(b.Float32Array=Array,b.Uint16Array=Array);b.INTERACTION_FREQUENCY=30;b.AUTO_PREVENT_DEFAULT=
!0;b.RAD_TO_DEG=180/Math.PI;b.DEG_TO_RAD=Math.PI/180;b.dontSayHello=!1;b.sayHello=function(a){b.dontSayHello||(-1<navigator.userAgent.toLowerCase().indexOf("chrome")?console.log.apply(console,["%c %c %c Pixi.js "+b.VERSION+" - "+a+"  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff",
"color: #ff2424; background: #fff"]):window.console&&console.log("Pixi.js "+b.VERSION+" - http://www.pixijs.com/"),b.dontSayHello=!0)};b.Point=function(a,c){this.x=a||0;this.y=c||0};b.Point.prototype.clone=function(){return new b.Point(this.x,this.y)};b.Point.prototype.set=function(a,c){this.x=a||0;this.y=c||(0!==c?this.x:0)};b.Point.prototype.constructor=b.Point;b.Rectangle=function(a,c,b,d){this.x=a||0;this.y=c||0;this.width=b||0;this.height=d||0};b.Rectangle.prototype.clone=function(){return new b.Rectangle(this.x,
this.y,this.width,this.height)};b.Rectangle.prototype.contains=function(a,c){if(0>=this.width||0>=this.height)return!1;var b=this.x;return a>=b&&a<=b+this.width&&(b=this.y,c>=b&&c<=b+this.height)?!0:!1};b.Rectangle.prototype.constructor=b.Rectangle;b.EmptyRectangle=new b.Rectangle(0,0,0,0);b.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],f=0,d=a.length;d>f;f+=2)c.push(new b.Point(a[f],a[f+1]));a=c}this.points=a};b.Polygon.prototype.clone=
function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c].clone());return new b.Polygon(a)};b.Polygon.prototype.contains=function(a,c){for(var b=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var h=this.points[d].x,g=this.points[d].y,k=this.points[e].x,e=this.points[e].y;g>c!=e>c&&(k-h)*(c-g)/(e-g)+h>a&&(b=!b)}return b};b.Polygon.prototype.constructor=b.Polygon;b.Circle=function(a,c,b){this.x=a||0;this.y=c||0;this.radius=b||0};b.Circle.prototype.clone=function(){return new b.Circle(this.x,
this.y,this.radius)};b.Circle.prototype.contains=function(a,c){if(0>=this.radius)return!1;var b=this.x-a,d=this.y-c,e=this.radius*this.radius;return b*=b,d*=d,e>=b+d};b.Circle.prototype.getBounds=function(){return new b.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)};b.Circle.prototype.constructor=b.Circle;b.Ellipse=function(a,c,b,d){this.x=a||0;this.y=c||0;this.width=b||0;this.height=d||0};b.Ellipse.prototype.clone=function(){return new b.Ellipse(this.x,this.y,this.width,
this.height)};b.Ellipse.prototype.contains=function(a,c){if(0>=this.width||0>=this.height)return!1;var b=(a-this.x)/this.width,d=(c-this.y)/this.height;return b*=b,d*=d,1>=b+d};b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};b.Ellipse.prototype.constructor=b.Ellipse;b.Matrix=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0};b.Matrix.prototype.fromArray=function(a){this.a=a[0];this.b=a[1];this.c=a[3];this.d=
a[4];this.tx=a[2];this.ty=a[5]};b.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var c=this.array;return a?(c[0]=this.a,c[1]=this.c,c[2]=0,c[3]=this.b,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty,c[8]=1):(c[0]=this.a,c[1]=this.b,c[2]=this.tx,c[3]=this.c,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0,c[8]=1),c};b.identityMatrix=new b.Matrix;b.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array};b.Matrix2=b.determineMatrixArrayType();
b.DisplayObject=function(){this.position=new b.Point;this.scale=new b.Point(1,1);this.pivot=new b.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=this.buttonMode=!1;this.stage=this.parent=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new b.Matrix;this.color=[];this.dynamic=!0;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new b.Rectangle(0,0,1,1);this._mask=this._currentBounds=null;this._cacheIsDirty=
this._cacheAsBitmap=!1};b.DisplayObject.prototype.constructor=b.DisplayObject;b.DisplayObject.prototype.setInteractive=function(a){this.interactive=a};Object.defineProperty(b.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}});Object.defineProperty(b.DisplayObject.prototype,
"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1);(this._mask=a)&&(this._mask.isMask=!0)}});Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var c=[],b=0;b<a.length;b++)for(var d=a[b].passes,e=0;e<d.length;e++)c.push(d[e]);this._filterBlock={target:this,filterPasses:c}}this._filters=a}});Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},
set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}});b.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,c=this.worldTransform,b=this.pivot.x,d=this.pivot.y,e=this._cr*this.scale.x,h=-this._sr*this.scale.y,g=this._sr*this.scale.x,k=this._cr*this.scale.y,l=
this.position.x-e*b-d*h,b=this.position.y-k*d-b*g,d=a.a,m=a.b,n=a.c,q=a.d;c.a=d*e+m*g;c.b=d*h+m*k;c.tx=d*l+m*b+a.tx;c.c=n*e+q*g;c.d=n*h+q*k;c.ty=n*l+q*b+a.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};b.DisplayObject.prototype.getBounds=function(a){return b.EmptyRectangle};b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)};b.DisplayObject.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0)};b.DisplayObject.prototype.generateTexture=
function(a){var c=this.getLocalBounds();a=new b.RenderTexture(0|c.width,0|c.height,a);return a.render(this,new b.Point(-c.x,-c.y)),a};b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};b.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha;a.gl?b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)};b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=
!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var c=new b.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new b.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}c=this._filters;this._filters=null;this._cachedSprite.filters=c;this._cachedSprite.texture.render(this,new b.Point(-a.x,-a.y));this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=c;this._cacheAsBitmap=
!0};b.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};b.DisplayObject.prototype._renderWebGL=function(a){};b.DisplayObject.prototype._renderCanvas=function(a){};Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=
a}});b.DisplayObjectContainer=function(){b.DisplayObject.call(this);this.children=[]};b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype);b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer;Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var c=this.getLocalBounds().width;this.scale.x=0!==c?a/(c/this.scale.x):1;this._width=a}});Object.defineProperty(b.DisplayObjectContainer.prototype,
"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var c=this.getLocalBounds().height;this.scale.y=0!==c?a/(c/this.scale.y):1;this._height=a}});b.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};b.DisplayObjectContainer.prototype.addChildAt=function(a,c){if(0<=c&&c<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(c,0,a),this.stage&&a.setStageReference(this.stage),
a;throw Error(a+" The index "+c+" supplied is out of bounds "+this.children.length);};b.DisplayObjectContainer.prototype.swapChildren=function(a,c){if(a!==c){var b=this.children.indexOf(a),d=this.children.indexOf(c);if(0>b||0>d)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[b]=c;this.children[d]=a}};b.DisplayObjectContainer.prototype.getChildAt=function(a){if(0<=a&&a<this.children.length)return this.children[a];throw Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller");
};b.DisplayObjectContainer.prototype.removeChild=function(a){return this.removeChildAt(this.children.indexOf(a))};b.DisplayObjectContainer.prototype.removeChildAt=function(a){var c=this.getChildAt(a);return this.stage&&c.removeStageReference(),c.parent=void 0,this.children.splice(a,1),c};b.DisplayObjectContainer.prototype.removeChildren=function(a,c){var b=a||0,d="number"==typeof c?c:this.children.length,e=d-b;if(0<e&&d>=e){b=this.children.splice(b,e);for(d=0;d<b.length;d++)e=b[d],this.stage&&e.removeStageReference(),
e.parent=void 0;return b}throw Error("Range Error, numeric values are outside the acceptable range");};b.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(b.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform()};b.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return b.EmptyRectangle;if(a){var c=this.worldTransform;this.worldTransform=a;this.updateTransform();
this.worldTransform=c}for(var f,d,e,c=1/0,h=1/0,g=-1/0,k=-1/0,l=!1,m=0,n=this.children.length;n>m;m++)this.children[m].visible&&(l=!0,f=this.children[m].getBounds(a),c=c<f.x?c:f.x,h=h<f.y?h:f.y,d=f.width+f.x,e=f.height+f.y,g=g>d?g:d,k=k>e?k:e);if(!l)return b.EmptyRectangle;a=this._bounds;return a.x=c,a.y=h,a.width=g-c,a.height=k-h,a};b.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=b.identityMatrix;for(var c=0,f=this.children.length;f>c;c++)this.children[c].updateTransform();
c=this.getBounds();return this.worldTransform=a,c};b.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0);for(var c=0,b=this.children.length;b>c;c++)this.children[c].setStageReference(a)};b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,c=this.children.length;c>a;a++)this.children[a].removeStageReference();this._interactive&&(this.stage.dirty=!0);this.stage=null};b.DisplayObjectContainer.prototype._renderWebGL=
function(a){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;var c,b;if(this._mask||this._filters){this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());c=0;for(b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();
a.spriteBatch.start()}else for(c=0,b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a)}};b.DisplayObjectContainer.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var c=0,b=this.children.length;b>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Sprite=function(a){b.DisplayObjectContainer.call(this);
this.anchor=new b.Point;this.texture=a;this._height=this._width=0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL;a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0};b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Sprite.prototype.constructor=b.Sprite;Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*
this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});b.Sprite.prototype.setTexture=function(a){this.texture=a;this.cachedTint=16777215};b.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=
this._height/this.texture.frame.height)};b.Sprite.prototype.getBounds=function(a){var c=this.texture.frame.width,b=this.texture.frame.height,d=c*(1-this.anchor.x),e=c*-this.anchor.x,h=b*(1-this.anchor.y),g=b*-this.anchor.y;a=a||this.worldTransform;var k=a.a,l=a.c,m=a.b,n=a.d,q=a.tx,s=a.ty;a=k*e+m*g+q;var b=n*g+l*e+s,c=k*d+m*g+q,g=n*g+l*d+s,p=k*d+m*h+q,d=n*h+l*d+s,k=k*e+m*h+q,e=n*h+l*e+s,h=-1/0,l=-1/0,n=1/0,m=1/0,n=n>a?a:n,n=n>c?c:n,n=n>p?p:n,n=n>k?k:n,m=m>b?b:m,m=m>g?g:m,m=m>d?d:m,m=m>e?e:m,h=a>h?
a:h,h=c>h?c:h,h=p>h?p:h,l=b>l?b:l,l=g>l?g:l,l=d>l?d:l;a=this._bounds;return a.x=n,a.width=(k>h?k:h)-n,a.y=m,a.height=(e>l?e:l)-m,this._currentBounds=a,a};b.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha)){var c,b;if(this._mask||this._filters){var d=a.spriteBatch;this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock));this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start());d.render(this);c=0;for(b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a);
d.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();d.start()}else for(a.spriteBatch.render(this),c=0,b=this.children.length;b>c;c++)this.children[c]._renderWebGL(a)}};b.Sprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),
this.texture.valid){a.context.globalAlpha=this.worldAlpha;a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty);a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,
a.context[a.smoothProperty]=a.scaleMode===b.scaleModes.LINEAR);var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,f=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,
this.texture.crop.height,c,f,this.texture.crop.width,this.texture.crop.height)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c,f,this.texture.crop.width,this.texture.crop.height)}c=0;for(f=this.children.length;f>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Sprite.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw Error('The frameId "'+a+'" does not exist in the texture cache'+
this);return new b.Sprite(c)};b.Sprite.fromImage=function(a,c,f){a=b.Texture.fromImage(a,c,f);return new b.Sprite(a)};b.SpriteBatch=function(a){b.DisplayObjectContainer.call(this);this.textureThing=a;this.ready=!1};b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype);b.SpriteBatch.constructor=b.SpriteBatch;b.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(a);this.ready=!0};b.SpriteBatch.prototype.updateTransform=function(){b.DisplayObject.prototype.updateTransform.call(this)};
b.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())};b.SpriteBatch.prototype._renderCanvas=function(a){var c=a.context;c.globalAlpha=this.worldAlpha;b.DisplayObject.prototype.updateTransform.call(this);for(var f=this.worldTransform,d=!0,e=0;e<this.children.length;e++){var h=
this.children[e];if(h.visible){var g=h.texture,k=g.frame;if(c.globalAlpha=this.worldAlpha*h.alpha,0===h.rotation%(2*Math.PI))d&&(c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),d=!1),c.drawImage(g.baseTexture.source,k.x,k.y,k.width,k.height,h.anchor.x*-k.width*h.scale.x+h.position.x+.5|0,h.anchor.y*-k.height*h.scale.y+h.position.y+.5|0,k.width*h.scale.x,k.height*h.scale.y);else{d||(d=!0);b.DisplayObject.prototype.updateTransform.call(h);var l=h.worldTransform;a.roundPixels?c.setTransform(l.a,l.c,l.b,l.d,
0|l.tx,0|l.ty):c.setTransform(l.a,l.c,l.b,l.d,l.tx,l.ty);c.drawImage(g.baseTexture.source,k.x,k.y,k.width,k.height,h.anchor.x*-k.width+.5|0,h.anchor.y*-k.height+.5|0,k.width,k.height)}}}};b.MovieClip=function(a){b.Sprite.call(this,a[0]);this.textures=a;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this.currentFrame=0;this.playing=!1};b.MovieClip.prototype=Object.create(b.Sprite.prototype);b.MovieClip.prototype.constructor=b.MovieClip;Object.defineProperty(b.MovieClip.prototype,"totalFrames",
{get:function(){return this.textures.length}});b.MovieClip.prototype.stop=function(){this.playing=!1};b.MovieClip.prototype.play=function(){this.playing=!0};b.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1;this.currentFrame=a;this.setTexture(this.textures[(this.currentFrame+.5|0)%this.textures.length])};b.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a;this.playing=!0};b.MovieClip.prototype.updateTransform=function(){if(b.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=
this.animationSpeed;var a=this.currentFrame+.5|0;this.currentFrame%=this.textures.length;this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}};b.MovieClip.fromFrames=function(a){for(var c=[],f=0;f<a.length;f++)c.push(new b.Texture.fromFrame(a[f]));return new b.MovieClip(c)};b.MovieClip.fromImages=function(a){for(var c=[],f=0;f<a.length;f++)c.push(new b.Texture.fromImage(a[f]));
return new b.MovieClip(c)};b.FilterBlock=function(){this.renderable=this.visible=!0};b.Text=function(a,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");b.Sprite.call(this,b.Texture.fromCanvas(this.canvas));this.setText(a);this.setStyle(c)};b.Text.prototype=Object.create(b.Sprite.prototype);b.Text.prototype.constructor=b.Text;Object.defineProperty(b.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},
set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(b.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});b.Text.prototype.setStyle=function(a){a=a||{};a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=
a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowAngle=a.dropShadowAngle||Math.PI/6;a.dropShadowDistance=a.dropShadowDistance||4;a.dropShadowColor=a.dropShadowColor||"black";this.style=a;this.dirty=!0};b.Text.prototype.setText=function(a){this.text=a.toString()||" ";this.dirty=!0};b.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));
for(var a=a.split(/(?:\r\n|\r|\n)/),c=[],b=0,d=0;d<a.length;d++){var e=this.context.measureText(a[d]).width;c[d]=e;b=Math.max(b,e)}d=b+this.style.strokeThickness;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.width=d+this.context.lineWidth;e=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;d=e*a.length;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.height=d;navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,
this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var h,g;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;for(var k=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,l=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*e,"right"===
this.style.align?h+=b-c[d]:"center"===this.style.align&&(h+=(b-c[d])/2),this.style.fill&&this.context.fillText(a[d],h+k,g+l)}this.context.fillStyle=this.style.fill;for(d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*e,"right"===this.style.align?h+=b-c[d]:"center"===this.style.align&&(h+=(b-c[d])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(a[d],h,g),this.style.fill&&this.context.fillText(a[d],h,g);this.updateTexture()};b.Text.prototype.updateTexture=
function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=!0};b.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,b.updateWebGLTexture(this.texture.baseTexture,a.gl));b.Sprite.prototype._renderWebGL.call(this,
a)};b.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);b.Sprite.prototype.updateTransform.call(this)};b.Text.prototype.determineFontHeight=function(a){var c=b.Text.heightCache[a];if(!c){var f=document.getElementsByTagName("body")[0],d=document.createElement("div"),c=document.createTextNode("M");d.appendChild(c);d.setAttribute("style",a+";position:absolute;top:0;left:0");f.appendChild(d);c=d.offsetHeight;b.Text.heightCache[a]=c;f.removeChild(d)}return c};b.Text.prototype.wordWrap=
function(a){var c="";a=a.split("\n");for(var b=0;b<a.length;b++){for(var d=this.style.wordWrapWidth,e=a[b].split(" "),h=0;h<e.length;h++){var g=this.context.measureText(e[h]).width,k=g+this.context.measureText(" ").width;0===h||k>d?(0<h&&(c+="\n"),c+=e[h],d=this.style.wordWrapWidth-g):(d-=k,c+=" "+e[h])}b<a.length-1&&(c+="\n")}return c};b.Text.prototype.destroy=function(a){this.canvas=this.context=null;this.texture.destroy(void 0===a?!0:a)};b.Text.heightCache={};b.BitmapText=function(a,c){b.DisplayObjectContainer.call(this);
this._pool=[];this.setText(a);this.setStyle(c);this.updateText();this.dirty=!1};b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setText=function(a){this.text=a||" ";this.dirty=!0};b.BitmapText.prototype.setStyle=function(a){a=a||{};a.align=a.align||"left";this.style=a;var c=a.font.split(" ");this.fontName=c[c.length-1];this.fontSize=2<=c.length?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size;
this.dirty=!0;this.tint=a.tint};b.BitmapText.prototype.updateText=function(){for(var a=b.BitmapText.fonts[this.fontName],c=new b.Point,f=null,d=[],e=0,h=[],g=0,k=this.fontSize/a.size,l=0;l<this.text.length;l++){var m=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))h.push(c.x),e=Math.max(e,c.x),g++,c.x=0,c.y+=a.lineHeight,f=null;else{var n=a.chars[m];n&&(f&&n[f]&&(c.x+=n.kerning[f]),d.push({texture:n.texture,line:g,charCode:m,position:new b.Point(c.x+n.xOffset,c.y+n.yOffset)}),
c.x+=n.xAdvance,f=m)}}h.push(c.x);e=Math.max(e,c.x);f=[];for(l=0;g>=l;l++)m=0,"right"===this.style.align?m=e-h[l]:"center"===this.style.align&&(m=(e-h[l])/2),f.push(m);g=this.children.length;h=d.length;m=this.tint||16777215;for(l=0;h>l;l++)(n=g>l?this.children[l]:this._pool.pop())?n.setTexture(d[l].texture):n=new b.Sprite(d[l].texture),n.position.x=(d[l].position.x+f[d[l].line])*k,n.position.y=d[l].position.y*k,n.scale.x=n.scale.y=k,n.tint=m,n.parent||this.addChild(n);for(;this.children.length>h;)d=
this.getChildAt(this.children.length-1),this._pool.push(d),this.removeChild(d);this.textWidth=e*k;this.textHeight=(c.y+a.lineHeight)*k};b.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.BitmapText.fonts={};b.InteractionData=function(){this.global=new b.Point;this.originalEvent=this.target=null};b.InteractionData.prototype.getLocalPosition=function(a){var c=a.worldTransform;a=this.global;
var f=c.a,d=c.b,e=c.tx,h=c.c,g=c.d,c=c.ty,k=1/(f*g+d*-h);return new b.Point(g*k*a.x+-d*k*a.y+(c*d-e*g)*k,f*k*a.y+-h*k*a.x+(-c*f+e*h)*k)};b.InteractionData.prototype.constructor=b.InteractionData;b.InteractionManager=function(a){this.stage=a;this.mouse=new b.InteractionData;this.touchs={};this.tempPoint=new b.Point;this.mouseoverEnabled=!0;this.pool=[];this.interactiveItems=[];this.interactionDOMElement=null;this.onMouseMove=this.onMouseMove.bind(this);this.onMouseDown=this.onMouseDown.bind(this);
this.onMouseOut=this.onMouseOut.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this.mouseOut=!1};b.InteractionManager.prototype.constructor=b.InteractionManager;b.InteractionManager.prototype.collectInteractiveSprite=function(a,c){for(var b=a.children,d=b.length-1;0<=d;d--){var e=b[d];e._interactive?(c.interactiveChildren=
!0,this.interactiveItems.push(e),0<e.children.length&&this.collectInteractiveSprite(e,e)):(e.__iParent=null,0<e.children.length&&this.collectInteractiveSprite(e,c))}};b.InteractionManager.prototype.setTarget=function(a){this.target=a;null===this.interactionDOMElement&&this.setTargetDomElement(a.view)};b.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents();window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none");this.interactionDOMElement=
a;a.addEventListener("mousemove",this.onMouseMove,!0);a.addEventListener("mousedown",this.onMouseDown,!0);a.addEventListener("mouseout",this.onMouseOut,!0);a.addEventListener("touchstart",this.onTouchStart,!0);a.addEventListener("touchend",this.onTouchEnd,!0);a.addEventListener("touchmove",this.onTouchMove,!0);window.addEventListener("mouseup",this.onMouseUp,!0)};b.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]=
"",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",
this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))};b.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),c=a-this.last;if(c=c*b.INTERACTION_FREQUENCY/1E3,!(1>c)){this.last=a;a=0;this.dirty&&this.rebuildInteractiveGraph();for(var c=this.interactiveItems.length,f="inherit",d=!1,a=0;c>a;a++){var e=this.interactiveItems[a];e.__hit=this.hitTest(e,this.mouse);this.mouse.target=e;e.__hit&&!d?(e.buttonMode&&(f=e.defaultCursor),
e.interactiveChildren||(d=!0),e.__isOver||(e.mouseover&&e.mouseover(this.mouse),e.__isOver=!0)):e.__isOver&&(e.mouseout&&e.mouseout(this.mouse),e.__isOver=!1)}this.currentCursorStyle!==f&&(this.currentCursorStyle=f,this.interactionDOMElement.style.cursor=f)}}};b.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,c=0;a>c;c++)this.interactiveItems[c].interactiveChildren=!1;this.interactiveItems=[];this.stage.interactive&&this.interactiveItems.push(this.stage);
this.collectInteractiveSprite(this.stage,this.stage)};b.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;var c=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=this.target.width/c.width*(a.clientX-c.left);this.mouse.global.y=this.target.height/c.height*(a.clientY-c.top);a=this.interactiveItems.length;for(c=0;a>c;c++){var b=this.interactiveItems[c];b.mousemove&&b.mousemove(this.mouse)}};b.InteractionManager.prototype.onMouseDown=
function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;b.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();a=this.interactiveItems.length;for(var c=0;a>c;c++){var f=this.interactiveItems[c];if((f.mousedown||f.click)&&(f.__mouseIsDown=!0,f.__hit=this.hitTest(f,this.mouse),f.__hit&&(f.mousedown&&f.mousedown(this.mouse),f.__isDown=!0,!f.interactiveChildren)))break}};b.InteractionManager.prototype.onMouseOut=function(){this.dirty&&this.rebuildInteractiveGraph();
var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var c=0;a>c;c++){var b=this.interactiveItems[c];b.__isOver&&(this.mouse.target=b,b.mouseout&&b.mouseout(this.mouse),b.__isOver=!1)}this.mouseOut=!0;this.mouse.global.x=-1E4;this.mouse.global.y=-1E4};b.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;a=this.interactiveItems.length;for(var c=!1,b=0;a>b;b++){var d=this.interactiveItems[b];
d.__hit=this.hitTest(d,this.mouse);d.__hit&&!c?(d.mouseup&&d.mouseup(this.mouse),d.__isDown&&d.click&&d.click(this.mouse),d.interactiveChildren||(c=!0)):d.__isDown&&d.mouseupoutside&&d.mouseupoutside(this.mouse);d.__isDown=!1}};b.InteractionManager.prototype.hitTest=function(a,c){var f=c.global;if(!a.worldVisible)return!1;var d=a instanceof b.Sprite,e=a.worldTransform,h=e.a,g=e.b,k=e.tx,l=e.c,m=e.d,e=e.ty,n=1/(h*m+g*-l),g=m*n*f.x+-g*n*f.y+(e*g-k*m)*n,f=h*n*f.y+-l*n*f.x+(-e*h+k*l)*n;if(c.target=a,
a.hitArea&&a.hitArea.contains)return a.hitArea.contains(g,f)?(c.target=a,!0):!1;if(d){var q,d=a.texture.frame.width,h=a.texture.frame.height,k=-d*a.anchor.x;if(g>k&&k+d>g&&(q=-h*a.anchor.y,f>q&&q+h>f))return c.target=a,!0}q=a.children.length;for(d=0;q>d;d++)if(this.hitTest(a.children[d],c))return c.target=a,!0;return!1};b.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var c,b=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,
e=0,e=0;e<d.length;e++){var h=d[e];c=this.touchs[h.identifier];c.originalEvent=a||window.event;c.global.x=this.target.width/b.width*(h.clientX-b.left);c.global.y=this.target.height/b.height*(h.clientY-b.top);navigator.isCocoonJS&&(c.global.x=h.clientX,c.global.y=h.clientY);for(var g=0;g<this.interactiveItems.length;g++){var k=this.interactiveItems[g];k.touchmove&&k.__touchData&&k.__touchData[h.identifier]&&k.touchmove(c)}}};b.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();
var c=this.interactionDOMElement.getBoundingClientRect();b.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var f=a.changedTouches,d=0;d<f.length;d++){var e=f[d],h=this.pool.pop();h||(h=new b.InteractionData);h.originalEvent=a||window.event;this.touchs[e.identifier]=h;h.global.x=this.target.width/c.width*(e.clientX-c.left);h.global.y=this.target.height/c.height*(e.clientY-c.top);navigator.isCocoonJS&&(h.global.x=e.clientX,h.global.y=e.clientY);for(var g=this.interactiveItems.length,k=0;g>k;k++){var l=
this.interactiveItems[k];if((l.touchstart||l.tap)&&(l.__hit=this.hitTest(l,h),l.__hit&&(l.touchstart&&l.touchstart(h),l.__isDown=!0,l.__touchData=l.__touchData||{},l.__touchData[e.identifier]=h,!l.interactiveChildren)))break}}};b.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var c=this.interactionDOMElement.getBoundingClientRect(),b=a.changedTouches,d=0;d<b.length;d++){var e=b[d],h=this.touchs[e.identifier],g=!1;h.global.x=this.target.width/c.width*
(e.clientX-c.left);h.global.y=this.target.height/c.height*(e.clientY-c.top);navigator.isCocoonJS&&(h.global.x=e.clientX,h.global.y=e.clientY);for(var k=this.interactiveItems.length,l=0;k>l;l++){var m=this.interactiveItems[l];m.__touchData&&m.__touchData[e.identifier]&&(m.__hit=this.hitTest(m,m.__touchData[e.identifier]),h.originalEvent=a||window.event,(m.touchend||m.tap)&&(m.__hit&&!g?(m.touchend&&m.touchend(h),m.__isDown&&m.tap&&m.tap(h),m.interactiveChildren||(g=!0)):m.__isDown&&m.touchendoutside&&
m.touchendoutside(h),m.__isDown=!1),m.__touchData[e.identifier]=null)}this.pool.push(h);this.touchs[e.identifier]=null}};b.Stage=function(a){b.DisplayObjectContainer.call(this);this.worldTransform=new b.Matrix;this.interactive=!0;this.interactionManager=new b.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new b.Rectangle(0,0,1E5,1E5);this.setBackgroundColor(a)};b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.setInteractionDelegate=
function(a){this.interactionManager.setTargetDomElement(a)};b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()};b.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0;this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);a=this.backgroundColor.toString(16);a="000000".substr(0,
6-a.length)+a;this.backgroundColorString="#"+a};b.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var r=0,w=["ms","moz","webkit","o"],y=0;y<w.length&&!window.requestAnimationFrame;++y)window.requestAnimationFrame=window[w[y]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[w[y]+"CancelAnimationFrame"]||window[w[y]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),
b=Math.max(0,16-(c-r)),d=window.setTimeout(function(){a(c+b)},b);return r=c+b,d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.requestAnimFrame=window.requestAnimationFrame;b.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};b.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]};"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(c){function b(){var h=
e.concat(a.call(arguments));d.apply(this instanceof b?this:c,h)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return b.prototype=function g(a){return a&&(g.prototype=a),this instanceof g?void 0:new g}(d.prototype),b}}());b.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var c=0;c<a.length;c++)try{return new window.ActiveXObject(a[c])}catch(b){}};
b.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1;a.height=1;a=a.getContext("2d");return a.fillStyle="#000",a.fillRect(0,0,1,1),a.globalCompositeOperation="multiply",a.fillStyle="#fff",a.fillRect(0,0,1,1),0===a.getImageData(0,0,1,1).data[0]};b.getNextPowerOfTwo=function(a){if(0<a&&0===(a&a-1))return a;for(var c=1;a>c;)c<<=1;return c};b.EventTarget=function(){var a={};this.addEventListener=this.on=function(c,b){void 0===a[c]&&(a[c]=[]);-1===a[c].indexOf(b)&&a[c].unshift(b)};
this.dispatchEvent=this.emit=function(c){if(a[c.type]&&a[c.type].length)for(var b=a[c.type].length-1;0<=b;b--)a[c.type][b](c)};this.removeEventListener=this.off=function(c,b){if(void 0!==a[c]){var d=a[c].indexOf(b);-1!==d&&a[c].splice(d,1)}};this.removeAllEventListeners=function(c){(c=a[c])&&(c.length=0)}};b.autoDetectRenderer=function(a,c,f,d,e){a||(a=800);c||(c=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(k){h=
!1}return h?new b.WebGLRenderer(a,c,f,d,e):new b.CanvasRenderer(a,c,f,d)};b.autoDetectRecommendedRenderer=function(a,c,f,d,e){a||(a=800);c||(c=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(k){h=!1}g=/Android/i.test(navigator.userAgent);return h&&!g?new b.WebGLRenderer(a,c,f,d,e):new b.CanvasRenderer(a,c,f,d)};b.PolyK={};b.PolyK.Triangulate=function(a){var c=!0,f=a.length>>1;if(3>f)return[];
for(var d=[],e=[],h=0;f>h;h++)e.push(h);for(var h=0,g=f;3<g;){var k=e[(h+0)%g],l=e[(h+1)%g],m=e[(h+2)%g],n=a[2*k],q=a[2*k+1],s=a[2*l],p=a[2*l+1],v=a[2*m],t=a[2*m+1],u=!1;if(b.PolyK._convex(n,q,s,p,v,t,c))for(var u=!0,r=0;g>r;r++){var x=e[r];if(x!==k&&x!==l&&x!==m&&b.PolyK._PointInTriangle(a[2*x],a[2*x+1],n,q,s,p,v,t)){u=!1;break}}if(u)d.push(k,l,m),e.splice((h+1)%g,1),g--,h=0;else if(h++>3*g){if(!c)return window.console.log("PIXI Warning: shape too complex to fill"),[];d=[];e=[];for(h=0;f>h;h++)e.push(h);
h=0;g=f;c=!1}}return d.push(e[0],e[1],e[2]),d};b.PolyK._PointInTriangle=function(a,c,b,d,e,h,g,k){g-=b;k-=d;e-=b;h-=d;a-=b;b=c-d;c=g*g+k*k;d=g*e+k*h;g=g*a+k*b;k=e*e+h*h;e=e*a+h*b;h=1/(c*k-d*d);k=(k*g-d*e)*h;g=(c*e-d*g)*h;return 0<=k&&0<=g&&1>k+g};b.PolyK._convex=function(a,c,b,d,e,h,g){return 0<=(c-d)*(e-b)+(b-a)*(h-d)===g};b.initDefaultShaders=function(){};b.CompileVertexShader=function(a,c){return b._CompileShader(a,c,a.VERTEX_SHADER)};b.CompileFragmentShader=function(a,c){return b._CompileShader(a,
c,a.FRAGMENT_SHADER)};b._CompileShader=function(a,c,b){c=c.join("\n");b=a.createShader(b);return a.shaderSource(b,c),a.compileShader(b),a.getShaderParameter(b,a.COMPILE_STATUS)?b:(window.console.log(a.getShaderInfoLog(b)),null)};b.compileProgram=function(a,c,f){f=b.CompileFragmentShader(a,f);c=b.CompileVertexShader(a,c);var d=a.createProgram();return a.attachShader(d,c),a.attachShader(d,f),a.linkProgram(d),a.getProgramParameter(d,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),
d};b.PixiShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};b.PixiShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=
a.getUniformLocation(c,"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.dimensions=a.getUniformLocation(c,"dimensions");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.colorAttribute=a.getAttribLocation(c,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];
for(var f in this.uniforms)this.uniforms[f].uniformLocation=a.getUniformLocation(c,f);this.initUniforms();this.program=c};b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,c=this.gl,b;for(b in this.uniforms){a=this.uniforms[b];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=c.uniformMatrix2fv:"mat3"===d?a.glFunc=c.uniformMatrix3fv:"mat4"===d&&(a.glFunc=c.uniformMatrix4fv)):
(a.glFunc=c["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}};b.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var c=this.gl;if(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]),a.textureData){var b=a.textureData,d=b.magFilter?b.magFilter:c.LINEAR,e=b.minFilter?b.minFilter:c.LINEAR,h=b.wrapS?b.wrapS:c.CLAMP_TO_EDGE,g=b.wrapT?
b.wrapT:c.CLAMP_TO_EDGE,k=b.luminance?c.LUMINANCE:c.RGBA;(b.repeat&&(h=c.REPEAT,g=c.REPEAT),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!!b.flipY),b.width)?c.texImage2D(c.TEXTURE_2D,0,k,b.width?b.width:512,b.height?b.height:2,b.border?b.border:0,k,c.UNSIGNED_BYTE,null):c.texImage2D(c.TEXTURE_2D,0,k,c.RGBA,c.UNSIGNED_BYTE,a.value.baseTexture.source);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,h);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_WRAP_T,g)}c.uniform1i(a.uniformLocation,this.textureCount);a._init=!0;this.textureCount++}};b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,c=this.gl,f;for(f in this.uniforms)a=this.uniforms[f],1===a.glValueLength?!0===a.glMatrix?a.glFunc.call(c,a.uniformLocation,a.transpose,a.value):a.glFunc.call(c,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,
a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]||b.createWebGLTexture(a.value.baseTexture,c)),c.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))};b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=
this.uniforms=null};b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;",
"   vColor = vec4(color * aColor.x, aColor.x);","}"];b.PixiFastShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;",
"attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};b.PixiFastShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=a.getUniformLocation(c,"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.dimensions=a.getUniformLocation(c,"dimensions");this.uMatrix=a.getUniformLocation(c,"uMatrix");this.aVertexPosition=
a.getAttribLocation(c,"aVertexPosition");this.aPositionCoord=a.getAttribLocation(c,"aPositionCoord");this.aScale=a.getAttribLocation(c,"aScale");this.aRotation=a.getAttribLocation(c,"aRotation");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.colorAttribute=a.getAttribLocation(c,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=c};b.PixiFastShader.prototype.destroy=
function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};b.StripShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;",
"uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};b.StripShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.uSampler=a.getUniformLocation(c,
"uSampler");this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.colorAttribute=a.getAttribLocation(c,"aColor");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader=
function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);",
"   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};b.PrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.tintColor=a.getUniformLocation(c,"tint");this.aVertexPosition=
a.getAttribLocation(c,"aVertexPosition");this.colorAttribute=a.getAttribLocation(c,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};b.ComplexPrimitiveShader=function(a){this._UID=b._UID++;this.gl=a;this.program=null;this.fragmentSrc=
["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);",
"   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};b.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c);this.projectionVector=a.getUniformLocation(c,"projectionVector");this.offsetVector=a.getUniformLocation(c,"offsetVector");this.tintColor=a.getUniformLocation(c,"tint");this.color=a.getUniformLocation(c,"color");this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition");this.attributes=[this.aVertexPosition,
this.colorAttribute];this.translationMatrix=a.getUniformLocation(c,"translationMatrix");this.alpha=a.getUniformLocation(c,"alpha");this.program=c};b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};b.WebGLGraphics=function(){};b.WebGLGraphics.renderGraphics=function(a,c){var f,d=c.gl,e=c.projection,h=c.offset,g=c.shaderManager.primitiveShader;a.dirty&&b.WebGLGraphics.updateGraphics(a,d);for(var k=a._webGL[d.id],l=0;l<
k.data.length;l++)1===k.data[l].mode?(f=k.data[l],c.stencilManager.pushStencil(a,f,c),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(f.indices.length-4)),c.stencilManager.popStencil(a,f,c),this.last=f.mode):(f=k.data[l],c.shaderManager.setShader(g),g=c.shaderManager.primitiveShader,d.uniformMatrix3fv(g.translationMatrix,!1,a.worldTransform.toArray(!0)),d.uniform2f(g.projectionVector,e.x,-e.y),d.uniform2f(g.offsetVector,-h.x,-h.y),d.uniform3fv(g.tintColor,b.hex2rgb(a.tint)),d.uniform1f(g.alpha,
a.worldAlpha),d.bindBuffer(d.ARRAY_BUFFER,f.buffer),d.vertexAttribPointer(g.aVertexPosition,2,d.FLOAT,!1,24,0),d.vertexAttribPointer(g.colorAttribute,4,d.FLOAT,!1,24,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,f.indexBuffer),d.drawElements(d.TRIANGLE_STRIP,f.indices.length,d.UNSIGNED_SHORT,0))};b.WebGLGraphics.updateGraphics=function(a,c){var f=a._webGL[c.id];f||(f=a._webGL[c.id]={lastIndex:0,data:[],gl:c});a.dirty=!1;var d;if(a.clearDirty){a.clearDirty=!1;for(d=0;d<f.data.length;d++){var e=f.data[d];
e.reset();b.WebGLGraphics.graphicsDataPool.push(e)}f.data=[];f.lastIndex=0}var h;for(d=f.lastIndex;d<a.graphicsData.length;d++)e=a.graphicsData[d],e.type===b.Graphics.POLY?(e.fill&&6<e.points.length&&(10<e.points.length?(h=b.WebGLGraphics.switchMode(f,1),b.WebGLGraphics.buildComplexPoly(e,h)):(h=b.WebGLGraphics.switchMode(f,0),b.WebGLGraphics.buildPoly(e,h))),0<e.lineWidth&&(h=b.WebGLGraphics.switchMode(f,0),b.WebGLGraphics.buildLine(e,h))):(h=b.WebGLGraphics.switchMode(f,0),e.type===b.Graphics.RECT?
b.WebGLGraphics.buildRectangle(e,h):e.type===b.Graphics.CIRC||e.type===b.Graphics.ELIP?b.WebGLGraphics.buildCircle(e,h):e.type===b.Graphics.RREC&&b.WebGLGraphics.buildRoundedRectangle(e,h)),f.lastIndex++;for(d=0;d<f.data.length;d++)h=f.data[d],h.dirty&&h.upload()};b.WebGLGraphics.switchMode=function(a,c){var f;return a.data.length?(f=a.data[a.data.length-1],(f.mode!==c||1===c)&&(f=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),f.mode=c,a.data.push(f))):(f=b.WebGLGraphics.graphicsDataPool.pop()||
new b.WebGLGraphicsData(a.gl),f.mode=c,a.data.push(f)),f.dirty=!0,f};b.WebGLGraphics.buildRectangle=function(a,c){var f=a.points,d=f[0],e=f[1],h=f[2],f=f[3];if(a.fill){var g=b.hex2rgb(a.fillColor),k=a.fillAlpha,l=g[0]*k,m=g[1]*k,g=g[2]*k,n=c.points,q=c.indices,s=n.length/6;n.push(d,e);n.push(l,m,g,k);n.push(d+h,e);n.push(l,m,g,k);n.push(d,e+f);n.push(l,m,g,k);n.push(d+h,e+f);n.push(l,m,g,k);q.push(s,s,s+1,s+2,s+3,s+3)}a.lineWidth&&(k=a.points,a.points=[d,e,d+h,e,d+h,e+f,d,e+f,d,e],b.WebGLGraphics.buildLine(a,
c),a.points=k)};b.WebGLGraphics.buildRoundedRectangle=function(a,c){var f=a.points,d=f[0],e=f[1],h=f[2],g=f[3],k=f[4],f=[];if(f.push(d,e+k),f=f.concat(b.WebGLGraphics.quadraticBezierCurve(d,e+g-k,d,e+g,d+k,e+g)),f=f.concat(b.WebGLGraphics.quadraticBezierCurve(d+h-k,e+g,d+h,e+g,d+h,e+g-k)),f=f.concat(b.WebGLGraphics.quadraticBezierCurve(d+h,e+k,d+h,e,d+h-k,e)),f=f.concat(b.WebGLGraphics.quadraticBezierCurve(d+k,e,d,e,d,e+k)),a.fill){for(var g=b.hex2rgb(a.fillColor),d=a.fillAlpha,e=g[0]*d,h=g[1]*d,
g=g[2]*d,k=c.points,l=c.indices,m=k.length/6,n=b.PolyK.Triangulate(f),q=0,q=0;q<n.length;q+=3)l.push(n[q]+m),l.push(n[q]+m),l.push(n[q+1]+m),l.push(n[q+2]+m),l.push(n[q+2]+m);for(q=0;q<f.length;q++)k.push(f[q],f[++q],e,h,g,d)}a.lineWidth&&(d=a.points,a.points=f,b.WebGLGraphics.buildLine(a,c),a.points=d)};b.WebGLGraphics.quadraticBezierCurve=function(a,c,b,d,e,h){for(var g,k,l,m,n=[],q=0,s=0;20>=s;s++)q=s/20,g=a+(b-a)*q,k=c+(d-c)*q,l=b+(e-b)*q,m=d+(h-d)*q,g+=(l-g)*q,k+=(m-k)*q,n.push(g,k);return n};
b.WebGLGraphics.buildCircle=function(a,c){var f=a.points,d=f[0],e=f[1],h=f[2],f=f[3],g=2*Math.PI/40,k=0;if(a.fill){var k=b.hex2rgb(a.fillColor),l=a.fillAlpha,m=k[0]*l,n=k[1]*l,q=k[2]*l,s=c.points,p=c.indices,v=s.length/6;p.push(v);for(k=0;41>k;k++)s.push(d,e,m,n,q,l),s.push(d+Math.sin(g*k)*h,e+Math.cos(g*k)*f,m,n,q,l),p.push(v++,v++);p.push(v-1)}if(a.lineWidth){l=a.points;a.points=[];for(k=0;41>k;k++)a.points.push(d+Math.sin(g*k)*h,e+Math.cos(g*k)*f);b.WebGLGraphics.buildLine(a,c);a.points=l}};b.WebGLGraphics.buildLine=
function(a,c){var f=0,d=a.points;if(0!==d.length){if(a.lineWidth%2)for(f=0;f<d.length;f++)d[f]+=.5;var e=new b.Point(d[0],d[1]),h=new b.Point(d[d.length-2],d[d.length-1]);if(e.x===h.x&&e.y===h.y){d=d.slice();d.pop();d.pop();var h=new b.Point(d[d.length-2],d[d.length-1]),g=h.x+.5*(e.x-h.x),e=h.y+.5*(e.y-h.y);d.unshift(g,e);d.push(g,e)}var k,l,m,n,q,s,p,v,t,u,r,x,w,y,F,G,H,J,z,g=c.points,e=c.indices,h=d.length/2,K=d.length,I=g.length/6,E=a.lineWidth/2,f=b.hex2rgb(a.lineColor),A=a.lineAlpha,B=f[0]*A,
C=f[1]*A,D=f[2]*A;m=d[0];n=d[1];q=d[2];s=d[3];t=-(n-s);u=m-q;z=Math.sqrt(t*t+u*u);t=t/z*E;u=u/z*E;g.push(m-t,n-u,B,C,D,A);g.push(m+t,n+u,B,C,D,A);for(f=1;h-1>f;f++)m=d[2*(f-1)],n=d[2*(f-1)+1],q=d[2*f],s=d[2*f+1],p=d[2*(f+1)],v=d[2*(f+1)+1],t=-(n-s),u=m-q,z=Math.sqrt(t*t+u*u),t/=z,u/=z,t*=E,u*=E,r=-(s-v),x=q-p,z=Math.sqrt(r*r+x*x),r/=z,x/=z,r*=E,x*=E,F=-u+n-(-u+s),G=-t+q-(-t+m),m=(-t+m)*(-u+s)-(-t+q)*(-u+n),n=-x+v-(-x+s),H=-r+q-(-r+p),p=(-r+p)*(-x+s)-(-r+q)*(-x+v),v=F*H-n*G,.1>Math.abs(v)?(g.push(q-
t,s-u,B,C,D,A),g.push(q+t,s+u,B,C,D,A)):(k=(G*p-H*m)/v,l=(n*m-F*p)/v,J=(k-q)*(k-q)+(l-s)+(l-s),19600<J?(w=t-r,y=u-x,z=Math.sqrt(w*w+y*y),w/=z,y/=z,w*=E,y*=E,g.push(q-w,s-y),g.push(B,C,D,A),g.push(q+w,s+y),g.push(B,C,D,A),g.push(q-w,s-y),g.push(B,C,D,A),K++):(g.push(k,l),g.push(B,C,D,A),g.push(q-(k-q),s-(l-s)),g.push(B,C,D,A)));m=d[2*(h-2)];n=d[2*(h-2)+1];q=d[2*(h-1)];s=d[2*(h-1)+1];t=-(n-s);u=m-q;z=Math.sqrt(t*t+u*u);t/=z;u/=z;t*=E;u*=E;g.push(q-t,s-u);g.push(B,C,D,A);g.push(q+t,s+u);g.push(B,C,D,
A);e.push(I);for(f=0;K>f;f++)e.push(I++);e.push(I-1)}};b.WebGLGraphics.buildComplexPoly=function(a,c){var f=a.points.slice();if(!(6>f.length)){var d=c.indices;c.points=f;c.alpha=a.fillAlpha;c.color=b.hex2rgb(a.fillColor);for(var e,h,g=1/0,k=-1/0,l=1/0,m=-1/0,n=0;n<f.length;n+=2)e=f[n],h=f[n+1],g=g>e?e:g,k=e>k?e:k,l=l>h?h:l,m=h>m?h:m;f.push(g,l,k,l,k,m,g,m);f=f.length/2;for(n=0;f>n;n++)d.push(n)}};b.WebGLGraphics.buildPoly=function(a,c){var f=a.points;if(!(6>f.length)){for(var d=c.points,e=c.indices,
h=f.length/2,g=b.hex2rgb(a.fillColor),k=a.fillAlpha,l=g[0]*k,m=g[1]*k,g=g[2]*k,n=b.PolyK.Triangulate(f),q=d.length/6,s=0,s=0;s<n.length;s+=3)e.push(n[s]+q),e.push(n[s]+q),e.push(n[s+1]+q),e.push(n[s+2]+q),e.push(n[s+2]+q);for(s=0;h>s;s++)d.push(f[2*s],f[2*s+1],l,m,g,k)}};b.WebGLGraphics.graphicsDataPool=[];b.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.lastIndex=0;this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=
1;this.dirty=!0};b.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];this.lastIndex=0};b.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1};b.glContexts=
[];b.WebGLRenderer=function(a,c,f,d,e,h){b.defaultRenderer||(b.sayHello("webGL"),b.defaultRenderer=this);this.type=b.WEBGL_RENDERER;this.transparent=!!d;this.preserveDrawingBuffer=h;this.width=a||800;this.height=c||600;this.view=f||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,!1);
this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1);this.options={alpha:this.transparent,antialias:!!e,premultipliedAlpha:!!d,stencil:!0,preserveDrawingBuffer:h};var g=null;if(["experimental-webgl","webgl"].forEach(function(a){try{g=g||this.view.getContext(a,this.options)}catch(c){}},this),!g)throw Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=g;this.glContextId=g.id=b.WebGLRenderer.glContextId++;b.glContexts[this.glContextId]=
g;b.blendModesWebGL||(b.blendModesWebGL=[],b.blendModesWebGL[b.blendModes.NORMAL]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.ADD]=[g.SRC_ALPHA,g.DST_ALPHA],b.blendModesWebGL[b.blendModes.MULTIPLY]=[g.DST_COLOR,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SCREEN]=[g.SRC_ALPHA,g.ONE],b.blendModesWebGL[b.blendModes.OVERLAY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DARKEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LIGHTEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_BURN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DIFFERENCE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.EXCLUSION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HUE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
b.blendModesWebGL[b.blendModes.SATURATION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LUMINOSITY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA]);this.projection=new b.Point;this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new b.Point(0,0);this.resize(this.width,this.height);this.contextLost=!1;this.shaderManager=new b.WebGLShaderManager(g);this.spriteBatch=new b.WebGLSpriteBatch(g);this.maskManager=new b.WebGLMaskManager(g);
this.filterManager=new b.WebGLFilterManager(g,this.transparent);this.stencilManager=new b.WebGLStencilManager(g);this.blendModeManager=new b.WebGLBlendModeManager(g);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;
this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;g.useProgram(this.shaderManager.defaultShader.program);g.disable(g.DEPTH_TEST);g.disable(g.CULL_FACE);g.enable(g.BLEND);g.colorMask(!0,!0,!0,this.transparent)};b.WebGLRenderer.prototype.constructor=b.WebGLRenderer;b.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a);b.WebGLRenderer.updateTextures();a.updateTransform();
a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var c=this.gl;c.viewport(0,0,this.width,this.height);c.bindFramebuffer(c.FRAMEBUFFER,null);this.transparent?c.clearColor(0,0,0,0):c.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1);c.clear(c.COLOR_BUFFER_BIT);this.renderDisplayObject(a,this.projection);a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):
a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}};b.WebGLRenderer.prototype.renderDisplayObject=function(a,c,f){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=c;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,f);a._renderWebGL(this.renderSession);this.spriteBatch.end()};
b.WebGLRenderer.updateTextures=function(){for(var a=0,a=0;a<b.Texture.frameUpdates.length;a++)b.WebGLRenderer.updateTextureFrame(b.Texture.frameUpdates[a]);for(a=0;a<b.texturesToDestroy.length;a++)b.WebGLRenderer.destroyTexture(b.texturesToDestroy[a]);b.texturesToUpdate.length=0;b.texturesToDestroy.length=0;b.Texture.frameUpdates.length=0};b.WebGLRenderer.destroyTexture=function(a){for(var c=a._glTextures.length-1;0<=c;c--){var f=a._glTextures[c],d=b.glContexts[c];d&&f&&d.deleteTexture(f)}a._glTextures.length=
0};b.WebGLRenderer.updateTextureFrame=function(a){a._updateWebGLuvs()};b.WebGLRenderer.prototype.resize=function(a,c){this.width=a;this.height=c;this.view.width=a;this.view.height=c;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};b.createWebGLTexture=function(a,c){return a.hasLoaded&&(a._glTextures[c.id]=c.createTexture(),c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),
c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,
c.CLAMP_TO_EDGE)),c.bindTexture(c.TEXTURE_2D,null),a._dirty[c.id]=!1),a._glTextures[c.id]};b.updateWebGLTexture=function(a,c){a._glTextures[c.id]&&(c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===
b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),a._dirty[c.id]=!1)};b.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault();this.contextLost=!0};b.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",
this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(c){throw Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}var f=this.gl;f.id=b.WebGLRenderer.glContextId++;this.shaderManager.setContext(f);this.spriteBatch.setContext(f);this.primitiveBatch.setContext(f);this.maskManager.setContext(f);this.filterManager.setContext(f);this.renderSession.gl=this.gl;f.disable(f.DEPTH_TEST);f.disable(f.CULL_FACE);f.enable(f.BLEND);f.colorMask(!0,!0,
!0,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(var d in b.TextureCache)b.TextureCache[d].baseTexture._glTextures=[];this.contextLost=!1};b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);this.offset=this.projection=b.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.primitiveBatch.destroy();
this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=null};b.WebGLRenderer.glContextId=0;b.WebGLBlendModeManager=function(a){this.gl=a;this.currentBlendMode=99999};b.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=b.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(a[0],a[1]),!0};b.WebGLBlendModeManager.prototype.destroy=
function(){this.gl=null};b.WebGLMaskManager=function(a){this.maskStack=[];this.maskPosition=0;this.setContext(a);this.reverse=!1;this.count=0};b.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};b.WebGLMaskManager.prototype.pushMask=function(a,c){var f=c.gl;a.dirty&&b.WebGLGraphics.updateGraphics(a,f);a._webGL[f.id].data.length&&c.stencilManager.pushStencil(a,a._webGL[f.id].data[0],c)};b.WebGLMaskManager.prototype.popMask=function(a,c){c.stencilManager.popStencil(a,a._webGL[this.gl.id].data[0],
c)};b.WebGLMaskManager.prototype.destroy=function(){this.gl=this.maskStack=null};b.WebGLStencilManager=function(a){this.stencilStack=[];this.setContext(a);this.reverse=!0;this.count=0};b.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};b.WebGLStencilManager.prototype.pushStencil=function(a,c,b){var d=this.gl;this.bindGraphics(a,c,b);0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(c);a=this.count;
d.colorMask(!1,!1,!1,!1);d.stencilFunc(d.ALWAYS,0,255);d.stencilOp(d.KEEP,d.KEEP,d.INVERT);1===c.mode?(d.drawElements(d.TRIANGLE_FAN,c.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(c.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(a+1),255):d.stencilFunc(d.EQUAL,a+1,255),this.reverse=!this.reverse):
(this.reverse?(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,c.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,a+1,255):d.stencilFunc(d.EQUAL,255-(a+1),255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);this.count++};b.WebGLStencilManager.prototype.bindGraphics=function(a,c,f){this._currentGraphics=a;var d,e=this.gl,h=f.projection,g=f.offset;1===
c.mode?(d=f.shaderManager.complexPrimativeShader,f.shaderManager.setShader(d),e.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(d.projectionVector,h.x,-h.y),e.uniform2f(d.offsetVector,-g.x,-g.y),e.uniform3fv(d.tintColor,b.hex2rgb(a.tint)),e.uniform3fv(d.color,c.color),e.uniform1f(d.alpha,a.worldAlpha*c.alpha),e.bindBuffer(e.ARRAY_BUFFER,c.buffer),e.vertexAttribPointer(d.aVertexPosition,2,e.FLOAT,!1,8,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer)):(d=f.shaderManager.primitiveShader,
f.shaderManager.setShader(d),e.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(d.projectionVector,h.x,-h.y),e.uniform2f(d.offsetVector,-g.x,-g.y),e.uniform3fv(d.tintColor,b.hex2rgb(a.tint)),e.uniform1f(d.alpha,a.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,c.buffer),e.vertexAttribPointer(d.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(d.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer))};b.WebGLStencilManager.prototype.popStencil=
function(a,c,b){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var e=this.count;this.bindGraphics(a,c,b);d.colorMask(!1,!1,!1,!1);1===c.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(c.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,
d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,c.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)):(this.reverse?(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,c.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,
d.KEEP,d.KEEP)}};b.WebGLStencilManager.prototype.destroy=function(){this.gl=this.maskStack=null};b.WebGLShaderManager=function(a){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];this.shaderMap=[];for(var c=0;c<this.maxAttibs;c++)this.attribState[c]=!1;this.setContext(a)};b.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new b.PrimitiveShader(a);this.complexPrimativeShader=new b.ComplexPrimitiveShader(a);this.defaultShader=new b.PixiShader(a);this.fastShader=
new b.PixiFastShader(a);this.stripShader=new b.StripShader(a);this.setShader(this.defaultShader)};b.WebGLShaderManager.prototype.setAttribs=function(a){var c;for(c=0;c<this.tempAttribState.length;c++)this.tempAttribState[c]=!1;for(c=0;c<a.length;c++)this.tempAttribState[a[c]]=!0;a=this.gl;for(c=0;c<this.attribState.length;c++)this.attribState[c]!==this.tempAttribState[c]&&(this.attribState[c]=this.tempAttribState[c],this.tempAttribState[c]?a.enableVertexAttribArray(c):a.disableVertexAttribArray(c))};
b.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)};b.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};b.WebGLSpriteBatch=function(a){this.vertSize=6;this.size=2E3;var c=6*this.size;this.vertices=
new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(c);for(var b=this.lastIndexCount=0,d=0;c>b;b+=6,d+=4)this.indices[b+0]=d+0,this.indices[b+1]=d+1,this.indices[b+2]=d+2,this.indices[b+3]=d+0,this.indices[b+4]=d+2,this.indices[b+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(a);this.dirty=!0;this.textures=[];this.blendModes=[]};b.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=
a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999};b.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};b.WebGLSpriteBatch.prototype.end=function(){this.flush()};b.WebGLSpriteBatch.prototype.render=
function(a){var c=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=c.baseTexture);var b=c._uvs;if(b){var d,e,h,g,k=a.worldAlpha,l=a.tint,m=this.vertices;e=a.anchor.x;g=a.anchor.y;c.trim?(h=c.trim,e=h.x-e*h.width,d=e+c.crop.width,g=h.y-g*h.height,h=g+c.crop.height):(d=c.frame.width*(1-e),e=c.frame.width*-e,h=c.frame.height*(1-g),g=c.frame.height*-g);var c=4*this.currentBatchSize*this.vertSize,n=a.worldTransform,q=n.a,s=n.c,p=n.b,v=n.d,t=n.tx,n=n.ty;m[c++]=q*e+p*g+t;
m[c++]=v*g+s*e+n;m[c++]=b.x0;m[c++]=b.y0;m[c++]=k;m[c++]=l;m[c++]=q*d+p*g+t;m[c++]=v*g+s*d+n;m[c++]=b.x1;m[c++]=b.y1;m[c++]=k;m[c++]=l;m[c++]=q*d+p*h+t;m[c++]=v*h+s*d+n;m[c++]=b.x2;m[c++]=b.y2;m[c++]=k;m[c++]=l;m[c++]=q*e+p*h+t;m[c++]=v*h+s*e+n;m[c++]=b.x3;m[c++]=b.y3;m[c++]=k;m[c++]=l;this.textures[this.currentBatchSize]=a.texture.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++}};b.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var c=a.tilingTexture;
this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=c.baseTexture);a._uvs||(a._uvs=new b.TextureUvs);var f=a._uvs;a.tilePosition.x%=c.baseTexture.width*a.tileScaleOffset.x;a.tilePosition.y%=c.baseTexture.height*a.tileScaleOffset.y;var d=a.tilePosition.x/(c.baseTexture.width*a.tileScaleOffset.x),e=a.tilePosition.y/(c.baseTexture.height*a.tileScaleOffset.y),h=a.width/c.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),g=a.height/c.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);
f.x0=0-d;f.y0=0-e;f.x1=1*h-d;f.y1=0-e;f.x2=1*h-d;f.y2=1*g-e;f.x3=0-d;f.y3=1*g-e;var d=a.worldAlpha,e=a.tint,h=this.vertices,k=a.width,l=a.height,m=a.anchor.x,n=a.anchor.y,g=k*(1-m),k=k*-m,m=l*(1-n),l=l*-n,n=4*this.currentBatchSize*this.vertSize,q=a.worldTransform,s=q.a,p=q.c,v=q.b,t=q.d,u=q.tx,q=q.ty;h[n++]=s*k+v*l+u;h[n++]=t*l+p*k+q;h[n++]=f.x0;h[n++]=f.y0;h[n++]=d;h[n++]=e;h[n++]=s*g+v*l+u;h[n++]=t*l+p*g+q;h[n++]=f.x1;h[n++]=f.y1;h[n++]=d;h[n++]=e;h[n++]=s*g+v*m+u;h[n++]=t*m+p*g+q;h[n++]=f.x2;h[n++]=
f.y2;h[n++]=d;h[n++]=e;h[n++]=s*k+v*m+u;h[n++]=t*m+p*k+q;h[n++]=f.x3;h[n++]=f.y3;h[n++]=d;h[n++]=e;this.textures[this.currentBatchSize]=c.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++};b.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,8);a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,c,16)}this.currentBatchSize>.5*this.size?a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices):(c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),
a.bufferSubData(a.ARRAY_BUFFER,0,c));for(var b=0,d=0,e=null,h=this.renderSession.blendModeManager.currentBlendMode,g=0,k=this.currentBatchSize;k>g;g++)a=this.textures[g],c=this.blendModes[g],e===a&&h===c||(this.renderBatch(e,b,d),d=g,b=0,e=a,h=c,this.renderSession.blendModeManager.setBlendMode(h)),b++;this.renderBatch(e,b,d);this.currentBatchSize=0}};b.WebGLSpriteBatch.prototype.renderBatch=function(a,c,f){if(0!==c){var d=this.gl;d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]||b.createWebGLTexture(a,
d));a._dirty[d.id]&&b.updateWebGLTexture(this.currentBaseTexture,d);d.drawElements(d.TRIANGLES,6*c,d.UNSIGNED_SHORT,12*f);this.renderSession.drawCount++}};b.WebGLSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};b.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};b.WebGLFastSpriteBatch=function(a){this.vertSize=
10;this.size=this.maxSize=6E3;var c=6*this.maxSize;this.vertices=new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(c);this.indexBuffer=this.vertexBuffer=null;for(var b=this.lastIndexCount=0,d=0;c>b;b+=6,d+=4)this.indices[b+0]=d+0,this.indices[b+1]=d+1,this.indices[b+2]=d+2,this.indices[b+3]=d+0,this.indices[b+4]=d+2,this.indices[b+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;
this.setContext(a)};b.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};b.WebGLFastSpriteBatch.prototype.begin=function(a,c){this.renderSession=c;this.shader=this.renderSession.shaderManager.fastShader;
this.matrix=a.worldTransform.toArray(!0);this.start()};b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.render=function(a){a=a.children;var c=a[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture;c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var c=0,b=a.length;b>c;c++)this.renderSprite(a[c]);this.flush()}};b.WebGLFastSpriteBatch.prototype.renderSprite=
function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var c,b,d,e,h,g,k=this.vertices;(c=a.texture._uvs,a.texture.trim)?(e=a.texture.trim,d=e.x-a.anchor.x*e.width,b=d+a.texture.crop.width,h=e.y-a.anchor.y*e.height,e=h+a.texture.crop.height):(b=a.texture.frame.width*(1-a.anchor.x),d=a.texture.frame.width*-a.anchor.x,e=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y);g=4*this.currentBatchSize*
this.vertSize;k[g++]=d;k[g++]=h;k[g++]=a.position.x;k[g++]=a.position.y;k[g++]=a.scale.x;k[g++]=a.scale.y;k[g++]=a.rotation;k[g++]=c.x0;k[g++]=c.y1;k[g++]=a.alpha;k[g++]=b;k[g++]=h;k[g++]=a.position.x;k[g++]=a.position.y;k[g++]=a.scale.x;k[g++]=a.scale.y;k[g++]=a.rotation;k[g++]=c.x1;k[g++]=c.y1;k[g++]=a.alpha;k[g++]=b;k[g++]=e;k[g++]=a.position.x;k[g++]=a.position.y;k[g++]=a.scale.x;k[g++]=a.scale.y;k[g++]=a.rotation;k[g++]=c.x2;k[g++]=c.y2;k[g++]=a.alpha;k[g++]=d;k[g++]=e;k[g++]=a.position.x;k[g++]=
a.position.y;k[g++]=a.scale.x;k[g++]=a.scale.y;k[g++]=a.rotation;k[g++]=c.x3;k[g++]=c.y3;k[g++]=a.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};b.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,
0,this.vertices);else{var c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);
var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28);a.vertexAttribPointer(this.shader.colorAttribute,
1,a.FLOAT,!1,c,36)};b.WebGLFilterManager=function(a,c){this.transparent=c;this.filterStack=[];this.offsetY=this.offsetX=0;this.setContext(a)};b.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};b.WebGLFilterManager.prototype.begin=function(a,c){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var b=this.renderSession.projection;this.width=2*b.x;this.height=2*-b.y;this.buffer=c};b.WebGLFilterManager.prototype.pushFilter=
function(a){var c=this.gl,f=this.renderSession.projection,d=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();this.filterStack.push(a);var e=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var h=this.texturePool.pop();h?h.resize(this.width,this.height):h=new b.FilterTexture(this.gl,this.width,this.height);c.bindTexture(c.TEXTURE_2D,h.texture);var g=a._filterArea,e=e.padding;g.x-=e;g.y-=e;g.width+=2*e;g.height+=2*e;0>g.x&&(g.x=0);g.width>
this.width&&(g.width=this.width);0>g.y&&(g.y=0);g.height>this.height&&(g.height=this.height);c.bindFramebuffer(c.FRAMEBUFFER,h.frameBuffer);c.viewport(0,0,g.width,g.height);f.x=g.width/2;f.y=-g.height/2;d.x=-g.x;d.y=-g.y;this.renderSession.shaderManager.setShader(this.defaultShader);c.uniform2f(this.defaultShader.projectionVector,g.width/2,-g.height/2);c.uniform2f(this.defaultShader.offsetVector,-g.x,-g.y);c.colorMask(!0,!0,!0,!0);c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT);a._glFilterTexture=
h};b.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,c=this.filterStack.pop(),f=c._filterArea,d=c._glFilterTexture,e=this.renderSession.projection,h=this.renderSession.offset;if(1<c.filterPasses.length){a.viewport(0,0,f.width,f.height);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=f.height;this.vertexArray[2]=f.width;this.vertexArray[3]=f.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=f.width;this.vertexArray[7]=0;
a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=f.width/this.width;this.uvArray[5]=f.height/this.height;this.uvArray[6]=f.width/this.width;this.uvArray[7]=f.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var g=this.texturePool.pop();g||(g=new b.FilterTexture(this.gl,this.width,this.height));g.resize(this.width,this.height);a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var k=
0;k<c.filterPasses.length-1;k++){var l=c.filterPasses[k];a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(l,f,f.width,f.height);l=d;d=g;g=l}a.enable(a.BLEND);this.texturePool.push(g)}g=c.filterPasses[c.filterPasses.length-1];this.offsetX-=f.x;this.offsetY-=f.y;var k=this.width,l=this.height,m=0,n=0,q=this.buffer;0===this.filterStack.length?a.colorMask(!0,!0,!0,!0):(q=this.filterStack[this.filterStack.length-1],f=
q._filterArea,k=f.width,l=f.height,m=f.x,n=f.y,q=q._glFilterTexture.frameBuffer);e.x=k/2;e.y=-l/2;h.x=m;h.y=n;f=c._filterArea;e=f.x-m;h=f.y-n;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=e;this.vertexArray[1]=h+f.height;this.vertexArray[2]=e+f.width;this.vertexArray[3]=h+f.height;this.vertexArray[4]=e;this.vertexArray[5]=h;this.vertexArray[6]=e+f.width;this.vertexArray[7]=h;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=
f.width/this.width;this.uvArray[5]=f.height/this.height;this.uvArray[6]=f.width/this.width;this.uvArray[7]=f.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,k,l);a.bindFramebuffer(a.FRAMEBUFFER,q);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(g,f,k,l);this.renderSession.shaderManager.setShader(this.defaultShader);a.uniform2f(this.defaultShader.projectionVector,k/2,-l/2);a.uniform2f(this.defaultShader.offsetVector,-m,-n);this.texturePool.push(d);
c._glFilterTexture=null};b.WebGLFilterManager.prototype.applyFilterPass=function(a,c,f,d){c=this.gl;var e=a.shaders[c.id];e||(e=new b.PixiShader(c),e.fragmentSrc=a.fragmentSrc,e.uniforms=a.uniforms,e.init(),a.shaders[c.id]=e);this.renderSession.shaderManager.setShader(e);c.uniform2f(e.projectionVector,f/2,-d/2);c.uniform2f(e.offsetVector,0,0);a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],
a.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.vertexAttribPointer(e.aVertexPosition,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.vertexAttribPointer(e.aTextureCoord,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.vertexAttribPointer(e.colorAttribute,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);this.renderSession.drawCount++};
b.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvArray,
a.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};b.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null;for(var c=this.offsetY=this.offsetX=0;c<this.texturePool.length;c++)this.texturePool[c].destroy();
this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};b.FilterTexture=function(a,c,f,d){this.gl=a;this.frameBuffer=a.createFramebuffer();this.texture=a.createTexture();d=d||b.scaleModes.DEFAULT;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d===b.scaleModes.LINEAR?
a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);this.renderBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,
this.renderBuffer);this.resize(c,f)};b.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};b.FilterTexture.prototype.resize=function(a,c){if(this.width!==a||this.height!==c){this.width=a;this.height=c;var b=this.gl;b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,a,c,0,b.RGBA,b.UNSIGNED_BYTE,null);b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,a,c)}};b.FilterTexture.prototype.destroy=
function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.texture=this.frameBuffer=null};b.CanvasMaskManager=function(){};b.CanvasMaskManager.prototype.pushMask=function(a,c){c.save();var f=a.alpha,d=a.worldTransform;c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty);b.CanvasGraphics.renderGraphicsMask(a,c);c.clip();a.worldAlpha=f};b.CanvasMaskManager.prototype.popMask=function(a){a.restore()};b.CanvasTinter=function(){};b.CanvasTinter.getTintedTexture=function(a,c){var f=
a.texture;c=b.CanvasTinter.roundColor(c);var d="#"+("00000"+(0|c).toString(16)).substr(-6);if(f.tintCache=f.tintCache||{},f.tintCache[d])return f.tintCache[d];var e=b.CanvasTinter.canvas||document.createElement("canvas");if(b.CanvasTinter.tintMethod(f,c,e),b.CanvasTinter.convertTintToImage){var h=new Image;h.src=e.toDataURL();f.tintCache[d]=h}else f.tintCache[d]=e,b.CanvasTinter.canvas=null;return e};b.CanvasTinter.tintWithMultiply=function(a,c,b){var d=b.getContext("2d"),e=a.frame;b.width=e.width;
b.height=e.height;d.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6);d.fillRect(0,0,e.width,e.height);d.globalCompositeOperation="multiply";d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)};b.CanvasTinter.tintWithOverlay=function(a,c,b){var d=b.getContext("2d"),e=a.frame;b.width=e.width;b.height=e.height;d.globalCompositeOperation="copy";
d.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6);d.fillRect(0,0,e.width,e.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)};b.CanvasTinter.tintWithPerPixel=function(a,c,f){var d=f.getContext("2d"),e=a.frame;f.width=e.width;f.height=e.height;d.globalCompositeOperation="copy";d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height);f=b.hex2rgb(c);a=f[0];c=f[1];f=f[2];for(var e=d.getImageData(0,
0,e.width,e.height),h=e.data,g=0;g<h.length;g+=4)h[g+0]*=a,h[g+1]*=c,h[g+2]*=f;d.putImageData(e,0,0)};b.CanvasTinter.roundColor=function(a){var c=b.CanvasTinter.cacheStepsPerColorChannel;a=b.hex2rgb(a);return a[0]=Math.min(255,a[0]/c*c),a[1]=Math.min(255,a[1]/c*c),a[2]=Math.min(255,a[2]/c*c),b.rgb2hex(a)};b.CanvasTinter.cacheStepsPerColorChannel=8;b.CanvasTinter.convertTintToImage=!1;b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes();b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?
b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel;b.CanvasRenderer=function(a,c,f,d){b.defaultRenderer||(b.sayHello("Canvas"),b.defaultRenderer=this);this.type=b.CANVAS_RENDERER;this.clearBeforeRender=!0;this.transparent=!!d;b.blendModesCanvas||(b.blendModesCanvas=[],b.canUseNewCanvasBlendModes()?(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply",b.blendModesCanvas[b.blendModes.SCREEN]=
"screen",b.blendModesCanvas[b.blendModes.OVERLAY]="overlay",b.blendModesCanvas[b.blendModes.DARKEN]="darken",b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge",b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light",b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference",b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion",
b.blendModesCanvas[b.blendModes.HUE]="hue",b.blendModesCanvas[b.blendModes.SATURATION]="saturation",b.blendModesCanvas[b.blendModes.COLOR]="color",b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"):(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over",b.blendModesCanvas[b.blendModes.SCREEN]="source-over",b.blendModesCanvas[b.blendModes.OVERLAY]="source-over",b.blendModesCanvas[b.blendModes.DARKEN]=
"source-over",b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over",b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over",b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over",b.blendModesCanvas[b.blendModes.HUE]="source-over",b.blendModesCanvas[b.blendModes.SATURATION]=
"source-over",b.blendModesCanvas[b.blendModes.COLOR]="source-over",b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over"));this.width=a||800;this.height=c||600;this.view=f||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new b.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,
roundPixels:!1};"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")};b.CanvasRenderer.prototype.constructor=b.CanvasRenderer;b.CanvasRenderer.prototype.render=
function(a){b.texturesToUpdate.length=0;b.texturesToDestroy.length=0;a.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(a);
a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));0<b.Texture.frameUpdates.length&&(b.Texture.frameUpdates.length=0)};b.CanvasRenderer.prototype.resize=function(a,c){this.width=a;this.height=c;this.view.width=a;this.view.height=c};b.CanvasRenderer.prototype.renderDisplayObject=function(a,c){this.renderSession.context=c||this.context;a._renderCanvas(this.renderSession)};b.CanvasRenderer.prototype.renderStripFlat=function(a){var c=this.context;
a=a.verticies;var b=a.length/2;this.count++;c.beginPath();for(var d=1;b-2>d;d++){var e=2*d,h=a[e+2],g=a[e+4],k=a[e+3],l=a[e+5];c.moveTo(a[e],a[e+1]);c.lineTo(h,k);c.lineTo(g,l)}c.fillStyle="#FF0000";c.fill();c.closePath()};b.CanvasRenderer.prototype.renderStrip=function(a){var c=this.context,b=a.verticies,d=a.uvs,e=b.length/2;this.count++;for(var h=1;e-2>h;h++){var g=2*h,k=b[g],l=b[g+2],m=b[g+4],n=b[g+1],q=b[g+3],s=b[g+5],p=d[g]*a.texture.width,v=d[g+2]*a.texture.width,t=d[g+4]*a.texture.width,u=
d[g+1]*a.texture.height,r=d[g+3]*a.texture.height,g=d[g+5]*a.texture.height;c.save();c.beginPath();c.moveTo(k,n);c.lineTo(l,q);c.lineTo(m,s);c.closePath();c.clip();var x=p*r+u*t+v*g-r*t-u*v-p*g;c.transform((k*r+u*m+l*g-r*m-u*l-k*g)/x,(n*r+u*s+q*g-r*s-u*q-n*g)/x,(p*l+k*t+v*m-l*t-k*v-p*m)/x,(p*q+n*t+v*s-q*t-n*v-p*s)/x,(p*r*m+u*l*t+k*v*g-k*r*t-u*v*m-p*l*g)/x,(p*r*s+u*q*t+n*v*g-n*r*t-u*v*s-p*q*g)/x);c.drawImage(a.texture.baseTexture.source,0,0);c.restore()}};b.CanvasBuffer=function(a,c){this.width=a;
this.height=c;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=c};b.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};b.CanvasBuffer.prototype.resize=function(a,c){this.width=this.canvas.width=a;this.height=this.canvas.height=c};b.CanvasGraphics=function(){};b.CanvasGraphics.renderGraphics=function(a,c){for(var f=a.worldAlpha,d=0;d<a.graphicsData.length;d++){var e=a.graphicsData[d],
h=e.points;if(c.strokeStyle="#"+("00000"+(0|e.lineColor).toString(16)).substr(-6),c.lineWidth=e.lineWidth,e.type===b.Graphics.POLY){c.beginPath();c.moveTo(h[0],h[1]);for(var g=1;g<h.length/2;g++)c.lineTo(h[2*g],h[2*g+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath();e.fill&&(c.globalAlpha=e.fillAlpha*f,c.fillStyle="#"+("00000"+(0|e.fillColor).toString(16)).substr(-6),c.fill());e.lineWidth&&(c.globalAlpha=e.lineAlpha*f,c.stroke())}else if(e.type===b.Graphics.RECT)(e.fillColor||0===e.fillColor)&&
(c.globalAlpha=e.fillAlpha*f,c.fillStyle="#"+("00000"+(0|e.fillColor).toString(16)).substr(-6),c.fillRect(h[0],h[1],h[2],h[3])),e.lineWidth&&(c.globalAlpha=e.lineAlpha*f,c.strokeRect(h[0],h[1],h[2],h[3]));else if(e.type===b.Graphics.CIRC)c.beginPath(),c.arc(h[0],h[1],h[2],0,2*Math.PI),c.closePath(),e.fill&&(c.globalAlpha=e.fillAlpha*f,c.fillStyle="#"+("00000"+(0|e.fillColor).toString(16)).substr(-6),c.fill()),e.lineWidth&&(c.globalAlpha=e.lineAlpha*f,c.stroke());else if(e.type===b.Graphics.ELIP){var k=
e.points,l=2*k[2],m=2*k[3],g=k[0]-l/2,k=k[1]-m/2;c.beginPath();var n=l/2*.5522848,h=m/2*.5522848,q=g+l,p=k+m,l=g+l/2,m=k+m/2;c.moveTo(g,m);c.bezierCurveTo(g,m-h,l-n,k,l,k);c.bezierCurveTo(l+n,k,q,m-h,q,m);c.bezierCurveTo(q,m+h,l+n,p,l,p);c.bezierCurveTo(l-n,p,g,m+h,g,m);c.closePath();e.fill&&(c.globalAlpha=e.fillAlpha*f,c.fillStyle="#"+("00000"+(0|e.fillColor).toString(16)).substr(-6),c.fill());e.lineWidth&&(c.globalAlpha=e.lineAlpha*f,c.stroke())}else e.type===b.Graphics.RREC&&(g=h[0],m=h[1],k=h[2],
n=h[3],h=h[4],q=Math.min(k,n)/2|0,h=h>q?q:h,c.beginPath(),c.moveTo(g,m+h),c.lineTo(g,m+n-h),c.quadraticCurveTo(g,m+n,g+h,m+n),c.lineTo(g+k-h,m+n),c.quadraticCurveTo(g+k,m+n,g+k,m+n-h),c.lineTo(g+k,m+h),c.quadraticCurveTo(g+k,m,g+k-h,m),c.lineTo(g+h,m),c.quadraticCurveTo(g,m,g,m+h),c.closePath(),(e.fillColor||0===e.fillColor)&&(c.globalAlpha=e.fillAlpha*f,c.fillStyle="#"+("00000"+(0|e.fillColor).toString(16)).substr(-6),c.fill()),e.lineWidth&&(c.globalAlpha=e.lineAlpha*f,c.stroke()))}};b.CanvasGraphics.renderGraphicsMask=
function(a,c){var f=a.graphicsData.length;if(0!==f)for(1<f&&window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"),f=0;1>f;f++){var d=a.graphicsData[f],e=d.points;if(d.type===b.Graphics.POLY){c.beginPath();c.moveTo(e[0],e[1]);for(d=1;d<e.length/2;d++)c.lineTo(e[2*d],e[2*d+1]);e[0]===e[e.length-2]&&e[1]===e[e.length-1]&&c.closePath()}else if(d.type===b.Graphics.RECT)c.beginPath(),c.rect(e[0],e[1],e[2],e[3]),c.closePath();else if(d.type===b.Graphics.CIRC)c.beginPath(),
c.arc(e[0],e[1],e[2],0,2*Math.PI),c.closePath();else if(d.type===b.Graphics.ELIP){var h=d.points,g=2*h[2],d=2*h[3],e=h[0]-g/2,h=h[1]-d/2;c.beginPath();var k=g/2*.5522848,l=d/2*.5522848,m=e+g,n=h+d,g=e+g/2,d=h+d/2;c.moveTo(e,d);c.bezierCurveTo(e,d-l,g-k,h,g,h);c.bezierCurveTo(g+k,h,m,d-l,m,d);c.bezierCurveTo(m,d+l,g+k,n,g,n);c.bezierCurveTo(g-k,n,e,d+l,e,d);c.closePath()}else d.type===b.Graphics.RREC&&(d=e[0],h=e[1],k=e[2],l=e[3],e=e[4],m=Math.min(k,l)/2|0,e=e>m?m:e,c.beginPath(),c.moveTo(d,h+e),c.lineTo(d,
h+l-e),c.quadraticCurveTo(d,h+l,d+e,h+l),c.lineTo(d+k-e,h+l),c.quadraticCurveTo(d+k,h+l,d+k,h+l-e),c.lineTo(d+k,h+e),c.quadraticCurveTo(d+k,h,d+k-e,h),c.lineTo(d+e,h),c.quadraticCurveTo(d,h,d,h+e),c.closePath())}};b.Graphics=function(){b.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=!1;this.bounds=null;this.boundsPadding=
10;this.dirty=!0};b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Graphics.prototype.constructor=b.Graphics;Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});b.Graphics.prototype.lineStyle=function(a,c,f){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=c||0,
this.lineAlpha=3>arguments.length?1:f,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this};b.Graphics.prototype.moveTo=function(a,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,
fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.currentPath.points.push(a,c),this.graphicsData.push(this.currentPath),this};b.Graphics.prototype.lineTo=function(a,c){return this.currentPath.points.push(a,c),this.dirty=!0,this};b.Graphics.prototype.quadraticCurveTo=function(a,c,b,d){0===this.currentPath.points.length&&this.moveTo(0,0);var e,h,g=this.currentPath.points;0===g.length&&this.moveTo(0,0);for(var k=g[g.length-2],l=g[g.length-1],m=0,n=1;20>=n;n++)m=n/20,e=k+
(a-k)*m,h=l+(c-l)*m,g.push(e+(a+(b-a)*m-e)*m,h+(c+(d-c)*m-h)*m);return this.dirty=!0,this};b.Graphics.prototype.bezierCurveTo=function(a,c,b,d,e,h){0===this.currentPath.points.length&&this.moveTo(0,0);for(var g,k,l,m,n,q=this.currentPath.points,p=q[q.length-2],r=q[q.length-1],v=0,t=1;20>t;t++)v=t/20,g=1-v,k=g*g,l=k*g,m=v*v,n=m*v,q.push(l*p+3*k*v*a+3*g*m*b+n*e,l*r+3*k*v*c+3*g*m*d+n*h);return this.dirty=!0,this};b.Graphics.prototype.arcTo=function(a,c,b,d,e){0===this.currentPath.points.length&&this.moveTo(a,
c);var h=this.currentPath.points,g=h[h.length-1]-c,k=h[h.length-2]-a;d-=c;b-=a;var l=Math.abs(g*b-k*d);if(1E-8>l||0===e)h.push(a,c);else{var m=g*g+k*k,n=d*d+b*b,q=g*d+k*b,h=e*Math.sqrt(m)/l,l=e*Math.sqrt(n)/l,m=h*q/m,p=l*q/n,n=h*b+l*k,q=h*d+l*g,r=b*(h+p),h=d*(h+p),l=Math.atan2(g*(l+m)-q,k*(l+m)-n),h=Math.atan2(h-q,r-n);this.arc(n+a,q+c,e,l,h,k*d>b*g)}return this.dirty=!0,this};b.Graphics.prototype.arc=function(a,c,b,d,e,h){var g=a+Math.cos(d)*b,k=c+Math.sin(d)*b,l=this.currentPath.points;if((0!==
l.length&&l[l.length-2]!==g||l[l.length-1]!==k)&&(this.moveTo(g,k),l=this.currentPath.points),d===e)return this;!h&&d>=e?e+=2*Math.PI:h&&e>=d&&(d+=2*Math.PI);e=h?-1*(d-e):e-d;var m=Math.abs(e)/(2*Math.PI)*40;if(0===e)return this;e/=2*m;h=2*e;for(var g=Math.cos(e),k=Math.sin(e),m=m-1,n=m%1/m,q=0;m>=q;q++){var p=e+d+h*(q+n*q),r=Math.cos(p),p=-Math.sin(p);l.push((g*r+k*p)*b+a,(g*-p+k*r)*b+c)}return this.dirty=!0,this};b.Graphics.prototype.drawPath=function(a){return this.currentPath.points.length||this.graphicsData.pop(),
this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(a),this.dirty=!0,this};b.Graphics.prototype.beginFill=function(a,c){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=2>arguments.length?1:c,this};b.Graphics.prototype.endFill=function(){return this.filling=
!1,this.fillColor=null,this.fillAlpha=1,this};b.Graphics.prototype.drawRect=function(a,c,f,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,f,d],type:b.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawRoundedRect=function(a,c,f,d,e){return this.currentPath.points.length||
this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,f,d,e],type:b.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawCircle=function(a,c,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,
fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,f,f],type:b.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};b.Graphics.prototype.drawEllipse=function(a,c,f,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,f,d],type:b.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=
!0,this};b.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this};b.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),c=new b.CanvasBuffer(a.width,a.height),f=b.Texture.fromCanvas(c.canvas);return c.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,c.context),f};b.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return this.dirty&&
(this._generateCachedSprite(),b.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a),void 0;if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=b.blendModesWebGL[a.spriteBatch.currentBlendMode];
a.spriteBatch.gl.blendFunc(c[0],c[1])}if(b.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var c=0,f=this.children.length;f>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;a.spriteBatch.start()}};b.Graphics.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){var c=a.context,f=this.worldTransform;this.blendMode!==
a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a.context);c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty);b.CanvasGraphics.renderGraphics(this,c);c=0;for(f=this.children.length;f>c;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};b.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var c=this.bounds.x,b=this.bounds.width+this.bounds.x,
d=this.bounds.y,e=this.bounds.height+this.bounds.y;a=a||this.worldTransform;var h=a.a,g=a.c,k=a.b,l=a.d,m=a.tx,n=a.ty,q=h*b+k*e+m,p=l*e+g*b+n;a=h*c+k*e+m;var e=l*e+g*c+n,r=h*c+k*d+m,c=l*d+g*c+n,h=h*b+k*d+m,b=l*d+g*b+n,d=q,g=p,q=q>a?a:q,q=q>r?r:q,q=q>h?h:q,p=p>e?e:p,p=p>c?c:p,p=p>b?b:p,d=a>d?a:d,d=r>d?r:d,g=e>g?e:g,g=c>g?c:g;a=this._bounds;return a.x=q,a.width=(h>d?h:d)-q,a.y=p,a.height=(b>g?b:g)-p,a};b.Graphics.prototype.updateBounds=function(){for(var a,c,f,d,e,h=1/0,g=-1/0,k=1/0,l=-1/0,m=0;m<this.graphicsData.length;m++)if(a=
this.graphicsData[m],c=a.type,e=a.lineWidth,a=a.points,c===b.Graphics.RECT)c=a[0]-e/2,f=a[1]-e/2,d=a[2]+e,e=a[3]+e,h=h>c?c:h,g=c+d>g?c+d:g,k=k>f?c:k,l=f+e>l?f+e:l;else if(c===b.Graphics.CIRC||c===b.Graphics.ELIP)c=a[0],f=a[1],d=a[2]+e/2,e=a[3]+e/2,h=h>c-d?c-d:h,g=c+d>g?c+d:g,k=k>f-e?f-e:k,l=f+e>l?f+e:l;else for(d=0;d<a.length;d+=2)c=a[d],f=a[d+1],h=h>c-e?c-e:h,g=c+e>g?c+e:g,k=k>f-e?f-e:k,l=f+e>l?f+e:l;m=this.boundsPadding;this.bounds=new b.Rectangle(h-m,k-m,g-h+2*m,l-k+2*m)};b.Graphics.prototype._generateCachedSprite=
function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new b.CanvasBuffer(a.width,a.height),f=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(f);this._cachedSprite.buffer=c;this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);
this._cachedSprite.alpha=this.alpha};b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};b.Graphics.POLY=0;b.Graphics.RECT=1;b.Graphics.CIRC=2;b.Graphics.ELIP=3;b.Graphics.RREC=4;b.Strip=function(a){b.DisplayObjectContainer.call(this);this.texture=a;this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new b.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new b.Float32Array([1,1,1,1]);this.indices=new b.Uint16Array([0,1,2,
3]);this.dirty=!0};b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Strip.prototype.constructor=b.Strip;b.Strip.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())};b.Strip.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();
this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.verticies,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW)};b.Strip.prototype._renderStrip=function(a){var c=
a.gl,f=a.projection,d=a.offset;a=a.shaderManager.stripShader;c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.uniformMatrix3fv(a.translationMatrix,!1,this.worldTransform.toArray(!0));c.uniform2f(a.projectionVector,f.x,-f.y);c.uniform2f(a.offsetVector,-d.x,-d.y);c.uniform1f(a.alpha,1);this.dirty?(this.dirty=!1,c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,this.verticies,c.STATIC_DRAW),c.vertexAttribPointer(a.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),
c.bufferData(c.ARRAY_BUFFER,this.uvs,c.STATIC_DRAW),c.vertexAttribPointer(a.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW)):(c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,this.verticies),c.vertexAttribPointer(a.aVertexPosition,
2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.vertexAttribPointer(a.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer));c.drawElements(c.TRIANGLE_STRIP,this.indices.length,c.UNSIGNED_SHORT,0)};b.Strip.prototype._renderCanvas=function(a){var c=a.context,b=this.worldTransform;a.roundPixels?c.setTransform(b.a,
b.c,b.b,b.d,0|b.tx,0|b.ty):c.setTransform(b.a,b.c,b.b,b.d,b.tx,b.ty);a=this.verticies;var b=this.uvs,d=a.length/2;this.count++;for(var e=0;d-2>e;e++){var h=2*e,g=a[h],k=a[h+2],l=a[h+4],m=a[h+1],n=a[h+3],p=a[h+5],s=(g+k+l)/3,r=(m+n+p)/3,v=g-s,t=m-r,u=Math.sqrt(v*v+t*t),g=s+v/u*(u+3),m=r+t/u*(u+3),v=k-s,t=n-r,u=Math.sqrt(v*v+t*t),k=s+v/u*(u+3),n=r+t/u*(u+3),v=l-s,t=p-r,u=Math.sqrt(v*v+t*t),l=s+v/u*(u+3),p=r+t/u*(u+3),s=b[h]*this.texture.width,r=b[h+2]*this.texture.width,v=b[h+4]*this.texture.width,
t=b[h+1]*this.texture.height,u=b[h+3]*this.texture.height,h=b[h+5]*this.texture.height;c.save();c.beginPath();c.moveTo(g,m);c.lineTo(k,n);c.lineTo(l,p);c.closePath();c.clip();var w=s*u+t*v+r*h-u*v-t*r-s*h;c.transform((g*u+t*l+k*h-u*l-t*k-g*h)/w,(m*u+t*p+n*h-u*p-t*n-m*h)/w,(s*k+g*v+r*l-k*v-g*r-s*l)/w,(s*n+m*v+r*p-n*v-m*r-s*p)/w,(s*u*l+t*k*v+g*r*h-g*u*v-t*r*l-s*k*h)/w,(s*u*p+t*n*v+m*r*h-m*u*v-t*r*p-s*n*h)/w);c.drawImage(this.texture.baseTexture.source,0,0);c.restore()}};b.Strip.prototype.onTextureUpdate=
function(){this.updateFrame=!0};b.Rope=function(a,c){b.Strip.call(this,a);this.points=c;this.verticies=new b.Float32Array(4*c.length);this.uvs=new b.Float32Array(4*c.length);this.colors=new b.Float32Array(2*c.length);this.indices=new b.Uint16Array(2*c.length);this.refresh()};b.Rope.prototype=Object.create(b.Strip.prototype);b.Rope.prototype.constructor=b.Rope;b.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var c=this.uvs,b=this.indices,d=this.colors;this.count-=.2;c[0]=0;c[1]=
0;c[2]=0;c[3]=1;d[0]=1;d[1]=1;b[0]=0;b[1]=1;for(var e,h=a.length,g=1;h>g;g++)a=4*g,e=g/(h-1),c[a]=e,c[a+1]=0,c[a+2]=e,c[a+3]=1,a=2*g,d[a]=1,d[a+1]=1,a=2*g,b[a]=a,b[a+1]=a+1}};b.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var c,f=a[0],d=c=0;this.count-=.2;for(var e,h,g,k=this.verticies,l=a.length,m=0;l>m;m++)e=a[m],h=4*m,c=m<a.length-1?a[m+1]:e,d=-(c.x-f.x),c=c.y-f.y,f=Math.sqrt(c*c+d*d),g=this.texture.height/2,c/=f,d/=f,c*=g,d*=g,k[h]=e.x+c,k[h+1]=e.y+d,k[h+2]=e.x-
c,k[h+3]=e.y-d,f=e;b.DisplayObjectContainer.prototype.updateTransform.call(this)}};b.Rope.prototype.setTexture=function(a){this.texture=a};b.TilingSprite=function(a,c,f){b.Sprite.call(this,a);this._width=c||100;this._height=f||100;this.tileScale=new b.Point(1,1);this.tileScaleOffset=new b.Point(1,1);this.tilePosition=new b.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL};b.TilingSprite.prototype=Object.create(b.Sprite.prototype);b.TilingSprite.prototype.constructor=
b.TilingSprite;Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}});b.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)};b.TilingSprite.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha){var c,f;this._mask&&
(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start());this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock));!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(b.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this);c=0;for(f=this.children.length;f>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop();
this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(a);a.spriteBatch.start()}};b.TilingSprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){var c=a.context;this._mask&&a.maskManager.pushMask(this._mask,c);c.globalAlpha=this.worldAlpha;var f;f=this.worldTransform;if(c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=c.createPattern(this.tilingTexture.baseTexture.source,
"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);f=this.tilePosition;var d=this.tileScale;f.x%=this.tilingTexture.baseTexture.width;f.y%=this.tilingTexture.baseTexture.height;c.scale(d.x,d.y);c.translate(f.x,f.y);c.fillStyle=this.__tilePattern;c.fillRect(-f.x+this.anchor.x*-this._width,-f.y+this.anchor.y*-this._height,this._width/d.x,this._height/d.y);c.scale(1/d.x,1/d.y);c.translate(-f.x,-f.y);this._mask&&
a.maskManager.popMask(a.context);c=0;for(f=this.children.length;f>c;c++)this.children[c]._renderCanvas(a)}};b.TilingSprite.prototype.getBounds=function(){var a=this._width,c=this._height,b=a*(1-this.anchor.x),d=a*-this.anchor.x,e=c*(1-this.anchor.y),h=c*-this.anchor.y,c=this.worldTransform,g=c.a,k=c.c,l=c.b,m=c.d,n=c.tx,p=c.ty,c=g*d+l*h+n,a=m*h+k*d+p,s=g*b+l*h+n,h=m*h+k*b+p,r=g*b+l*e+n,b=m*e+k*b+p,g=g*d+l*e+n,d=m*e+k*d+p,e=-1/0,k=-1/0,m=1/0,l=1/0,m=m>c?c:m,m=m>s?s:m,m=m>r?r:m,m=m>g?g:m,l=l>a?a:l,
l=l>h?h:l,l=l>b?b:l,l=l>d?d:l,e=c>e?c:e,e=s>e?s:e,e=r>e?r:e,k=a>k?a:k,k=h>k?h:k,k=b>k?b:k,c=this._bounds;return c.x=m,c.width=(g>e?g:e)-m,c.y=l,c.height=(d>k?d:k)-l,this._currentBounds=c,c};b.TilingSprite.prototype.onTextureUpdate=function(){};b.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var c,f,d=this.texture,e=d.frame,h=e.width!==d.baseTexture.width||e.height!==d.baseTexture.height,g=!1;if(a?(c=b.getNextPowerOfTwo(e.width),f=b.getNextPowerOfTwo(e.height),
(e.width!==c||e.height!==f)&&(g=!0)):h&&(c=e.width,f=e.height,g=!0),g){var k;this.tilingTexture&&this.tilingTexture.isTiling?(k=this.tilingTexture.canvasBuffer,k.resize(c,f),this.tilingTexture.baseTexture.width=c,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(k=new b.CanvasBuffer(c,f),this.tilingTexture=b.Texture.fromCanvas(k.canvas),this.tilingTexture.canvasBuffer=k,this.tilingTexture.isTiling=!0);k.context.drawImage(d.baseTexture.source,d.crop.x,d.crop.y,d.crop.width,
d.crop.height,0,0,c,f);this.tileScaleOffset.x=e.width/c;this.tileScaleOffset.y=e.height/f}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=d;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};var p={BoneData:function(a,c){this.name=a;this.parent=c}};p.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1};p.SlotData=function(a,c){this.name=a;this.boneData=c};p.SlotData.prototype=
{r:1,g:1,b:1,a:1,attachmentName:null};p.Bone=function(a,c){this.data=a;this.parent=c;this.setToSetupPose()};p.Bone.yDown=!1;p.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,c){var b=this.parent;null!=b?(this.worldX=this.x*b.m00+this.y*b.m01+b.worldX,this.worldY=this.x*b.m10+this.y*b.m11+b.worldY,this.worldScaleX=b.worldScaleX*this.scaleX,this.worldScaleY=b.worldScaleY*this.scaleY,
this.worldRotation=b.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,b=Math.cos(d),d=Math.sin(d);this.m00=b*this.worldScaleX;this.m10=d*this.worldScaleX;this.m01=-d*this.worldScaleY;this.m11=b*this.worldScaleY;a&&(this.m00=-this.m00,this.m01=-this.m01);c&&(this.m10=-this.m10,this.m11=-this.m11);p.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=
this.data;this.x=a.x;this.y=a.y;this.rotation=a.rotation;this.scaleX=a.scaleX;this.scaleY=a.scaleY}};p.Slot=function(a,c,b){this.data=a;this.skeleton=c;this.bone=b;this.setToSetupPose()};p.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a;this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=
this.data;this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a;for(var c=this.skeleton.data.slots,b=0,d=c.length;d>b;b++)if(c[b]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(b,a.attachmentName):null);break}}};p.Skin=function(a){this.name=a;this.attachments={}};p.Skin.prototype={addAttachment:function(a,c,b){this.attachments[a+":"+c]=b},getAttachment:function(a,c){return this.attachments[a+":"+c]},_attachAll:function(a,c){for(var b in c.attachments){var d=b.indexOf(":"),e=
parseInt(b.substring(0,d),10),h=b.substring(d+1),d=a.slots[e];d.attachment&&d.attachment.name==h&&(e=this.getAttachment(e,h))&&d.setAttachment(e)}}};p.Animation=function(a,c,b){this.name=a;this.timelines=c;this.duration=b};p.Animation.prototype={apply:function(a,c,b){b&&this.duration&&(c%=this.duration);b=this.timelines;for(var d=0,e=b.length;e>d;d++)b[d].apply(a,c,1)},mix:function(a,c,b,d){b&&this.duration&&(c%=this.duration);b=this.timelines;for(var e=0,h=b.length;h>e;e++)b[e].apply(a,c,d)}};p.binarySearch=
function(a,c,b){var d=0,e=Math.floor(a.length/b)-2;if(!e)return b;for(var h=e>>>1;;){if(a[(h+1)*b]<=c?d=h+1:e=h,d==e)return(d+1)*b;h=d+e>>>1}};p.linearSearch=function(a,c,b){for(var d=0,e=a.length-b;e>=d;d+=b)if(a[d]>c)return d;return-1};p.Curves=function(a){this.curves=[];this.curves.length=6*(a-1)};p.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,c,b,d,e){var h=.1*.1,g=.1*h,k=3*.1,l=3*h,h=6*h,m=6*g,n=2*-c+d,p=2*-b+e;d=
3*(c-d)+1;e=3*(b-e)+1;a*=6;var s=this.curves;s[a]=c*k+n*l+d*g;s[a+1]=b*k+p*l+e*g;s[a+2]=n*h+d*m;s[a+3]=p*h+e*m;s[a+4]=d*m;s[a+5]=e*m},getCurvePercent:function(a,c){c=0>c?0:1<c?1:c;var b=6*a,d=this.curves,e=d[b];if(!e)return c;if(-1==e)return 0;for(var h=d[b+1],g=d[b+2],k=d[b+3],l=d[b+4],m=d[b+5],b=e,d=h,n=8;;){if(b>=c)return e=b-e,h=d-h,h+(d-h)*(c-e)/(b-e);if(!n)break;n--;e+=g;h+=k;g+=l;k+=m;b+=e;d+=h}return d+(1-d)*(c-b)/(1-b)}};p.RotateTimeline=function(a){this.curves=new p.Curves(a);this.frames=
[];this.frames.length=2*a};p.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,c,b){a*=2;this.frames[a]=c;this.frames[a+1]=b},apply:function(a,c,b){var d;d=this.frames;if(!(c<d[0])){a=a.bones[this.boneIndex];if(c>=d[d.length-2]){for(d=a.data.rotation+d[d.length-1]-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;return a.rotation+=d*b,void 0}var e=p.binarySearch(d,c,2),h=d[e-1],g=d[e];c=1-(c-g)/(d[e-2]-g);c=this.curves.getCurvePercent(e/2-
1,c);for(d=d[e+1]-h;180<d;)d-=360;for(;-180>d;)d+=360;for(d=a.data.rotation+(h+d*c)-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;a.rotation+=d*b}}};p.TranslateTimeline=function(a){this.curves=new p.Curves(a);this.frames=[];this.frames.length=3*a};p.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,c,b,d){a*=3;this.frames[a]=c;this.frames[a+1]=b;this.frames[a+2]=d},apply:function(a,c,b){var d=this.frames;if(!(c<d[0])){a=a.bones[this.boneIndex];
if(c>=d[d.length-3])return a.x+=(a.data.x+d[d.length-2]-a.x)*b,a.y+=(a.data.y+d[d.length-1]-a.y)*b,void 0;var e=p.binarySearch(d,c,3),h=d[e-2],g=d[e-1],k=d[e];c=1-(c-k)/(d[e+-3]-k);c=this.curves.getCurvePercent(e/3-1,c);a.x+=(a.data.x+h+(d[e+1]-h)*c-a.x)*b;a.y+=(a.data.y+g+(d[e+2]-g)*c-a.y)*b}}};p.ScaleTimeline=function(a){this.curves=new p.Curves(a);this.frames=[];this.frames.length=3*a};p.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,
c,b,d){a*=3;this.frames[a]=c;this.frames[a+1]=b;this.frames[a+2]=d},apply:function(a,c,b){var d=this.frames;if(!(c<d[0])){a=a.bones[this.boneIndex];if(c>=d[d.length-3])return a.scaleX+=(a.data.scaleX-1+d[d.length-2]-a.scaleX)*b,a.scaleY+=(a.data.scaleY-1+d[d.length-1]-a.scaleY)*b,void 0;var e=p.binarySearch(d,c,3),h=d[e-2],g=d[e-1],k=d[e];c=1-(c-k)/(d[e+-3]-k);c=this.curves.getCurvePercent(e/3-1,c);a.scaleX+=(a.data.scaleX-1+h+(d[e+1]-h)*c-a.scaleX)*b;a.scaleY+=(a.data.scaleY-1+g+(d[e+2]-g)*c-a.scaleY)*
b}}};p.ColorTimeline=function(a){this.curves=new p.Curves(a);this.frames=[];this.frames.length=5*a};p.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,c,b,d,e,h){a*=5;this.frames[a]=c;this.frames[a+1]=b;this.frames[a+2]=d;this.frames[a+3]=e;this.frames[a+4]=h},apply:function(a,c,b){var d=this.frames;if(!(c<d[0])){a=a.slots[this.slotIndex];if(c>=d[d.length-5])return b=d.length-1,a.r=d[b-3],a.g=d[b-2],a.b=d[b-1],a.a=d[b],void 0;var e=p.binarySearch(d,
c,5),h=d[e-4],g=d[e-3],k=d[e-2],l=d[e-1],m=d[e];c=1-(c-m)/(d[e-5]-m);c=this.curves.getCurvePercent(e/5-1,c);h+=(d[e+1]-h)*c;g+=(d[e+2]-g)*c;k+=(d[e+3]-k)*c;d=l+(d[e+4]-l)*c;1>b?(a.r+=(h-a.r)*b,a.g+=(g-a.g)*b,a.b+=(k-a.b)*b,a.a+=(d-a.a)*b):(a.r=h,a.g=g,a.b=k,a.a=d)}}};p.AttachmentTimeline=function(a){this.curves=new p.Curves(a);this.frames=[];this.frames.length=a;this.attachmentNames=[];this.attachmentNames.length=a};p.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},
setFrame:function(a,c,b){this.frames[a]=c;this.attachmentNames[a]=b},apply:function(a,c){var b=this.frames;c<b[0]||(b=c>=b[b.length-1]?b.length-1:p.binarySearch(b,c,1)-1,b=this.attachmentNames[b],a.slots[this.slotIndex].setAttachment(b?a.getAttachmentBySlotIndex(this.slotIndex,b):null))}};p.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.animations=[]};p.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var c=this.bones,b=0,d=c.length;d>b;b++)if(c[b].name==a)return c[b];
return null},findBoneIndex:function(a){for(var c=this.bones,b=0,d=c.length;d>b;b++)if(c[b].name==a)return b;return-1},findSlot:function(a){for(var c=this.slots,b=0,d=c.length;d>b;b++)if(c[b].name==a)return slot[b];return null},findSlotIndex:function(a){for(var c=this.slots,b=0,d=c.length;d>b;b++)if(c[b].name==a)return b;return-1},findSkin:function(a){for(var c=this.skins,b=0,d=c.length;d>b;b++)if(c[b].name==a)return c[b];return null},findAnimation:function(a){for(var c=this.animations,b=0,d=c.length;d>
b;b++)if(c[b].name==a)return c[b];return null}};p.Skeleton=function(a){this.data=a;this.bones=[];for(var c=0,b=a.bones.length;b>c;c++){var d=a.bones[c],e=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new p.Bone(d,e))}this.slots=[];this.drawOrder=[];c=0;for(b=a.slots.length;b>c;c++)d=a.slots[c],e=this.bones[a.bones.indexOf(d.boneData)],d=new p.Slot(d,this,e),this.slots.push(d),this.drawOrder.push(d)};p.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,
updateWorldTransform:function(){for(var a=this.flipX,c=this.flipY,b=this.bones,d=0,e=b.length;e>d;d++)b[d].updateWorldTransform(a,c)},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,f=a.length;f>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,f=a.length;f>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=
this.bones,f=0,d=b.length;d>f;f++)if(b[f].data.name==a)return b[f];return null},findBoneIndex:function(a){for(var b=this.bones,f=0,d=b.length;d>f;f++)if(b[f].data.name==a)return f;return-1},findSlot:function(a){for(var b=this.slots,f=0,d=b.length;d>f;f++)if(b[f].data.name==a)return b[f];return null},findSlotIndex:function(a){for(var b=this.slots,f=0,d=b.length;d>f;f++)if(b[f].data.name==a)return f;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},
setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin);this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var f=this.skin.getAttachment(a,b);if(f)return f}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var f=this.slots,d=0,e=f.size;e>d;d++){var h=f[d];if(h.data.name==a){f=null;if(b&&(f=this.getAttachment(d,b),
null==f))throw"Attachment not found: "+b+", for slot: "+a;return h.setAttachment(f),void 0}}throw"Slot not found: "+a;},update:function(a){time+=a}};p.AttachmentType={region:0};p.RegionAttachment=function(){this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};p.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,
b,f,d,e){var h=this.uvs;e?(h[2]=a,h[3]=d,h[4]=a,h[5]=b,h[6]=f,h[7]=b,h[0]=f,h[1]=d):(h[0]=a,h[1]=d,h[2]=a,h[3]=b,h[4]=f,h[5]=b,h[6]=f,h[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,f=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=f+this.regionWidth*a,a=d+this.regionHeight*b,b=this.rotation*Math.PI/180,h=Math.cos(b),g=Math.sin(b),b=f*h+this.x,f=f*g,k=d*h+this.y,
d=d*g,l=e*h+this.x,e=e*g,h=a*h+this.y,a=a*g,g=this.offset;g[0]=b-d;g[1]=k+f;g[2]=b-a;g[3]=h+f;g[4]=l-a;g[5]=h+e;g[6]=l-d;g[7]=k+e},computeVertices:function(a,b,f,d){a+=f.worldX;b+=f.worldY;var e=f.m00,h=f.m01,g=f.m10;f=f.m11;var k=this.offset;d[0]=k[0]*e+k[1]*h+a;d[1]=k[0]*g+k[1]*f+b;d[2]=k[2]*e+k[3]*h+a;d[3]=k[2]*g+k[3]*f+b;d[4]=k[4]*e+k[5]*h+a;d[5]=k[4]*g+k[5]*f+b;d[6]=k[6]*e+k[7]*h+a;d[7]=k[6]*g+k[7]*f+b}};p.AnimationStateData=function(a){this.skeletonData=a;this.animationToMixTime={}};p.AnimationStateData.prototype=
{defaultMix:0,setMixByName:function(a,b,f){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;a=this.skeletonData.findAnimation(b);if(!a)throw"Animation not found: "+b;this.setMix(d,a,f)},setMix:function(a,b,f){this.animationToMixTime[a.name+":"+b.name]=f},getMix:function(a,b){var f=this.animationToMixTime[a.name+":"+b.name];return f?f:this.defaultMix}};p.AnimationState=function(a){this.data=a;this.queue=[]};p.AnimationState.prototype={animationSpeed:1,current:null,previous:null,
currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,0<this.queue.length)a=this.queue[0],this.currentTime>=a.delay&&(this._setAnimation(a.animation,a.loop),this.queue.shift())},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;1<=b&&(b=1,this.previous=null);this.current.mix(a,
this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.current=this.previous=null;this.queue.length=0},_setAnimation:function(a,b){this.previous=null;a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),0<this.mixDuration&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop));this.current=a;this.currentLoop=b;this.currentTime=0},setAnimationByName:function(a,
b){var f=this.data.skeletonData.findAnimation(a);if(!f)throw"Animation not found: "+a;this.setAnimation(f,b)},setAnimation:function(a,b){this.queue.length=0;this._setAnimation(a,b)},addAnimationByName:function(a,b,f){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,f)},addAnimation:function(a,b,f){var d={};if(d.animation=a,d.loop=b,!f||0>=f)b=this.queue.length?this.queue[this.queue.length-1].animation:this.current,f=null!=b?b.duration-this.data.getMix(b,
a)+(f||0):0;d.delay=f;this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}};p.SkeletonJson=function(a){this.attachmentLoader=a};p.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,f=new p.SkeletonData,d=a.bones,e=0,h=d.length;h>e;e++){var g=d[e];b=null;if(g.parent&&(b=f.findBone(g.parent),!b))throw"Parent bone not found: "+g.parent;b=new p.BoneData(g.name,b);b.length=(g.length||0)*this.scale;b.x=(g.x||0)*this.scale;b.y=(g.y||
0)*this.scale;b.rotation=g.rotation||0;b.scaleX=g.scaleX||1;b.scaleY=g.scaleY||1;f.bones.push(b)}d=a.slots;e=0;for(h=d.length;h>e;e++){g=d[e];if(b=f.findBone(g.bone),!b)throw"Slot bone not found: "+g.bone;var k=new p.SlotData(g.name,b),l=g.color;l&&(k.r=p.SkeletonJson.toColor(l,0),k.g=p.SkeletonJson.toColor(l,1),k.b=p.SkeletonJson.toColor(l,2),k.a=p.SkeletonJson.toColor(l,3));k.attachmentName=g.attachment;f.slots.push(k)}var e=a.skins,m;for(m in e)if(e.hasOwnProperty(m)){h=e[m];b=new p.Skin(m);for(var n in h)if(h.hasOwnProperty(n)){var d=
f.findSlotIndex(n),g=h[n],q;for(q in g)g.hasOwnProperty(q)&&(k=this.readAttachment(b,q,g[q]),null!=k&&b.addAttachment(d,q,k))}f.skins.push(b);"default"==b.name&&(f.defaultSkin=b)}a=a.animations;for(var s in a)a.hasOwnProperty(s)&&this.readAnimation(s,a[s],f);return f},readAttachment:function(a,b,f){b=f.name||b;a=p.AttachmentType[f.type||"region"];if(a==p.AttachmentType.region)return a=new p.RegionAttachment,a.x=(f.x||0)*this.scale,a.y=(f.y||0)*this.scale,a.scaleX=f.scaleX||1,a.scaleY=f.scaleY||1,
a.rotation=f.rotation||0,a.width=(f.width||32)*this.scale,a.height=(f.height||32)*this.scale,a.updateOffset(),a.rendererObject={},a.rendererObject.name=b,a.rendererObject.scale={},a.rendererObject.scale.x=a.scaleX,a.rendererObject.scale.y=a.scaleY,a.rendererObject.rotation=-a.rotation*Math.PI/180,a;throw"Unknown attachment type: "+a;},readAnimation:function(a,b,f){var d,e,h,g,k,l,m,n=[],q=0,s=b.bones,r;for(r in s)if(s.hasOwnProperty(r)){var v=f.findBoneIndex(r);if(-1==v)throw"Bone not found: "+r;
var t=s[r];for(h in t)if(t.hasOwnProperty(h))if(k=t[h],"rotate"==h){e=new p.RotateTimeline(k.length);e.boneIndex=v;l=d=0;for(m=k.length;m>l;l++)g=k[l],e.setFrame(d,g.time,g.angle),p.SkeletonJson.readCurve(e,d,g),d++;n.push(e);q=Math.max(q,e.frames[2*e.getFrameCount()-2])}else{if("translate"!=h&&"scale"!=h)throw"Invalid timeline type for a bone: "+h+" ("+r+")";var u=1;"scale"==h?e=new p.ScaleTimeline(k.length):(e=new p.TranslateTimeline(k.length),u=this.scale);e.boneIndex=v;l=d=0;for(m=k.length;m>
l;l++)g=k[l],e.setFrame(d,g.time,(g.x||0)*u,(g.y||0)*u),p.SkeletonJson.readCurve(e,d,g),d++;n.push(e);q=Math.max(q,e.frames[3*e.getFrameCount()-3])}}b=b.slots;for(var w in b)if(b.hasOwnProperty(w))for(h in s=b[w],r=f.findSlotIndex(w),s)if(s.hasOwnProperty(h))if(k=s[h],"color"==h){e=new p.ColorTimeline(k.length);e.slotIndex=r;l=d=0;for(m=k.length;m>l;l++){g=k[l];var x=g.color,v=p.SkeletonJson.toColor(x,0),t=p.SkeletonJson.toColor(x,1),u=p.SkeletonJson.toColor(x,2),x=p.SkeletonJson.toColor(x,3);e.setFrame(d,
g.time,v,t,u,x);p.SkeletonJson.readCurve(e,d,g);d++}n.push(e);q=Math.max(q,e.frames[5*e.getFrameCount()-5])}else{if("attachment"!=h)throw"Invalid timeline type for a slot: "+h+" ("+w+")";e=new p.AttachmentTimeline(k.length);e.slotIndex=r;l=d=0;for(m=k.length;m>l;l++)g=k[l],e.setFrame(d++,g.time,g.name);n.push(e);q=Math.max(q,e.frames[e.getFrameCount()-1])}f.animations.push(new p.Animation(a,n,q))}};p.SkeletonJson.readCurve=function(a,b,f){(f=f.curve)&&("stepped"==f?a.curves.setStepped(b):f instanceof
Array&&a.curves.setCurve(b,f[0],f[1],f[2],f[3]))};p.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255};p.Atlas=function(a,b){this.textureLoader=b;this.pages=[];this.regions=[];var f=new p.AtlasReader(a),d=[];d.length=4;for(var e=null;;){var h=f.readLine();if(null==h)break;if(h=f.trim(h),h.length)if(e){var g=new p.AtlasRegion;g.name=h;g.page=e;g.rotate="true"==f.readValue();f.readTuple(d);var h=parseInt(d[0],
10),k=parseInt(d[1],10);f.readTuple(d);var l=parseInt(d[0],10),m=parseInt(d[1],10);g.u=h/e.width;g.v=k/e.height;g.rotate?(g.u2=(h+m)/e.width,g.v2=(k+l)/e.height):(g.u2=(h+l)/e.width,g.v2=(k+m)/e.height);g.x=h;g.y=k;g.width=Math.abs(l);g.height=Math.abs(m);4==f.readTuple(d)&&(g.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==f.readTuple(d)&&(g.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],f.readTuple(d)));g.originalWidth=parseInt(d[0],
10);g.originalHeight=parseInt(d[1],10);f.readTuple(d);g.offsetX=parseInt(d[0],10);g.offsetY=parseInt(d[1],10);g.index=parseInt(f.readValue(),10);this.regions.push(g)}else e=new p.AtlasPage,e.name=h,e.format=p.Atlas.Format[f.readValue()],f.readTuple(d),e.minFilter=p.Atlas.TextureFilter[d[0]],e.magFilter=p.Atlas.TextureFilter[d[1]],g=f.readValue(),e.uWrap=p.Atlas.TextureWrap.clampToEdge,e.vWrap=p.Atlas.TextureWrap.clampToEdge,"x"==g?e.uWrap=p.Atlas.TextureWrap.repeat:"y"==g?e.vWrap=p.Atlas.TextureWrap.repeat:
"xy"==g&&(e.uWrap=e.vWrap=p.Atlas.TextureWrap.repeat),b.load(e,h),this.pages.push(e);else e=null}};p.Atlas.prototype={findRegion:function(a){for(var b=this.regions,f=0,d=b.length;d>f;f++)if(b[f].name==a)return b[f];return null},dispose:function(){for(var a=this.pages,b=0,f=a.length;f>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,f=0,d=b.length;d>f;f++){var e=b[f];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,
e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}};p.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};p.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};p.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};p.AtlasPage=function(){};p.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,
rendererObject:null,width:0,height:0};p.AtlasRegion=function(){};p.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};p.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)};p.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=
this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),f=b.indexOf(":");if(-1==f)throw"Invalid line: "+b;for(var d=0,f=f+1;3>d;d++){var e=b.indexOf(",",f);if(-1==e){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(f,e-f));f=e+1}return a[d]=this.trim(b.substring(f)),d+1}};p.AtlasAttachmentLoader=function(a){this.atlas=a};p.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,f){switch(b){case p.AttachmentType.region:a=
this.atlas.findRegion(f);if(!a)throw"Region not found in atlas: "+f+" ("+b+")";b=new p.RegionAttachment(f);return b.rendererObject=a,b.setUVs(a.u,a.v,a.u2,a.v2,a.rotate),b.regionOffsetX=a.offsetX,b.regionOffsetY=a.offsetY,b.regionWidth=a.width,b.regionHeight=a.height,b.regionOriginalWidth=a.originalWidth,b.regionOriginalHeight=a.originalHeight,b}throw"Unknown attachment type: "+b;}};p.Bone.yDown=!0;b.AnimCache={};b.Spine=function(a){if(b.DisplayObjectContainer.call(this),this.spineData=b.AnimCache[a],
!this.spineData)throw Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new p.Skeleton(this.spineData);this.skeleton.updateWorldTransform();this.stateData=new p.AnimationStateData(this.spineData);this.state=new p.AnimationState(this.stateData);this.slotContainers=[];a=0;for(var c=this.skeleton.drawOrder.length;c>a;a++){var f=this.skeleton.drawOrder[a],d=f.attachment,e=new b.DisplayObjectContainer;if(this.slotContainers.push(e),this.addChild(e),d instanceof
p.RegionAttachment){var h=d.rendererObject.name,d=this.createSprite(f,d.rendererObject);f.currentSprite=d;f.currentSpriteName=h;e.addChild(d)}}};b.Spine.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Spine.prototype.constructor=b.Spine;b.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now();this.state.update(a);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();for(var a=this.skeleton.drawOrder,
c=0,f=a.length;f>c;c++){var d=a[c],e=d.attachment,h=this.slotContainers[c];if(e instanceof p.RegionAttachment){if(e.rendererObject&&(!d.currentSpriteName||d.currentSpriteName!=e.name)){var g=e.rendererObject.name;if(void 0!==d.currentSprite&&(d.currentSprite.visible=!1),d.sprites=d.sprites||{},void 0!==d.sprites[g])d.sprites[g].visible=!0;else{var k=this.createSprite(d,e.rendererObject);h.addChild(k)}d.currentSprite=d.sprites[g];d.currentSpriteName=g}h.visible=!0;g=d.bone;h.position.x=g.worldX+e.x*
g.m00+e.y*g.m01;h.position.y=g.worldY+e.x*g.m10+e.y*g.m11;h.scale.x=g.worldScaleX;h.scale.y=g.worldScaleY;h.rotation=-(d.bone.worldRotation*Math.PI/180);h.alpha=d.a;d.currentSprite.tint=b.rgb2hex([d.r,d.g,d.b])}else h.visible=!1}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.Spine.prototype.createSprite=function(a,c){var f=new b.Sprite(b.Texture.fromFrame(b.TextureCache[c.name]?c.name:c.name+".png"));return f.scale=c.scale,f.rotation=c.rotation,f.anchor.x=f.anchor.y=.5,a.sprites=
a.sprites||{},a.sprites[c.name]=f,f};b.BaseTextureCache={};b.texturesToUpdate=[];b.texturesToDestroy=[];b.BaseTextureCacheIdGenerator=0;b.BaseTexture=function(a,c){if(b.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=c||b.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=b.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=
!0,this.width=this.source.width,this.height=this.source.height,b.texturesToUpdate.push(this);else{var f=this;this.source.onload=function(){f.hasLoaded=!0;f.width=f.source.width;f.height=f.source.height;for(var a=0;a<f._glTextures.length;a++)f._dirty[a]=!0;f.dispatchEvent({type:"loaded",content:f})};this.source.onerror=function(){f.dispatchEvent({type:"error",content:f})}}this.imageUrl=null;this._powerOf2=!1}};b.BaseTexture.prototype.constructor=b.BaseTexture;b.BaseTexture.prototype.destroy=function(){this.imageUrl?
(delete b.BaseTextureCache[this.imageUrl],delete b.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete b.BaseTextureCache[this.source._pixiId];this.source=null;b.texturesToDestroy.push(this)};b.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1;this.source.src=null;this.source.src=a};b.BaseTexture.fromImage=function(a,c,f){var d=b.BaseTextureCache[a];(void 0===c&&-1===a.indexOf("data:")&&(c=!0),d)||(d=new Image,c&&(d.crossOrigin=
""),d.src=a,d=new b.BaseTexture(d,f),d.imageUrl=a,b.BaseTextureCache[a]=d);return d};b.BaseTexture.fromCanvas=function(a,c){a._pixiId||(a._pixiId="canvas_"+b.TextureCacheIdGenerator++);var f=b.BaseTextureCache[a._pixiId];return f||(f=new b.BaseTexture(a,c),b.BaseTextureCache[a._pixiId]=f),f};b.TextureCache={};b.FrameCache={};b.TextureCacheIdGenerator=0;b.Texture=function(a,c){if(b.EventTarget.call(this),this.noFrame=!1,c||(this.noFrame=!0,c=new b.Rectangle(0,0,1,1)),a instanceof b.Texture&&(a=a.baseTexture),
this.baseTexture=a,this.frame=c,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new b.Rectangle(0,0,1,1),a.hasLoaded)this.noFrame&&(c=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(c);else{var f=this;a.addEventListener("loaded",function(){f.onBaseTextureLoaded()})}};b.Texture.prototype.constructor=b.Texture;b.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=
new b.Rectangle(0,0,a.width,a.height));this.setFrame(this.frame);this.scope.dispatchEvent({type:"update",content:this})};b.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy();this.valid=!1};b.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+
this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&b.Texture.frameUpdates.push(this)};b.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new b.TextureUvs);var a=this.crop,c=this.baseTexture.width,f=this.baseTexture.height;this._uvs.x0=a.x/c;this._uvs.y0=a.y/f;this._uvs.x1=(a.x+a.width)/c;this._uvs.y1=
a.y/f;this._uvs.x2=(a.x+a.width)/c;this._uvs.y2=(a.y+a.height)/f;this._uvs.x3=a.x/c;this._uvs.y3=(a.y+a.height)/f};b.Texture.fromImage=function(a,c,f){var d=b.TextureCache[a];return d||(d=new b.Texture(b.BaseTexture.fromImage(a,c,f)),b.TextureCache[a]=d),d};b.Texture.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw Error('The frameId "'+a+'" does not exist in the texture cache ');return c};b.Texture.fromCanvas=function(a,c){var f=b.BaseTexture.fromCanvas(a,c);return new b.Texture(f)};b.Texture.addTextureToCache=
function(a,c){b.TextureCache[c]=a};b.Texture.removeTextureFromCache=function(a){var c=b.TextureCache[a];return delete b.TextureCache[a],delete b.BaseTextureCache[a],c};b.Texture.frameUpdates=[];b.TextureUvs=function(){this.y3=this.x3=this.y2=this.x2=this.y1=this.x1=this.y0=this.x0=0};b.RenderTexture=function(a,c,f,d){(b.EventTarget.call(this),this.width=a||100,this.height=c||100,this.frame=new b.Rectangle(0,0,this.width,this.height),this.crop=new b.Rectangle(0,0,this.width,this.height),this.baseTexture=
new b.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=d||b.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=f||b.defaultRenderer,this.renderer.type===b.WEBGL_RENDERER)?(a=this.renderer.gl,this.textureBuffer=new b.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new b.Point(this.width/
2,-this.height/2)):(this.render=this.renderCanvas,this.textureBuffer=new b.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;b.Texture.frameUpdates.push(this)};b.RenderTexture.prototype=Object.create(b.Texture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.resize=function(a,c,f){a===this.width&&c===this.height||(this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=
c,f&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===b.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))};b.RenderTexture.prototype.clear=function(){this.renderer.type===b.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);this.textureBuffer.clear()};b.RenderTexture.prototype.renderWebGL=function(a,c,f){var d=this.renderer.gl;
d.colorMask(!0,!0,!0,!0);d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer);f&&this.textureBuffer.clear();f=a.children;d=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix;a.worldTransform.d=-1;a.worldTransform.ty=-2*this.projection.y;c&&(a.worldTransform.tx=c.x,a.worldTransform.ty-=c.y);c=0;for(var e=f.length;e>c;c++)f[c].updateTransform();b.WebGLRenderer.updateTextures();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,
this.projection,this.textureBuffer.frameBuffer);a.worldTransform=d;this.renderer.spriteBatch.dirty=!0};b.RenderTexture.prototype.renderCanvas=function(a,c,f){var d=a.children,e=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix;c?(a.worldTransform.tx=c.x,a.worldTransform.ty=c.y):(a.worldTransform.tx=0,a.worldTransform.ty=0);c=0;for(var h=d.length;h>c;c++)d[c].updateTransform();f&&this.textureBuffer.clear();f=this.textureBuffer.context;this.renderer.renderDisplayObject(a,f);f.setTransform(1,
0,0,1,0,0);a.worldTransform=e};b.RenderTexture.tempMatrix=new b.Matrix;b.AssetLoader=function(a,c){b.EventTarget.call(this);this.assetURLs=a;this.crossorigin=c;this.loadersByType={jpg:b.ImageLoader,jpeg:b.ImageLoader,png:b.ImageLoader,gif:b.ImageLoader,webp:b.ImageLoader,json:b.JsonLoader,atlas:b.AtlasLoader,anim:b.SpineLoader,xml:b.BitmapFontLoader,fnt:b.BitmapFontLoader}};b.AssetLoader.prototype.constructor=b.AssetLoader;b.AssetLoader.prototype._getDataType=function(a){if("data:"===a.slice(0,5).toLowerCase()){a=
a.slice(5);var b=a.indexOf(",");return-1===b?null:(a=a.slice(0,b).split(";")[0])&&"text/plain"!==a.toLowerCase()?a.split("/").pop().toLowerCase():"txt"}return null};b.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.content)}var b=this;this.loadCount=this.assetURLs.length;for(var f=0;f<this.assetURLs.length;f++){var d=this.assetURLs[f],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var h=this.loadersByType[e];if(!h)throw Error(e+" is an unsupported file type");
d=new h(d,this.crossorigin);d.addEventListener("loaded",a);d.load()}};b.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--;this.dispatchEvent({type:"onProgress",content:this,loader:a});this.onProgress&&this.onProgress(a);this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())};b.JsonLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.loaded=!1};b.JsonLoader.prototype.constructor=
b.JsonLoader;b.JsonLoader.prototype.load=function(){var a=this;window.XDomainRequest&&a.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3E3,this.ajaxRequest.onerror=function(){a.onError()},this.ajaxRequest.ontimeout=function(){a.onError()},this.ajaxRequest.onprogress=function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");this.ajaxRequest.onload=function(){a.onJSONLoaded()};this.ajaxRequest.open("GET",
this.url,!0);this.ajaxRequest.send()};b.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return this.onError(),void 0;if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,c=new b.ImageLoader(this.baseUrl+this.json.meta.image,this.crossorigin),f=this.json.frames;this.texture=c.texture.baseTexture;c.addEventListener("loaded",function(){a.onLoaded()});for(var d in f){var e=f[d].frame;if(e&&(b.TextureCache[d]=new b.Texture(this.texture,{x:e.x,
y:e.y,width:e.w,height:e.h}),b.TextureCache[d].crop=new b.Rectangle(e.x,e.y,e.w,e.h),f[d].trimmed)){var e=f[d].sourceSize,h=f[d].spriteSourceSize;b.TextureCache[d].trim=new b.Rectangle(h.x,h.y,e.w,e.h)}}c.load()}else this.json.bones&&(c=(new p.SkeletonJson).readSkeletonData(this.json),b.AnimCache[this.url]=c),this.onLoaded()};b.JsonLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};b.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",
content:this})};b.AtlasLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.baseUrl=a.replace(/[^\/]*$/,"");this.crossorigin=c;this.loaded=!1};b.AtlasLoader.constructor=b.AtlasLoader;b.AtlasLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)};b.AtlasLoader.prototype.onAtlasLoaded=
function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var a=this.ajaxRequest.responseText.split(/\r?\n/),c=-3,f=0,d=null,e=!1,h=0,g=0,k=this.onLoaded.bind(this),h=0;h<a.length;h++)if(a[h]=a[h].replace(/^\s+|\s+$/g,""),""===a[h]&&(e=h+1),0<a[h].length)e===h?(this.atlas.meta.image.push(a[h]),f=this.atlas.meta.image.length-1,this.atlas.frames.push({}),c=-3):0<c&&(1===c%7?(null!=d&&(this.atlas.frames[f][d.name]=
d),d={name:a[h],frame:{}}):(g=a[h].split(" "),3===c%7?(d.frame.x=Number(g[1].replace(",","")),d.frame.y=Number(g[2])):4===c%7?(d.frame.w=Number(g[1].replace(",","")),d.frame.h=Number(g[2])):5===c%7&&(g={x:0,y:0,w:Number(g[1].replace(",","")),h:Number(g[2])},g.w>d.frame.w||g.h>d.frame.h?(d.trimmed=!0,d.realSize=g):d.trimmed=!1))),c++;if(null!=d&&(this.atlas.frames[f][d.name]=d),0<this.atlas.meta.image.length){this.images=[];for(g=0;g<this.atlas.meta.image.length;g++)for(h in a=this.atlas.frames[g],
this.images.push(new b.ImageLoader(this.baseUrl+this.atlas.meta.image[g],this.crossorigin)),a)(c=a[h].frame)&&(b.TextureCache[h]=new b.Texture(this.images[g].texture.baseTexture,{x:c.x,y:c.y,width:c.w,height:c.h}),a[h].trimmed&&(b.TextureCache[h].realSize=a[h].realSize,b.TextureCache[h].trim.x=0,b.TextureCache[h].trim.y=0));for(g=this.currentImageId=0;g<this.images.length;g++)this.images[g].addEventListener("loaded",k);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()};
b.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))};b.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})};b.SpriteSheetLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null;this.frames={}};b.SpriteSheetLoader.prototype.constructor=
b.SpriteSheetLoader;b.SpriteSheetLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});c.load()};b.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.ImageLoader=function(a,c){b.EventTarget.call(this);this.texture=b.Texture.fromImage(a,c);this.frames=[]};b.ImageLoader.prototype.constructor=b.ImageLoader;b.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();
else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}};b.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.ImageLoader.prototype.loadFramedSpriteSheet=function(a,c,f){this.frames=[];for(var d=Math.floor(this.texture.width/a),e=Math.floor(this.texture.height/c),h=0,g=0;e>g;g++)for(var k=0;d>k;k++,h++){var l=new b.Texture(this.texture,{x:k*a,y:g*c,width:a,height:c});this.frames.push(l);f&&(b.TextureCache[f+"-"+h]=l)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();
else{var m=this;this.texture.baseTexture.addEventListener("loaded",function(){m.onLoaded()})}};b.BitmapFontLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null};b.BitmapFontLoader.prototype.constructor=b.BitmapFontLoader;b.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&
this.ajaxRequest.overrideMimeType("application/xml");this.ajaxRequest.send(null)};b.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser)a=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml");else{var c=document.createElement("div");
c.innerHTML=this.ajaxRequest.responseText;a=c}c=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file");c=new b.ImageLoader(c,this.crossorigin);this.texture=c.texture.baseTexture;var f={},d=a.getElementsByTagName("info")[0],e=a.getElementsByTagName("common")[0];f.font=d.getAttribute("face");f.size=parseInt(d.getAttribute("size"),10);f.lineHeight=parseInt(e.getAttribute("lineHeight"),10);f.chars={};e=a.getElementsByTagName("char");for(d=0;d<e.length;d++){var h=parseInt(e[d].getAttribute("id"),
10),g=new b.Rectangle(parseInt(e[d].getAttribute("x"),10),parseInt(e[d].getAttribute("y"),10),parseInt(e[d].getAttribute("width"),10),parseInt(e[d].getAttribute("height"),10));f.chars[h]={xOffset:parseInt(e[d].getAttribute("xoffset"),10),yOffset:parseInt(e[d].getAttribute("yoffset"),10),xAdvance:parseInt(e[d].getAttribute("xadvance"),10),kerning:{},texture:b.TextureCache[h]=new b.Texture(this.texture,g)}}a=a.getElementsByTagName("kerning");for(d=0;d<a.length;d++)e=parseInt(a[d].getAttribute("first"),
10),h=parseInt(a[d].getAttribute("second"),10),g=parseInt(a[d].getAttribute("amount"),10),f.chars[h].kerning[e]=g;b.BitmapText.fonts[f.font]=f;var k=this;c.addEventListener("loaded",function(){k.onLoaded()});c.load()}};b.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};b.SpineLoader=function(a,c){b.EventTarget.call(this);this.url=a;this.crossorigin=c;this.loaded=!1};b.SpineLoader.prototype.constructor=b.SpineLoader;b.SpineLoader.prototype.load=function(){var a=
this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});c.load()};b.SpineLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};b.AbstractFilter=function(a,b){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=b||{};this.fragmentSrc=a||[]};b.AlphaMaskFilter=function(a){b.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms=
{mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;",
"uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]};b.AlphaMaskFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.AlphaMaskFilter.prototype.constructor=b.AlphaMaskFilter;b.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height;this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(b.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}});b.ColorMatrixFilter=function(){b.AbstractFilter.call(this);
this.passes=[this];this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]};b.ColorMatrixFilter.prototype=Object.create(b.AbstractFilter.prototype);b.ColorMatrixFilter.prototype.constructor=b.ColorMatrixFilter;Object.defineProperty(b.ColorMatrixFilter.prototype,
"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}});b.GrayFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={gray:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);",
"}"]};b.GrayFilter.prototype=Object.create(b.AbstractFilter.prototype);b.GrayFilter.prototype.constructor=b.GrayFilter;Object.defineProperty(b.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}});b.DisplacementFilter=function(a){b.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},
mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;",
"uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);",
"   vec2 cord = vTextureCoord;","}"]};b.DisplacementFilter.prototype=Object.create(b.AbstractFilter.prototype);b.DisplacementFilter.prototype.constructor=b.DisplacementFilter;b.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height;this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(b.DisplacementFilter.prototype,
"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}});Object.defineProperty(b.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}});Object.defineProperty(b.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}});b.PixelateFilter=function(){b.AbstractFilter.call(this);this.passes=
[this];this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1E4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;",
"   gl_FragColor = texture2D(uSampler, color);","}"]};b.PixelateFilter.prototype=Object.create(b.AbstractFilter.prototype);b.PixelateFilter.prototype.constructor=b.PixelateFilter;Object.defineProperty(b.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0;this.uniforms.pixelSize.value=a}});b.BlurXFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;",
"varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]};b.BlurXFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.BlurXFilter.prototype.constructor=b.BlurXFilter;Object.defineProperty(b.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.dirty=!0;this.uniforms.blur.value=1/7E3*a}});b.BlurYFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {",
"   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]};b.BlurYFilter.prototype=Object.create(b.AbstractFilter.prototype);b.BlurYFilter.prototype.constructor=b.BlurYFilter;Object.defineProperty(b.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/
(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});b.BlurFilter=function(){this.blurXFilter=new b.BlurXFilter;this.blurYFilter=new b.BlurYFilter;this.passes=[this.blurXFilter,this.blurYFilter]};Object.defineProperty(b.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}});Object.defineProperty(b.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=
a}});Object.defineProperty(b.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}});b.InvertFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);",
"}"]};b.InvertFilter.prototype=Object.create(b.AbstractFilter.prototype);b.InvertFilter.prototype.constructor=b.InvertFilter;Object.defineProperty(b.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}});b.SepiaFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={sepia:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;",
"uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]};b.SepiaFilter.prototype=Object.create(b.AbstractFilter.prototype);b.SepiaFilter.prototype.constructor=b.SepiaFilter;Object.defineProperty(b.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},
set:function(a){this.uniforms.sepia.value=a}});b.TwistFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;",
"   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]};b.TwistFilter.prototype=Object.create(b.AbstractFilter.prototype);b.TwistFilter.prototype.constructor=b.TwistFilter;Object.defineProperty(b.TwistFilter.prototype,
"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0;this.uniforms.offset.value=a}});Object.defineProperty(b.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0;this.uniforms.radius.value=a}});Object.defineProperty(b.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});b.ColorStepFilter=function(){b.AbstractFilter.call(this);
this.passes=[this];this.uniforms={step:{type:"1f",value:5}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]};b.ColorStepFilter.prototype=Object.create(b.AbstractFilter.prototype);b.ColorStepFilter.prototype.constructor=b.ColorStepFilter;Object.defineProperty(b.ColorStepFilter.prototype,
"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}});b.DotScreenFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {",
"   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};b.DotScreenFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.DotScreenFilter.prototype.constructor=b.DotScreenFilter;Object.defineProperty(b.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0;this.uniforms.scale.value=a}});Object.defineProperty(b.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});b.CrossHatchFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",
value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {",
"            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]};b.CrossHatchFilter.prototype=Object.create(b.AbstractFilter.prototype);b.CrossHatchFilter.prototype.constructor=
b.BlurYFilter;Object.defineProperty(b.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});b.RGBSplitFilter=function(){b.AbstractFilter.call(this);this.passes=[this];this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]};b.RGBSplitFilter.prototype=Object.create(b.AbstractFilter.prototype);
b.RGBSplitFilter.prototype.constructor=b.RGBSplitFilter;Object.defineProperty(b.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PIXI=b):"undefined"!=typeof define&&define.amd?define(b):this.PIXI=b}).call(this);function Model(){this.views_=[]}Model.prototype.subscribeView=function(b){this.views_.push(b)};
Model.prototype.notifyChange=function(){for(var b=0;b<this.views_.length;b++)this.views_[b].notify()};function Map(b,r,w,y){this.base=Model;this.base.apply(this);this.width_=b;this.height_=r;this.tiles_=[];for(b=0;b<this.height_;b++)for(r=0;r<this.width_;r++)this.tiles_[this.toLinearIndex_(r,b)]=new Tile(w,y)}Map.prototype=Object.create(Model.prototype);Map.prototype.getWidth=function(){return this.width_};Map.prototype.getHeight=function(){return this.height_};
Map.prototype.forEachTile=function(b){for(var r=0;r<this.height_;r++)for(var w=0;w<this.width_;w++)b(this.getTile(w,r),w,r)};Map.prototype.isInMap=function(b,r){return 0<=b&&b<this.width_&&0<=r&&r<this.height_};Map.prototype.toLinearIndex_=function(b,r){return r*this._width+b};Map.prototype.getTile=function(b,r){return isInMap(b,r)?this.tiles_[this.toLinearIndex_(b,r)]:null};function Tile(b,r){this.isOccupied_=!1;this.color_=4473924;this.width_=b;this.height_=r}Tile.prototype.getWidth=function(){return this.width_};
Tile.prototype.getHeight=function(){return this.height_};Tile.prototype.getColor=function(){return this.color_};Tile.prototype.isOccupied=function(){return this.isOccupied_};function MarkovNode(){}function MarkovEdge(){}function WorkerState(){this.base=MarkovNode;this.base.apply(this)}WorkerState.prototype=Object.create(MarkovNode.prototype);function MarkovChain(){}function Controller(b){this.setBindings()}Controller.prototype.bind=function(b,r){b.addBinding(this,r)};
Controller.prototype.clearBindings=function(b){b.removeAllBindings(this)};Controller.prototype.setBindings=window.ABSTRACT_METHOD;function ClientController(b){this.base=Controller;this.base.apply(this,[b]);this.viewModel_=new MarkoViewModel}ClientController.prototype=Object.create(Controller.prototype);
ClientController.prototype.setBindings=function(){this.bind(Action.GameActions.RENDER,this.onRender);this.bind(Action.GameActions.UPDATE,this.onUpdate);this.bind(Action.ViewActions.START_DRAG_SELECT,this.onDragStart)};ClientController.prototype.onRender=function(){this.viewModel_.render()};ClientController.prototype.onUpdate=function(){this.viewModel_.update()};ClientController.prototype.onDragStart=function(){console.log("drag start")};ClientController.prototype.onClickScreen=function(){console.log("Hello")};
function Action(){this.bindings_=[]}Action.NO_SOURCE=null;Action.prototype.fire=function(b,r){for(var w=0;w<this.bindings_.length;w++)this.bindings_[w].callback.apply(this.bindings_[w].binder,b,r)};Action.prototype.addBinding=function(b,r){this.bindings_.push({binder:b,callback:r})};Action.prototype.removeAllBindings=function(b){this.bindings_=this.bindings_.filter(function(r){return r.binder!=b})};Action.GameActions={RENDER:new Action,UPDATE:new Action,STOP:new Action,START:new Action};
Action.ViewActions={START_DRAG_SELECT:new Action};function View(b){this.model_=b;this.model_.subscribeView(this)}View.prototype.getModel=function(){return this.model_};View.prototype.notify=window.ABSTRACT_METHOD;function PixiView(b,r){this.base=View;this.base.apply(this,[b]);this.pixiStage_=r;this.pixiChild_=this.makePixiStageMember();this.pixiStage_.addChild(this.pixiChild_)}PixiView.prototype=Object.create(View.prototype);PixiView.prototype.getPixiStageMember=function(){return this.pixiChild_};
PixiView.prototype.redrawPixiStageMember=function(){this.pixiStage_.removeChild(this.pixiChild_);this.pixiChild_=this.makePixiStageMember();this.pixiStage_.addChild(this.pixiChild_)};PixiView.prototype.makePixiStageMember=window.ABSTRACT_METHOD;PixiView.prototype.notify=window.ABSTRACT_METHOD;function WorkerView(b,r){this.base=PixiView;this.base.apply(this,[b,r])}WorkerView.prototype=Object.create(PixiView);
WorkerView.prototype.makePixiStageMember=function(){var b=new PIXI.Graphics;b.beginFill(16776960);b.lineStyle(5,16711680);b.drawRect(0,0,300,200);return b};WorkerView.prototype.notify=function(){this.redrawPixiStageMember()};function MapView(b,r){this.base=PixiView;this.base.apply(this,[b,r])}MapView.prototype=Object.create(PixiView);
MapView.prototype.makePixiStageMember=function(){var b=new PIXI.Graphics;this.getModel().forEachTile(function(r,w,y){b.beginFill(r.getColor());b.drawRect(0,0,300,200)});return b};MapView.prototype.notify=function(){};function ViewModel(){}
function MarkoViewModel(){var b=Math.floor(20),r=Math.floor(20);this.base=ViewModel;this.base.apply(this);this.pixiStage_=new PIXI.Stage(6750105);this.pixiRenderer_=PIXI.autoDetectRenderer(400,300);document.body.appendChild(this.pixiRenderer_.view);this.map_=new Map(20,15,b,r);this.mapView_=new MapView(this.map_,this.pixiStage_)}MarkoViewModel.prototype=Object.create(ViewModel.prototype);MarkoViewModel.prototype.render=function(){this.pixiRenderer_.render(this.pixiStage_)};
MarkoViewModel.prototype.update=function(){};function Game(){this.running_=!1;this.lastUpdate_=this.oneFrameTime_=this.loopInterval_=null}Game.prototype.onRender=window.ABSTRACT_METHOD;Game.prototype.onUpdate=window.ABSTRACT_METHOD;Game.prototype.onStart=window.ABSTRACT_METHOD;Game.prototype.onShutDown=window.ABSTRACT_METHOD;Game.prototype.render_=function(){this.onRender()};Game.prototype.update_=function(b){this.onUpdate(b)};
Game.prototype.run=function(b){var r=this;this.oneFrameTime_=1E3/b;this.running_=!0;this.onStart();this.loopInterval_=setInterval(function(){var b=1;if(r.lastUpdate_){var y=Date.now(),b=y-r.lastUpdate_;r.lastUpdate_=y}else r.lastUpdate_=Date.now();r.running_||(clearInterval(r.loopInterval_),r.onShutDown());r.update_(b);r.render_()},this.oneFrameTime_)};function Marko(){this.base=Game;this.base.apply(this);this.controller=new ClientController(this)}Marko.prototype=Object.create(Game.prototype);
Marko.prototype.onRender=function(){Action.GameActions.RENDER.fire(Action.NO_SOURCE)};Marko.prototype.onUpdate=function(b){Action.GameActions.UPDATE.fire(Action.NO_SOURCE,b)};Marko.prototype.onStart=function(){Action.GameActions.START.fire(Action.NO_SOURCE)};Marko.prototype.onShutDown=function(){Action.GameActions.STOP.fire(Action.NO_SOURCE)};